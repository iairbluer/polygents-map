{"version":3,"file":"main-b34a1f54.js","sources":["../../node_modules/@workadventure/scripting-api-extra/dist/Properties.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/default_assets_url.js","../../node_modules/@workadventure/scripting-api-extra/dist/VariablesExtra.js","../../node_modules/@workadventure/scripting-api-extra/dist/LayersFlattener.js","../../node_modules/@workadventure/scripting-api-extra/dist/AreaObject.js","../../node_modules/@workadventure/scripting-api-extra/dist/LayersExtra.js","../../node_modules/mustache/mustache.mjs","../../node_modules/@workadventure/scripting-api-extra/dist/TemplateValue.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/properties_templates.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/workadventure_assets_url.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/doors.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/variable_actions.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/special_properties.js","../../node_modules/@workadventure/scripting-api-extra/dist/Features/configuration.js","../../node_modules/@workadventure/scripting-api-extra/dist/init.js","../../src/places.ts","../../node_modules/engine.io-parser/build/esm/commons.js","../../node_modules/engine.io-parser/build/esm/encodePacket.browser.js","../../node_modules/engine.io-parser/build/esm/contrib/base64-arraybuffer.js","../../node_modules/engine.io-parser/build/esm/decodePacket.browser.js","../../node_modules/engine.io-parser/build/esm/index.js","../../node_modules/@socket.io/component-emitter/lib/esm/index.js","../../node_modules/engine.io-client/build/esm/globals.js","../../node_modules/engine.io-client/build/esm/util.js","../../node_modules/engine.io-client/build/esm/contrib/parseqs.js","../../node_modules/engine.io-client/build/esm/transport.js","../../node_modules/engine.io-client/build/esm/transports/polling.js","../../node_modules/engine.io-client/build/esm/contrib/has-cors.js","../../node_modules/engine.io-client/build/esm/transports/polling-xhr.js","../../node_modules/engine.io-client/build/esm/transports/websocket.js","../../node_modules/engine.io-client/build/esm/transports/webtransport.js","../../node_modules/engine.io-client/build/esm/transports/index.js","../../node_modules/engine.io-client/build/esm/contrib/parseuri.js","../../node_modules/engine.io-client/build/esm/socket.js","../../node_modules/socket.io-client/build/esm/url.js","../../node_modules/socket.io-parser/build/esm/is-binary.js","../../node_modules/socket.io-parser/build/esm/binary.js","../../node_modules/socket.io-parser/build/esm/index.js","../../node_modules/socket.io-client/build/esm/on.js","../../node_modules/socket.io-client/build/esm/socket.js","../../node_modules/socket.io-client/build/esm/contrib/backo2.js","../../node_modules/socket.io-client/build/esm/manager.js","../../node_modules/socket.io-client/build/esm/index.js","../../src/map-events-socket.ts","../../src/main.ts"],"sourcesContent":["export class Properties {\n    constructor(properties) {\n        this.properties = properties !== null && properties !== void 0 ? properties : [];\n    }\n    get(name) {\n        const values = this.properties\n            .filter((property) => property.name === name)\n            .map((property) => property.value);\n        if (values.length > 1) {\n            throw new Error('Expected only one property to be named \"' + name + '\"');\n        }\n        if (values.length === 0) {\n            return undefined;\n        }\n        return values[0];\n    }\n    getString(name) {\n        return this.getByType(name, \"string\");\n    }\n    getNumber(name) {\n        return this.getByType(name, \"number\");\n    }\n    getBoolean(name) {\n        return this.getByType(name, \"boolean\");\n    }\n    getByType(name, type) {\n        const value = this.get(name);\n        if (value === undefined) {\n            return undefined;\n        }\n        if (type !== \"json\" && typeof value !== type) {\n            throw new Error('Expected property \"' + name + '\" to have type \"' + type + '\"');\n        }\n        return value;\n    }\n    mustGetString(name) {\n        return this.mustGetByType(name, \"string\");\n    }\n    mustGetNumber(name) {\n        return this.mustGetByType(name, \"number\");\n    }\n    mustGetBoolean(name) {\n        return this.mustGetByType(name, \"boolean\");\n    }\n    mustGetByType(name, type) {\n        const value = this.get(name);\n        if (value === undefined) {\n            throw new Error('Property \"' + name + '\" is missing');\n        }\n        if (type !== \"json\" && typeof value !== type) {\n            throw new Error('Expected property \"' + name + '\" to have type \"' + type + '\"');\n        }\n        return value;\n    }\n    getType(name) {\n        const types = this.properties\n            .filter((property) => property.name === name)\n            .map((property) => property.type);\n        if (types.length > 1) {\n            throw new Error('Expected only one property to be named \"' + name + '\"');\n        }\n        if (types.length === 0) {\n            return undefined;\n        }\n        return types[0];\n    }\n}\n//# sourceMappingURL=Properties.js.map","export const defaultAssetsUrl = \"https://unpkg.com/@workadventure/scripting-api-extra@1.9.1/dist\";\n//# sourceMappingURL=default_assets_url.js.map","import { Properties } from \"./Properties\";\nimport { defaultAssetsUrl } from \"./Features/default_assets_url\";\nexport class VariableDescriptor {\n    constructor(object) {\n        this.name = object.name;\n        this.x = object.x;\n        this.y = object.y;\n        this.properties = new Properties(object.properties);\n    }\n    get isReadable() {\n        const readableBy = this.properties.getString(\"readableBy\");\n        if (!readableBy) {\n            return true;\n        }\n        return WA.player.tags.includes(readableBy);\n    }\n    get isWritable() {\n        const writableBy = this.properties.getString(\"writableBy\");\n        if (!writableBy) {\n            return true;\n        }\n        return WA.player.tags.includes(writableBy);\n    }\n}\nexport function openConfig(variables) {\n    const parameters = variables ? \"#\" + variables.join() : \"\";\n    WA.nav.openCoWebSite(defaultAssetsUrl + \"/configuration.html\" + parameters, true);\n}\nexport async function getVariables(layerFilter, variablesFilter) {\n    const map = await WA.room.getTiledMap();\n    const variables = new Map();\n    getAllVariablesRecursive(map.layers, variables, layerFilter, variablesFilter);\n    return variables;\n}\nfunction getAllVariablesRecursive(layers, variables, layerFilter, variablesFilter) {\n    for (const layer of layers) {\n        if (layer.type === \"objectgroup\") {\n            for (const object of layer.objects) {\n                if (object.type === \"variable\" || object.class === \"variable\") {\n                    if (!!layerFilter && layer.name !== layerFilter)\n                        continue;\n                    if (!!variablesFilter && !variablesFilter.includes(object.name))\n                        continue;\n                    variables.set(object.name, new VariableDescriptor(object));\n                }\n            }\n        }\n        else if (layer.type === \"group\") {\n            getAllVariablesRecursive(layer.layers, variables, layerFilter, variablesFilter);\n        }\n    }\n}\n//# sourceMappingURL=VariablesExtra.js.map","let layersMapPromise = undefined;\nexport async function getLayersMap() {\n    if (layersMapPromise === undefined) {\n        layersMapPromise = getLayersMapWithoutCache();\n    }\n    return layersMapPromise;\n}\nasync function getLayersMapWithoutCache() {\n    return flattenGroupLayersMap((await WA.room.getTiledMap()));\n}\nfunction flattenGroupLayersMap(map) {\n    const flatLayers = new Map();\n    flattenGroupLayers(map.layers, \"\", flatLayers);\n    return flatLayers;\n}\nfunction flattenGroupLayers(layers, prefix, flatLayers) {\n    for (const layer of layers) {\n        if (layer.type === \"group\") {\n            flattenGroupLayers(layer.layers, prefix + layer.name + \"/\", flatLayers);\n        }\n        else {\n            layer.name = prefix + layer.name;\n            flatLayers.set(layer.name, layer);\n        }\n    }\n}\n//# sourceMappingURL=LayersFlattener.js.map","import { getLayersMap } from \"./LayersFlattener\";\nexport async function getAreaObject() {\n    const layers = await getLayersMap();\n    const areaArray = [];\n    for (const layer of layers.values()) {\n        if (layer.type === \"objectgroup\") {\n            for (const object of layer.objects) {\n                if (object.type === \"area\" || object.class === \"area\") {\n                    areaArray.push(object);\n                }\n            }\n        }\n    }\n    return areaArray;\n}\n//# sourceMappingURL=AreaObject.js.map","export function findLayerBoundaries(layer) {\n    let left = Infinity;\n    let top = Infinity;\n    let bottom = 0;\n    let right = 0;\n    const data = layer.data;\n    if (typeof data === \"string\") {\n        throw new Error(\"Unsupported tile layer data stored as string instead of CSV\");\n    }\n    for (let j = 0; j < layer.height; j++) {\n        for (let i = 0; i < layer.width; i++) {\n            if (data[i + j * layer.width] !== 0) {\n                left = Math.min(left, i);\n                right = Math.max(right, i);\n                top = Math.min(top, j);\n                bottom = Math.max(bottom, j);\n            }\n        }\n    }\n    return {\n        top,\n        left,\n        right: right + 1,\n        bottom: bottom + 1,\n    };\n}\nexport function findLayersBoundaries(layers) {\n    let left = Infinity;\n    let top = Infinity;\n    let bottom = 0;\n    let right = 0;\n    for (const layer of layers) {\n        const boundaries = findLayerBoundaries(layer);\n        if (boundaries.left < left) {\n            left = boundaries.left;\n        }\n        if (boundaries.top < top) {\n            top = boundaries.top;\n        }\n        if (boundaries.right > right) {\n            right = boundaries.right;\n        }\n        if (boundaries.bottom > bottom) {\n            bottom = boundaries.bottom;\n        }\n    }\n    return {\n        top,\n        left,\n        right,\n        bottom,\n    };\n}\n//# sourceMappingURL=LayersExtra.js.map","/*!\n * mustache.js - Logic-less {{mustache}} templates with JavaScript\n * http://github.com/janl/mustache.js\n */\n\nvar objectToString = Object.prototype.toString;\nvar isArray = Array.isArray || function isArrayPolyfill (object) {\n  return objectToString.call(object) === '[object Array]';\n};\n\nfunction isFunction (object) {\n  return typeof object === 'function';\n}\n\n/**\n * More correct typeof string handling array\n * which normally returns typeof 'object'\n */\nfunction typeStr (obj) {\n  return isArray(obj) ? 'array' : typeof obj;\n}\n\nfunction escapeRegExp (string) {\n  return string.replace(/[\\-\\[\\]{}()*+?.,\\\\\\^$|#\\s]/g, '\\\\$&');\n}\n\n/**\n * Null safe way of checking whether or not an object,\n * including its prototype, has a given property\n */\nfunction hasProperty (obj, propName) {\n  return obj != null && typeof obj === 'object' && (propName in obj);\n}\n\n/**\n * Safe way of detecting whether or not the given thing is a primitive and\n * whether it has the given property\n */\nfunction primitiveHasOwnProperty (primitive, propName) {\n  return (\n    primitive != null\n    && typeof primitive !== 'object'\n    && primitive.hasOwnProperty\n    && primitive.hasOwnProperty(propName)\n  );\n}\n\n// Workaround for https://issues.apache.org/jira/browse/COUCHDB-577\n// See https://github.com/janl/mustache.js/issues/189\nvar regExpTest = RegExp.prototype.test;\nfunction testRegExp (re, string) {\n  return regExpTest.call(re, string);\n}\n\nvar nonSpaceRe = /\\S/;\nfunction isWhitespace (string) {\n  return !testRegExp(nonSpaceRe, string);\n}\n\nvar entityMap = {\n  '&': '&amp;',\n  '<': '&lt;',\n  '>': '&gt;',\n  '\"': '&quot;',\n  \"'\": '&#39;',\n  '/': '&#x2F;',\n  '`': '&#x60;',\n  '=': '&#x3D;'\n};\n\nfunction escapeHtml (string) {\n  return String(string).replace(/[&<>\"'`=\\/]/g, function fromEntityMap (s) {\n    return entityMap[s];\n  });\n}\n\nvar whiteRe = /\\s*/;\nvar spaceRe = /\\s+/;\nvar equalsRe = /\\s*=/;\nvar curlyRe = /\\s*\\}/;\nvar tagRe = /#|\\^|\\/|>|\\{|&|=|!/;\n\n/**\n * Breaks up the given `template` string into a tree of tokens. If the `tags`\n * argument is given here it must be an array with two string values: the\n * opening and closing tags used in the template (e.g. [ \"<%\", \"%>\" ]). Of\n * course, the default is to use mustaches (i.e. mustache.tags).\n *\n * A token is an array with at least 4 elements. The first element is the\n * mustache symbol that was used inside the tag, e.g. \"#\" or \"&\". If the tag\n * did not contain a symbol (i.e. {{myValue}}) this element is \"name\". For\n * all text that appears outside a symbol this element is \"text\".\n *\n * The second element of a token is its \"value\". For mustache tags this is\n * whatever else was inside the tag besides the opening symbol. For text tokens\n * this is the text itself.\n *\n * The third and fourth elements of the token are the start and end indices,\n * respectively, of the token in the original template.\n *\n * Tokens that are the root node of a subtree contain two more elements: 1) an\n * array of tokens in the subtree and 2) the index in the original template at\n * which the closing tag for that section begins.\n *\n * Tokens for partials also contain two more elements: 1) a string value of\n * indendation prior to that tag and 2) the index of that tag on that line -\n * eg a value of 2 indicates the partial is the third tag on this line.\n */\nfunction parseTemplate (template, tags) {\n  if (!template)\n    return [];\n  var lineHasNonSpace = false;\n  var sections = [];     // Stack to hold section tokens\n  var tokens = [];       // Buffer to hold the tokens\n  var spaces = [];       // Indices of whitespace tokens on the current line\n  var hasTag = false;    // Is there a {{tag}} on the current line?\n  var nonSpace = false;  // Is there a non-space char on the current line?\n  var indentation = '';  // Tracks indentation for tags that use it\n  var tagIndex = 0;      // Stores a count of number of tags encountered on a line\n\n  // Strips all whitespace tokens array for the current line\n  // if there was a {{#tag}} on it and otherwise only space.\n  function stripSpace () {\n    if (hasTag && !nonSpace) {\n      while (spaces.length)\n        delete tokens[spaces.pop()];\n    } else {\n      spaces = [];\n    }\n\n    hasTag = false;\n    nonSpace = false;\n  }\n\n  var openingTagRe, closingTagRe, closingCurlyRe;\n  function compileTags (tagsToCompile) {\n    if (typeof tagsToCompile === 'string')\n      tagsToCompile = tagsToCompile.split(spaceRe, 2);\n\n    if (!isArray(tagsToCompile) || tagsToCompile.length !== 2)\n      throw new Error('Invalid tags: ' + tagsToCompile);\n\n    openingTagRe = new RegExp(escapeRegExp(tagsToCompile[0]) + '\\\\s*');\n    closingTagRe = new RegExp('\\\\s*' + escapeRegExp(tagsToCompile[1]));\n    closingCurlyRe = new RegExp('\\\\s*' + escapeRegExp('}' + tagsToCompile[1]));\n  }\n\n  compileTags(tags || mustache.tags);\n\n  var scanner = new Scanner(template);\n\n  var start, type, value, chr, token, openSection;\n  while (!scanner.eos()) {\n    start = scanner.pos;\n\n    // Match any text between tags.\n    value = scanner.scanUntil(openingTagRe);\n\n    if (value) {\n      for (var i = 0, valueLength = value.length; i < valueLength; ++i) {\n        chr = value.charAt(i);\n\n        if (isWhitespace(chr)) {\n          spaces.push(tokens.length);\n          indentation += chr;\n        } else {\n          nonSpace = true;\n          lineHasNonSpace = true;\n          indentation += ' ';\n        }\n\n        tokens.push([ 'text', chr, start, start + 1 ]);\n        start += 1;\n\n        // Check for whitespace on the current line.\n        if (chr === '\\n') {\n          stripSpace();\n          indentation = '';\n          tagIndex = 0;\n          lineHasNonSpace = false;\n        }\n      }\n    }\n\n    // Match the opening tag.\n    if (!scanner.scan(openingTagRe))\n      break;\n\n    hasTag = true;\n\n    // Get the tag type.\n    type = scanner.scan(tagRe) || 'name';\n    scanner.scan(whiteRe);\n\n    // Get the tag value.\n    if (type === '=') {\n      value = scanner.scanUntil(equalsRe);\n      scanner.scan(equalsRe);\n      scanner.scanUntil(closingTagRe);\n    } else if (type === '{') {\n      value = scanner.scanUntil(closingCurlyRe);\n      scanner.scan(curlyRe);\n      scanner.scanUntil(closingTagRe);\n      type = '&';\n    } else {\n      value = scanner.scanUntil(closingTagRe);\n    }\n\n    // Match the closing tag.\n    if (!scanner.scan(closingTagRe))\n      throw new Error('Unclosed tag at ' + scanner.pos);\n\n    if (type == '>') {\n      token = [ type, value, start, scanner.pos, indentation, tagIndex, lineHasNonSpace ];\n    } else {\n      token = [ type, value, start, scanner.pos ];\n    }\n    tagIndex++;\n    tokens.push(token);\n\n    if (type === '#' || type === '^') {\n      sections.push(token);\n    } else if (type === '/') {\n      // Check section nesting.\n      openSection = sections.pop();\n\n      if (!openSection)\n        throw new Error('Unopened section \"' + value + '\" at ' + start);\n\n      if (openSection[1] !== value)\n        throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + start);\n    } else if (type === 'name' || type === '{' || type === '&') {\n      nonSpace = true;\n    } else if (type === '=') {\n      // Set the tags for the next time around.\n      compileTags(value);\n    }\n  }\n\n  stripSpace();\n\n  // Make sure there are no open sections when we're done.\n  openSection = sections.pop();\n\n  if (openSection)\n    throw new Error('Unclosed section \"' + openSection[1] + '\" at ' + scanner.pos);\n\n  return nestTokens(squashTokens(tokens));\n}\n\n/**\n * Combines the values of consecutive text tokens in the given `tokens` array\n * to a single token.\n */\nfunction squashTokens (tokens) {\n  var squashedTokens = [];\n\n  var token, lastToken;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    token = tokens[i];\n\n    if (token) {\n      if (token[0] === 'text' && lastToken && lastToken[0] === 'text') {\n        lastToken[1] += token[1];\n        lastToken[3] = token[3];\n      } else {\n        squashedTokens.push(token);\n        lastToken = token;\n      }\n    }\n  }\n\n  return squashedTokens;\n}\n\n/**\n * Forms the given array of `tokens` into a nested tree structure where\n * tokens that represent a section have two additional items: 1) an array of\n * all tokens that appear in that section and 2) the index in the original\n * template that represents the end of that section.\n */\nfunction nestTokens (tokens) {\n  var nestedTokens = [];\n  var collector = nestedTokens;\n  var sections = [];\n\n  var token, section;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    token = tokens[i];\n\n    switch (token[0]) {\n      case '#':\n      case '^':\n        collector.push(token);\n        sections.push(token);\n        collector = token[4] = [];\n        break;\n      case '/':\n        section = sections.pop();\n        section[5] = token[2];\n        collector = sections.length > 0 ? sections[sections.length - 1][4] : nestedTokens;\n        break;\n      default:\n        collector.push(token);\n    }\n  }\n\n  return nestedTokens;\n}\n\n/**\n * A simple string scanner that is used by the template parser to find\n * tokens in template strings.\n */\nfunction Scanner (string) {\n  this.string = string;\n  this.tail = string;\n  this.pos = 0;\n}\n\n/**\n * Returns `true` if the tail is empty (end of string).\n */\nScanner.prototype.eos = function eos () {\n  return this.tail === '';\n};\n\n/**\n * Tries to match the given regular expression at the current position.\n * Returns the matched text if it can match, the empty string otherwise.\n */\nScanner.prototype.scan = function scan (re) {\n  var match = this.tail.match(re);\n\n  if (!match || match.index !== 0)\n    return '';\n\n  var string = match[0];\n\n  this.tail = this.tail.substring(string.length);\n  this.pos += string.length;\n\n  return string;\n};\n\n/**\n * Skips all text until the given regular expression can be matched. Returns\n * the skipped string, which is the entire tail if no match can be made.\n */\nScanner.prototype.scanUntil = function scanUntil (re) {\n  var index = this.tail.search(re), match;\n\n  switch (index) {\n    case -1:\n      match = this.tail;\n      this.tail = '';\n      break;\n    case 0:\n      match = '';\n      break;\n    default:\n      match = this.tail.substring(0, index);\n      this.tail = this.tail.substring(index);\n  }\n\n  this.pos += match.length;\n\n  return match;\n};\n\n/**\n * Represents a rendering context by wrapping a view object and\n * maintaining a reference to the parent context.\n */\nfunction Context (view, parentContext) {\n  this.view = view;\n  this.cache = { '.': this.view };\n  this.parent = parentContext;\n}\n\n/**\n * Creates a new context using the given view with this context\n * as the parent.\n */\nContext.prototype.push = function push (view) {\n  return new Context(view, this);\n};\n\n/**\n * Returns the value of the given name in this context, traversing\n * up the context hierarchy if the value is absent in this context's view.\n */\nContext.prototype.lookup = function lookup (name) {\n  var cache = this.cache;\n\n  var value;\n  if (cache.hasOwnProperty(name)) {\n    value = cache[name];\n  } else {\n    var context = this, intermediateValue, names, index, lookupHit = false;\n\n    while (context) {\n      if (name.indexOf('.') > 0) {\n        intermediateValue = context.view;\n        names = name.split('.');\n        index = 0;\n\n        /**\n         * Using the dot notion path in `name`, we descend through the\n         * nested objects.\n         *\n         * To be certain that the lookup has been successful, we have to\n         * check if the last object in the path actually has the property\n         * we are looking for. We store the result in `lookupHit`.\n         *\n         * This is specially necessary for when the value has been set to\n         * `undefined` and we want to avoid looking up parent contexts.\n         *\n         * In the case where dot notation is used, we consider the lookup\n         * to be successful even if the last \"object\" in the path is\n         * not actually an object but a primitive (e.g., a string, or an\n         * integer), because it is sometimes useful to access a property\n         * of an autoboxed primitive, such as the length of a string.\n         **/\n        while (intermediateValue != null && index < names.length) {\n          if (index === names.length - 1)\n            lookupHit = (\n              hasProperty(intermediateValue, names[index])\n              || primitiveHasOwnProperty(intermediateValue, names[index])\n            );\n\n          intermediateValue = intermediateValue[names[index++]];\n        }\n      } else {\n        intermediateValue = context.view[name];\n\n        /**\n         * Only checking against `hasProperty`, which always returns `false` if\n         * `context.view` is not an object. Deliberately omitting the check\n         * against `primitiveHasOwnProperty` if dot notation is not used.\n         *\n         * Consider this example:\n         * ```\n         * Mustache.render(\"The length of a football field is {{#length}}{{length}}{{/length}}.\", {length: \"100 yards\"})\n         * ```\n         *\n         * If we were to check also against `primitiveHasOwnProperty`, as we do\n         * in the dot notation case, then render call would return:\n         *\n         * \"The length of a football field is 9.\"\n         *\n         * rather than the expected:\n         *\n         * \"The length of a football field is 100 yards.\"\n         **/\n        lookupHit = hasProperty(context.view, name);\n      }\n\n      if (lookupHit) {\n        value = intermediateValue;\n        break;\n      }\n\n      context = context.parent;\n    }\n\n    cache[name] = value;\n  }\n\n  if (isFunction(value))\n    value = value.call(this.view);\n\n  return value;\n};\n\n/**\n * A Writer knows how to take a stream of tokens and render them to a\n * string, given a context. It also maintains a cache of templates to\n * avoid the need to parse the same template twice.\n */\nfunction Writer () {\n  this.templateCache = {\n    _cache: {},\n    set: function set (key, value) {\n      this._cache[key] = value;\n    },\n    get: function get (key) {\n      return this._cache[key];\n    },\n    clear: function clear () {\n      this._cache = {};\n    }\n  };\n}\n\n/**\n * Clears all cached templates in this writer.\n */\nWriter.prototype.clearCache = function clearCache () {\n  if (typeof this.templateCache !== 'undefined') {\n    this.templateCache.clear();\n  }\n};\n\n/**\n * Parses and caches the given `template` according to the given `tags` or\n * `mustache.tags` if `tags` is omitted,  and returns the array of tokens\n * that is generated from the parse.\n */\nWriter.prototype.parse = function parse (template, tags) {\n  var cache = this.templateCache;\n  var cacheKey = template + ':' + (tags || mustache.tags).join(':');\n  var isCacheEnabled = typeof cache !== 'undefined';\n  var tokens = isCacheEnabled ? cache.get(cacheKey) : undefined;\n\n  if (tokens == undefined) {\n    tokens = parseTemplate(template, tags);\n    isCacheEnabled && cache.set(cacheKey, tokens);\n  }\n  return tokens;\n};\n\n/**\n * High-level method that is used to render the given `template` with\n * the given `view`.\n *\n * The optional `partials` argument may be an object that contains the\n * names and templates of partials that are used in the template. It may\n * also be a function that is used to load partial templates on the fly\n * that takes a single argument: the name of the partial.\n *\n * If the optional `config` argument is given here, then it should be an\n * object with a `tags` attribute or an `escape` attribute or both.\n * If an array is passed, then it will be interpreted the same way as\n * a `tags` attribute on a `config` object.\n *\n * The `tags` attribute of a `config` object must be an array with two\n * string values: the opening and closing tags used in the template (e.g.\n * [ \"<%\", \"%>\" ]). The default is to mustache.tags.\n *\n * The `escape` attribute of a `config` object must be a function which\n * accepts a string as input and outputs a safely escaped string.\n * If an `escape` function is not provided, then an HTML-safe string\n * escaping function is used as the default.\n */\nWriter.prototype.render = function render (template, view, partials, config) {\n  var tags = this.getConfigTags(config);\n  var tokens = this.parse(template, tags);\n  var context = (view instanceof Context) ? view : new Context(view, undefined);\n  return this.renderTokens(tokens, context, partials, template, config);\n};\n\n/**\n * Low-level method that renders the given array of `tokens` using\n * the given `context` and `partials`.\n *\n * Note: The `originalTemplate` is only ever used to extract the portion\n * of the original template that was contained in a higher-order section.\n * If the template doesn't use higher-order sections, this argument may\n * be omitted.\n */\nWriter.prototype.renderTokens = function renderTokens (tokens, context, partials, originalTemplate, config) {\n  var buffer = '';\n\n  var token, symbol, value;\n  for (var i = 0, numTokens = tokens.length; i < numTokens; ++i) {\n    value = undefined;\n    token = tokens[i];\n    symbol = token[0];\n\n    if (symbol === '#') value = this.renderSection(token, context, partials, originalTemplate, config);\n    else if (symbol === '^') value = this.renderInverted(token, context, partials, originalTemplate, config);\n    else if (symbol === '>') value = this.renderPartial(token, context, partials, config);\n    else if (symbol === '&') value = this.unescapedValue(token, context);\n    else if (symbol === 'name') value = this.escapedValue(token, context, config);\n    else if (symbol === 'text') value = this.rawValue(token);\n\n    if (value !== undefined)\n      buffer += value;\n  }\n\n  return buffer;\n};\n\nWriter.prototype.renderSection = function renderSection (token, context, partials, originalTemplate, config) {\n  var self = this;\n  var buffer = '';\n  var value = context.lookup(token[1]);\n\n  // This function is used to render an arbitrary template\n  // in the current context by higher-order sections.\n  function subRender (template) {\n    return self.render(template, context, partials, config);\n  }\n\n  if (!value) return;\n\n  if (isArray(value)) {\n    for (var j = 0, valueLength = value.length; j < valueLength; ++j) {\n      buffer += this.renderTokens(token[4], context.push(value[j]), partials, originalTemplate, config);\n    }\n  } else if (typeof value === 'object' || typeof value === 'string' || typeof value === 'number') {\n    buffer += this.renderTokens(token[4], context.push(value), partials, originalTemplate, config);\n  } else if (isFunction(value)) {\n    if (typeof originalTemplate !== 'string')\n      throw new Error('Cannot use higher-order sections without the original template');\n\n    // Extract the portion of the original template that the section contains.\n    value = value.call(context.view, originalTemplate.slice(token[3], token[5]), subRender);\n\n    if (value != null)\n      buffer += value;\n  } else {\n    buffer += this.renderTokens(token[4], context, partials, originalTemplate, config);\n  }\n  return buffer;\n};\n\nWriter.prototype.renderInverted = function renderInverted (token, context, partials, originalTemplate, config) {\n  var value = context.lookup(token[1]);\n\n  // Use JavaScript's definition of falsy. Include empty arrays.\n  // See https://github.com/janl/mustache.js/issues/186\n  if (!value || (isArray(value) && value.length === 0))\n    return this.renderTokens(token[4], context, partials, originalTemplate, config);\n};\n\nWriter.prototype.indentPartial = function indentPartial (partial, indentation, lineHasNonSpace) {\n  var filteredIndentation = indentation.replace(/[^ \\t]/g, '');\n  var partialByNl = partial.split('\\n');\n  for (var i = 0; i < partialByNl.length; i++) {\n    if (partialByNl[i].length && (i > 0 || !lineHasNonSpace)) {\n      partialByNl[i] = filteredIndentation + partialByNl[i];\n    }\n  }\n  return partialByNl.join('\\n');\n};\n\nWriter.prototype.renderPartial = function renderPartial (token, context, partials, config) {\n  if (!partials) return;\n  var tags = this.getConfigTags(config);\n\n  var value = isFunction(partials) ? partials(token[1]) : partials[token[1]];\n  if (value != null) {\n    var lineHasNonSpace = token[6];\n    var tagIndex = token[5];\n    var indentation = token[4];\n    var indentedValue = value;\n    if (tagIndex == 0 && indentation) {\n      indentedValue = this.indentPartial(value, indentation, lineHasNonSpace);\n    }\n    var tokens = this.parse(indentedValue, tags);\n    return this.renderTokens(tokens, context, partials, indentedValue, config);\n  }\n};\n\nWriter.prototype.unescapedValue = function unescapedValue (token, context) {\n  var value = context.lookup(token[1]);\n  if (value != null)\n    return value;\n};\n\nWriter.prototype.escapedValue = function escapedValue (token, context, config) {\n  var escape = this.getConfigEscape(config) || mustache.escape;\n  var value = context.lookup(token[1]);\n  if (value != null)\n    return (typeof value === 'number' && escape === mustache.escape) ? String(value) : escape(value);\n};\n\nWriter.prototype.rawValue = function rawValue (token) {\n  return token[1];\n};\n\nWriter.prototype.getConfigTags = function getConfigTags (config) {\n  if (isArray(config)) {\n    return config;\n  }\n  else if (config && typeof config === 'object') {\n    return config.tags;\n  }\n  else {\n    return undefined;\n  }\n};\n\nWriter.prototype.getConfigEscape = function getConfigEscape (config) {\n  if (config && typeof config === 'object' && !isArray(config)) {\n    return config.escape;\n  }\n  else {\n    return undefined;\n  }\n};\n\nvar mustache = {\n  name: 'mustache.js',\n  version: '4.2.0',\n  tags: [ '{{', '}}' ],\n  clearCache: undefined,\n  escape: undefined,\n  parse: undefined,\n  render: undefined,\n  Scanner: undefined,\n  Context: undefined,\n  Writer: undefined,\n  /**\n   * Allows a user to override the default caching strategy, by providing an\n   * object with set, get and clear methods. This can also be used to disable\n   * the cache by setting it to the literal `undefined`.\n   */\n  set templateCache (cache) {\n    defaultWriter.templateCache = cache;\n  },\n  /**\n   * Gets the default or overridden caching object from the default writer.\n   */\n  get templateCache () {\n    return defaultWriter.templateCache;\n  }\n};\n\n// All high-level mustache.* functions use this writer.\nvar defaultWriter = new Writer();\n\n/**\n * Clears all cached templates in the default writer.\n */\nmustache.clearCache = function clearCache () {\n  return defaultWriter.clearCache();\n};\n\n/**\n * Parses and caches the given template in the default writer and returns the\n * array of tokens it contains. Doing this ahead of time avoids the need to\n * parse templates on the fly as they are rendered.\n */\nmustache.parse = function parse (template, tags) {\n  return defaultWriter.parse(template, tags);\n};\n\n/**\n * Renders the `template` with the given `view`, `partials`, and `config`\n * using the default writer.\n */\nmustache.render = function render (template, view, partials, config) {\n  if (typeof template !== 'string') {\n    throw new TypeError('Invalid template! Template should be a \"string\" ' +\n                        'but \"' + typeStr(template) + '\" was given as the first ' +\n                        'argument for mustache#render(template, view, partials)');\n  }\n\n  return defaultWriter.render(template, view, partials, config);\n};\n\n// Export the escaping function so that the user may override it.\n// See https://github.com/janl/mustache.js/issues/244\nmustache.escape = escapeHtml;\n\n// Export these mainly for testing, but also for advanced usage.\nmustache.Scanner = Scanner;\nmustache.Context = Context;\nmustache.Writer = Writer;\n\nexport default mustache;\n","import Mustache from \"mustache\";\nexport class TemplateValue {\n    constructor(template, state) {\n        this.template = template;\n        this.state = state;\n        this.ast = Mustache.parse(template);\n    }\n    getValue() {\n        if (this.value === undefined) {\n            this.value = Mustache.render(this.template, this.state);\n        }\n        return this.value;\n    }\n    onChange(callback) {\n        const subscriptions = [];\n        for (const variableName of this.getUsedVariables().values()) {\n            subscriptions.push(this.state.onVariableChange(variableName).subscribe(() => {\n                const newValue = Mustache.render(this.template, this.state);\n                if (newValue !== this.value) {\n                    this.value = newValue;\n                    callback(this.value);\n                }\n            }));\n        }\n        return {\n            unsubscribe: () => {\n                for (const subscription of subscriptions) {\n                    subscription.unsubscribe();\n                }\n            },\n        };\n    }\n    isPureString() {\n        return this.ast.length === 0 || (this.ast.length === 1 && this.ast[0][0] === \"text\");\n    }\n    getUsedVariables() {\n        const variables = new Set();\n        this.recursiveGetUsedVariables(this.ast, variables);\n        return variables;\n    }\n    recursiveGetUsedVariables(ast, variables) {\n        for (const token of ast) {\n            const type = token[0];\n            const name = token[1];\n            const subAst = token[4];\n            if ([\"name\", \"&\", \"#\", \"^\"].includes(type)) {\n                variables.add(name);\n            }\n            if (subAst !== undefined && typeof subAst !== \"string\") {\n                this.recursiveGetUsedVariables(subAst, variables);\n            }\n        }\n    }\n}\n//# sourceMappingURL=TemplateValue.js.map","import { getLayersMap } from \"../LayersFlattener\";\nimport { TemplateValue } from \"../TemplateValue\";\nimport { getAreaObject } from \"../AreaObject\";\nexport async function initPropertiesTemplatesArea() {\n    var _a;\n    const areas = await getAreaObject();\n    for (const area of areas) {\n        const properties = (_a = area.properties) !== null && _a !== void 0 ? _a : [];\n        for (const property of properties) {\n            if (property.type === \"int\" ||\n                property.type === \"bool\" ||\n                property.type === \"object\" ||\n                typeof property.value !== \"string\") {\n                continue;\n            }\n            const template = new TemplateValue(property.value, WA.state);\n            if (template.isPureString()) {\n                continue;\n            }\n            const newValue = template.getValue();\n            await setPropertyArea(area.name, property.name, newValue);\n            template.onChange(async (newValue) => {\n                await setPropertyArea(area.name, property.name, newValue);\n            });\n        }\n    }\n}\nexport async function initPropertiesTemplates() {\n    var _a;\n    const layers = await getLayersMap();\n    for (const [layerName, layer] of layers.entries()) {\n        if (layer.type !== \"objectgroup\") {\n            const properties = (_a = layer.properties) !== null && _a !== void 0 ? _a : [];\n            for (const property of properties) {\n                if (property.type === \"int\" ||\n                    property.type === \"bool\" ||\n                    property.type === \"object\" ||\n                    typeof property.value !== \"string\") {\n                    continue;\n                }\n                const template = new TemplateValue(property.value, WA.state);\n                if (template.isPureString()) {\n                    continue;\n                }\n                const newValue = template.getValue();\n                setProperty(layerName, property.name, newValue);\n                template.onChange((newValue) => {\n                    setProperty(layerName, property.name, newValue);\n                });\n            }\n        }\n    }\n}\nasync function setPropertyArea(areaName, propertyName, value) {\n    console.log(areaName);\n    const area = await WA.room.area.get(areaName);\n    area.setProperty(propertyName, value);\n}\nfunction setProperty(layerName, propertyName, value) {\n    WA.room.setProperty(layerName, propertyName, value);\n    if (propertyName === \"visible\") {\n        if (value) {\n            WA.room.showLayer(layerName);\n        }\n        else {\n            WA.room.hideLayer(layerName);\n        }\n    }\n}\n//# sourceMappingURL=properties_templates.js.map","export const workadventureAssetsHtmlUrl = \"https://admin.workadventu.re/html\";\n//# sourceMappingURL=workadventure_assets_url.js.map","import { getVariables } from \"../VariablesExtra\";\nimport { getLayersMap } from \"../LayersFlattener\";\nimport { Properties } from \"../Properties\";\nimport { findLayersBoundaries } from \"../LayersExtra\";\nimport { defaultAssetsUrl } from \"./default_assets_url\";\nimport { workadventureAssetsHtmlUrl } from \"./workadventure_assets_url\";\nimport { getAreaObject } from \"../AreaObject\";\nlet layersMap;\nlet playerX = 0;\nlet playerY = 0;\nfunction updateDoorLayers(variable) {\n    if (WA.state[variable.name]) {\n        let layers = variable.properties.mustGetString(\"openLayer\");\n        for (const layer of layers.split(\"\\n\")) {\n            WA.room.showLayer(layer);\n        }\n        layers = variable.properties.mustGetString(\"closeLayer\");\n        for (const layer of layers.split(\"\\n\")) {\n            WA.room.hideLayer(layer);\n        }\n    }\n    else {\n        let layers = variable.properties.mustGetString(\"openLayer\");\n        for (const layer of layers.split(\"\\n\")) {\n            WA.room.hideLayer(layer);\n        }\n        layers = variable.properties.mustGetString(\"closeLayer\");\n        for (const layer of layers.split(\"\\n\")) {\n            WA.room.showLayer(layer);\n        }\n    }\n}\nfunction playOpenSound(variable) {\n    const url = variable.properties.getString(\"openSound\");\n    const radius = variable.properties.getNumber(\"soundRadius\");\n    let volume = 1;\n    if (radius) {\n        const distance = getDistance(variable.properties.mustGetString(\"openLayer\").split(\"\\n\"));\n        if (distance > radius) {\n            return;\n        }\n        volume = 1 - distance / radius;\n    }\n    if (url) {\n        WA.sound.loadSound(url).play({\n            volume,\n        });\n    }\n}\nfunction playCloseSound(variable) {\n    const url = variable.properties.getString(\"closeSound\");\n    const radius = variable.properties.getNumber(\"soundRadius\");\n    let volume = 1;\n    if (radius) {\n        const distance = getDistance(variable.properties.mustGetString(\"closeLayer\").split(\"\\n\"));\n        if (distance > radius) {\n            return;\n        }\n        volume = 1 - distance / radius;\n    }\n    if (url) {\n        WA.sound.loadSound(url).play({\n            volume,\n        });\n    }\n}\nfunction getTileLayers(layerNames) {\n    return layerNames\n        .map((layerName) => layersMap.get(layerName))\n        .filter((layer) => (layer === null || layer === void 0 ? void 0 : layer.type) === \"tilelayer\");\n}\nfunction getDistance(layerNames) {\n    const layers = getTileLayers(layerNames);\n    const boundaries = findLayersBoundaries(layers);\n    const xLayer = ((boundaries.right - boundaries.left) / 2 + boundaries.left) * 32;\n    const yLayer = ((boundaries.bottom - boundaries.top) / 2 + boundaries.top) * 32;\n    return Math.sqrt(Math.pow(playerX - xLayer, 2) + Math.pow(playerY - yLayer, 2));\n}\nfunction initDoor(variable) {\n    WA.state.onVariableChange(variable.name).subscribe(() => {\n        if (WA.state[variable.name]) {\n            playOpenSound(variable);\n        }\n        else {\n            playCloseSound(variable);\n        }\n        updateDoorLayers(variable);\n    });\n    updateDoorLayers(variable);\n}\nfunction initDoorstep(doorstepZone, doorVariable, properties, assetsUrl) {\n    const name = doorstepZone.name;\n    let actionMessage = undefined;\n    let keypadWebsite = undefined;\n    let inZone = false;\n    const tag = properties.getString(\"tag\");\n    let allowed = true;\n    if (tag && !WA.player.tags.includes(tag)) {\n        allowed = false;\n    }\n    const accessRestricted = !!tag;\n    function displayCloseDoorMessage() {\n        var _a;\n        if (actionMessage) {\n            actionMessage.remove();\n        }\n        actionMessage = WA.ui.displayActionMessage({\n            message: (_a = properties.getString(\"closeTriggerMessage\")) !== null && _a !== void 0 ? _a : \"Press SPACE to close the door\",\n            callback: () => {\n                WA.state[doorVariable.name] = false;\n                displayOpenDoorMessage();\n            },\n        });\n    }\n    function displayOpenDoorMessage() {\n        var _a;\n        if (actionMessage) {\n            actionMessage.remove();\n        }\n        actionMessage = WA.ui.displayActionMessage({\n            message: (_a = properties.getString(\"openTriggerMessage\")) !== null && _a !== void 0 ? _a : \"Press SPACE to open the door\",\n            callback: () => {\n                WA.state[doorVariable.name] = true;\n                displayCloseDoorMessage();\n            },\n        });\n    }\n    function openKeypad() {\n        let boundaries;\n        if (doorstepZone.type === \"tilelayer\") {\n            boundaries = findLayersBoundaries(getTileLayers(doorVariable.properties.mustGetString(\"closeLayer\").split(\"\\n\")));\n        }\n        else {\n            if (doorstepZone.x === undefined ||\n                doorstepZone.y === undefined ||\n                doorstepZone.width === undefined ||\n                doorstepZone.height === undefined) {\n                throw new Error(`Doorstep zone \"${doorstepZone.name}\" is missing x, y, width or height`);\n            }\n            boundaries = {\n                top: doorstepZone.y,\n                left: doorstepZone.x,\n                right: doorstepZone.x + doorstepZone.width,\n                bottom: doorstepZone.y + doorstepZone.height,\n            };\n        }\n        keypadWebsite = WA.room.website.create({\n            name: \"doorKeypad\" + name,\n            url: assetsUrl + \"/keypad.html#\" + encodeURIComponent(name),\n            position: {\n                x: boundaries.right * 32,\n                y: boundaries.top * 32,\n                width: 32 * 3,\n                height: 32 * 4,\n            },\n            allowApi: true,\n        });\n    }\n    function closeKeypad() {\n        if (keypadWebsite) {\n            WA.room.website.delete(keypadWebsite.name);\n            keypadWebsite = undefined;\n        }\n    }\n    function onEnter() {\n        inZone = true;\n        if (properties.getBoolean(\"autoOpen\") && allowed) {\n            WA.state[doorVariable.name] = true;\n            return;\n        }\n        if (!WA.state[doorVariable.name] &&\n            ((accessRestricted && !allowed) || !accessRestricted) &&\n            (properties.getString(\"code\") || properties.getString(\"codeVariable\"))) {\n            openKeypad();\n            return;\n        }\n        if (!allowed) {\n            return;\n        }\n        if (WA.state[doorVariable.name]) {\n            displayCloseDoorMessage();\n        }\n        else {\n            displayOpenDoorMessage();\n        }\n    }\n    function onLeave() {\n        inZone = false;\n        if (properties.getBoolean(\"autoClose\")) {\n            WA.state[doorVariable.name] = false;\n        }\n        if (actionMessage) {\n            actionMessage.remove();\n        }\n        closeKeypad();\n    }\n    if (doorstepZone.type === \"tilelayer\") {\n        WA.room.onEnterLayer(name).subscribe(onEnter);\n        WA.room.onLeaveLayer(name).subscribe(onLeave);\n    }\n    else {\n        WA.room.area.onEnter(name).subscribe(onEnter);\n        WA.room.area.onLeave(name).subscribe(onLeave);\n    }\n    WA.state.onVariableChange(doorVariable.name).subscribe(() => {\n        if (inZone) {\n            if (!properties.getBoolean(\"autoClose\") && WA.state[doorVariable.name] === true) {\n                displayCloseDoorMessage();\n            }\n            if (keypadWebsite && WA.state[doorVariable.name] === true) {\n                closeKeypad();\n            }\n            if (!properties.getBoolean(\"autoOpen\") && WA.state[doorVariable.name] === false) {\n                displayOpenDoorMessage();\n            }\n        }\n    });\n}\nfunction playBellSound(variable) {\n    const url = variable.properties.mustGetString(\"bellSound\");\n    const radius = variable.properties.getNumber(\"soundRadius\");\n    let volume = 1;\n    if (radius) {\n        const distance = Math.sqrt(Math.pow(variable.x - playerX, 2) + Math.pow(variable.y - playerY, 2));\n        if (distance > radius) {\n            return;\n        }\n        volume = 1 - distance / radius;\n    }\n    WA.sound.loadSound(url).play({\n        volume,\n    });\n}\nfunction initBell(variable) {\n    if (WA.state[variable.name] === undefined) {\n        WA.state[variable.name] = 0;\n    }\n    WA.state.onVariableChange(variable.name).subscribe(() => {\n        if (WA.state[variable.name]) {\n            playBellSound(variable);\n        }\n    });\n}\nfunction initBellLayer(bellVariable, properties, bellZone) {\n    let popup = undefined;\n    const bellPopupName = properties.getString(\"bellPopup\");\n    if (bellZone.type === \"tilelayer\") {\n        const layerName = bellZone.name;\n        WA.room.onEnterLayer(layerName).subscribe(() => {\n            var _a;\n            if (!bellPopupName) {\n                WA.state[bellVariable] = WA.state[bellVariable] + 1;\n            }\n            else {\n                popup = WA.ui.openPopup(bellPopupName, \"\", [\n                    {\n                        label: (_a = properties.getString(\"bellButtonText\")) !== null && _a !== void 0 ? _a : \"Ring\",\n                        callback: () => {\n                            WA.state[bellVariable] = WA.state[bellVariable] + 1;\n                        },\n                    },\n                ]);\n            }\n        });\n        WA.room.onLeaveLayer(layerName).subscribe(() => {\n            if (popup) {\n                popup.close();\n                popup = undefined;\n            }\n        });\n    }\n    else {\n        const objectName = bellZone.name;\n        WA.room.area.onEnter(objectName).subscribe(() => {\n            var _a;\n            if (!bellPopupName) {\n                WA.state[bellVariable] = WA.state[bellVariable] + 1;\n            }\n            else {\n                popup = WA.ui.openPopup(bellPopupName, \"\", [\n                    {\n                        label: (_a = properties.getString(\"bellButtonText\")) !== null && _a !== void 0 ? _a : \"Ring\",\n                        callback: () => {\n                            WA.state[bellVariable] = WA.state[bellVariable] + 1;\n                        },\n                    },\n                ]);\n            }\n        });\n        WA.room.area.onLeave(objectName).subscribe(() => {\n            if (popup) {\n                popup.close();\n                popup = undefined;\n            }\n        });\n    }\n}\nexport async function initDoors(assetsUrl) {\n    assetsUrl = assetsUrl !== null && assetsUrl !== void 0 ? assetsUrl : (workadventureAssetsHtmlUrl || defaultAssetsUrl);\n    const variables = await getVariables();\n    layersMap = await getLayersMap();\n    for (const variable of variables.values()) {\n        if (variable.properties.get(\"door\")) {\n            initDoor(variable);\n        }\n        if (variable.properties.get(\"bell\")) {\n            initBell(variable);\n        }\n    }\n    for (const layer of layersMap.values()) {\n        const properties = new Properties(layer.properties);\n        const doorVariableName = properties.getString(\"doorVariable\");\n        if (doorVariableName && layer.type === \"tilelayer\") {\n            const doorVariable = variables.get(doorVariableName);\n            if (doorVariable === undefined) {\n                throw new Error('Cannot find variable \"' +\n                    doorVariableName +\n                    '\" referred in the \"doorVariable\" property of layer \"' +\n                    layer.name +\n                    '\"');\n            }\n            initDoorstep(layer, doorVariable, properties, assetsUrl);\n        }\n        const bellVariable = properties.getString(\"bellVariable\");\n        if (bellVariable && layer.type === \"tilelayer\") {\n            initBellLayer(bellVariable, properties, layer);\n        }\n    }\n    for (const object of await getAreaObject()) {\n        const properties = new Properties(object.properties);\n        const doorVariableName = properties.getString(\"doorVariable\");\n        if (doorVariableName) {\n            const doorVariable = variables.get(doorVariableName);\n            if (doorVariable === undefined) {\n                throw new Error('Cannot find variable \"' +\n                    doorVariableName +\n                    '\" referred in the \"doorVariable\" property of object \"' +\n                    object.name +\n                    '\"');\n            }\n            initDoorstep(object, doorVariable, properties, assetsUrl);\n        }\n        const bellVariable = properties.getString(\"bellVariable\");\n        if (bellVariable) {\n            initBellLayer(bellVariable, properties, object);\n        }\n    }\n    WA.player.onPlayerMove((moveEvent) => {\n        playerX = moveEvent.x;\n        playerY = moveEvent.y;\n    });\n}\n//# sourceMappingURL=doors.js.map","export function initVariableActionLayer(properties, layerName) {\n    const variableName = properties.getString(\"bindVariable\");\n    if (variableName) {\n        const enterValue = properties.get(\"enterValue\");\n        const leaveValue = properties.get(\"leaveValue\");\n        const triggerMessage = properties.getString(\"triggerMessage\");\n        const tag = properties.getString(\"tag\");\n        setupVariableActionLayer(variableName, layerName, enterValue, leaveValue, triggerMessage, tag);\n    }\n}\nfunction setupVariableActionLayer(variableName, layerName, enterValue, leaveValue, triggerMessage, tag) {\n    if (tag && !WA.player.tags.includes(tag)) {\n        return;\n    }\n    if (enterValue !== undefined) {\n        WA.room.onEnterLayer(layerName).subscribe(() => {\n            if (triggerMessage) {\n            }\n            else {\n                WA.state[variableName] = enterValue;\n            }\n        });\n    }\n    if (leaveValue !== undefined) {\n        WA.room.onLeaveLayer(layerName).subscribe(() => {\n            WA.state[variableName] = leaveValue;\n        });\n    }\n}\n//# sourceMappingURL=variable_actions.js.map","import { getLayersMap } from \"../LayersFlattener\";\nimport { Properties } from \"../Properties\";\nimport { initVariableActionLayer } from \"./variable_actions\";\nexport async function initSpecialProperties() {\n    const layers = await getLayersMap();\n    for (const layer of layers.values()) {\n        const properties = new Properties(layer.properties);\n        initVariableActionLayer(properties, layer.name);\n    }\n}\n//# sourceMappingURL=special_properties.js.map","import { Properties } from \"../Properties\";\nimport { defaultAssetsUrl } from \"./default_assets_url\";\nimport { getLayersMap } from \"../LayersFlattener\";\nimport { openConfig } from \"../VariablesExtra\";\nlet layersMap;\nexport async function initConfiguration(assetsUrl) {\n    const map = (await WA.room.getTiledMap());\n    assetsUrl = assetsUrl !== null && assetsUrl !== void 0 ? assetsUrl : defaultAssetsUrl;\n    layersMap = await getLayersMap();\n    const configurationLayer = map.layers.find((layer) => layer.name === \"configuration\");\n    if (configurationLayer) {\n        const properties = new Properties(configurationLayer.properties);\n        const tag = properties.getString(\"tag\");\n        if (!tag || WA.player.tags.includes(tag)) {\n            WA.ui.registerMenuCommand(\"Configure the room\", () => {\n                WA.nav.openCoWebSite(assetsUrl + \"/configuration.html\", true);\n            });\n        }\n        for (const layer of layersMap.values()) {\n            const properties = new Properties(layer.properties);\n            const openConfigVariables = properties.getString(\"openConfig\");\n            if (openConfigVariables && layer.type === \"tilelayer\") {\n                initLocalConfigurationPanel(openConfigVariables.split(\",\"), layer.name, properties);\n            }\n        }\n    }\n}\nfunction initLocalConfigurationPanel(openConfigVariables, layerName, properties) {\n    let actionMessage = undefined;\n    const tag = properties.getString(\"openConfigAdminTag\");\n    let allowedByTag = true;\n    if (tag && !WA.player.tags.includes(tag)) {\n        allowedByTag = false;\n    }\n    function displayConfigurationMessage() {\n        var _a;\n        if (actionMessage) {\n            actionMessage.remove();\n        }\n        actionMessage = WA.ui.displayActionMessage({\n            message: (_a = properties.getString(\"openConfigTriggerMessage\")) !== null && _a !== void 0 ? _a : \"Press SPACE or touch here to configure\",\n            callback: () => openConfig(openConfigVariables),\n        });\n    }\n    function closeConfigurationPanel() {\n        WA.nav.closeCoWebSite();\n    }\n    WA.room.onEnterLayer(layerName).subscribe(() => {\n        const openConfigTriggerValue = properties.getString(\"openConfigTrigger\");\n        if (allowedByTag) {\n            if (openConfigTriggerValue && openConfigTriggerValue === \"onaction\") {\n                displayConfigurationMessage();\n            }\n            else {\n                openConfig(openConfigVariables);\n            }\n        }\n    });\n    WA.room.onLeaveLayer(layerName).subscribe(() => {\n        if (actionMessage) {\n            actionMessage.remove();\n            closeConfigurationPanel();\n        }\n        else {\n            closeConfigurationPanel();\n        }\n    });\n}\n//# sourceMappingURL=configuration.js.map","import { initDoors } from \"./Features/doors\";\nimport { initSpecialProperties } from \"./Features/special_properties\";\nimport { initConfiguration } from \"./Features/configuration\";\nimport { initPropertiesTemplates, initPropertiesTemplatesArea, } from \"./Features/properties_templates\";\nexport function bootstrapExtra() {\n    return WA.onInit()\n        .then(() => {\n        initDoors().catch((e) => console.error(e));\n        initSpecialProperties().catch((e) => console.error(e));\n        initConfiguration().catch((e) => console.error(e));\n        initPropertiesTemplates().catch((e) => console.error(e));\n        initPropertiesTemplatesArea().catch((e) => console.error(e));\n    })\n        .catch((e) => console.error(e));\n}\n//# sourceMappingURL=init.js.map","import {getLayersMap, Properties} from \"@workadventure/scripting-api-extra/dist\";\n\n\nlet placesPromise: Promise<Map<string, string|undefined>>|undefined;\n\nexport async function findPlaces(): Promise<Map<string, string|undefined>> {\n    if (placesPromise !== undefined) {\n        return placesPromise;\n    }\n\n    return new Promise(async (resolve) => {\n        const zones = new Map<string, string|undefined>();\n\n        const layers = await getLayersMap();\n        for (const layer of layers.values()) {\n            if (layer.type === 'objectgroup') {\n                for (const object of layer.objects) {\n                    if (object.type === 'area' || object.class === 'area') {\n                        const properties = new Properties(object.properties);\n                        if (properties.getBoolean('ai-zone') === true) {\n                            zones.set(object.name, properties.getString('description'));\n                        }\n                    }\n                }\n            }\n        }\n\n        resolve(zones);\n    });\n}\n\nexport async function generatePlacesPrompt(): Promise<string> {\n    const zones = await findPlaces();\n\n    let prompt = \"In your map, you can find the following places:\\n\\n\";\n\n    for (const [name, description] of zones.entries()) {\n        prompt += `- ${name}: ${description}\\n`;\n    }\n\n    return prompt;\n}\n\nexport async function updateMyPlace(): Promise<void> {\n    const places = await findPlaces();\n    for (const areaName of places.keys()) {\n        WA.room.area.onEnter(areaName).subscribe(() => {\n            WA.player.state.saveVariable('currentPlace', areaName, {\n                persist: false,\n                public: true,\n            });\n        });\n    }\n}\n","const PACKET_TYPES = Object.create(null); // no Map = no polyfill\nPACKET_TYPES[\"open\"] = \"0\";\nPACKET_TYPES[\"close\"] = \"1\";\nPACKET_TYPES[\"ping\"] = \"2\";\nPACKET_TYPES[\"pong\"] = \"3\";\nPACKET_TYPES[\"message\"] = \"4\";\nPACKET_TYPES[\"upgrade\"] = \"5\";\nPACKET_TYPES[\"noop\"] = \"6\";\nconst PACKET_TYPES_REVERSE = Object.create(null);\nObject.keys(PACKET_TYPES).forEach((key) => {\n    PACKET_TYPES_REVERSE[PACKET_TYPES[key]] = key;\n});\nconst ERROR_PACKET = { type: \"error\", data: \"parser error\" };\nexport { PACKET_TYPES, PACKET_TYPES_REVERSE, ERROR_PACKET };\n","import { PACKET_TYPES } from \"./commons.js\";\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        Object.prototype.toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\n// ArrayBuffer.isView method is not defined in IE10\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj && obj.buffer instanceof ArrayBuffer;\n};\nconst encodePacket = ({ type, data }, supportsBinary, callback) => {\n    if (withNativeBlob && data instanceof Blob) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(data, callback);\n        }\n    }\n    else if (withNativeArrayBuffer &&\n        (data instanceof ArrayBuffer || isView(data))) {\n        if (supportsBinary) {\n            return callback(data);\n        }\n        else {\n            return encodeBlobAsBase64(new Blob([data]), callback);\n        }\n    }\n    // plain string\n    return callback(PACKET_TYPES[type] + (data || \"\"));\n};\nconst encodeBlobAsBase64 = (data, callback) => {\n    const fileReader = new FileReader();\n    fileReader.onload = function () {\n        const content = fileReader.result.split(\",\")[1];\n        callback(\"b\" + (content || \"\"));\n    };\n    return fileReader.readAsDataURL(data);\n};\nfunction toArray(data) {\n    if (data instanceof Uint8Array) {\n        return data;\n    }\n    else if (data instanceof ArrayBuffer) {\n        return new Uint8Array(data);\n    }\n    else {\n        return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);\n    }\n}\nlet TEXT_ENCODER;\nexport function encodePacketToBinary(packet, callback) {\n    if (withNativeBlob && packet.data instanceof Blob) {\n        return packet.data.arrayBuffer().then(toArray).then(callback);\n    }\n    else if (withNativeArrayBuffer &&\n        (packet.data instanceof ArrayBuffer || isView(packet.data))) {\n        return callback(toArray(packet.data));\n    }\n    encodePacket(packet, false, (encoded) => {\n        if (!TEXT_ENCODER) {\n            TEXT_ENCODER = new TextEncoder();\n        }\n        callback(TEXT_ENCODER.encode(encoded));\n    });\n}\nexport { encodePacket };\n","// imported from https://github.com/socketio/base64-arraybuffer\nconst chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n// Use a lookup table to find the index.\nconst lookup = typeof Uint8Array === 'undefined' ? [] : new Uint8Array(256);\nfor (let i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n}\nexport const encode = (arraybuffer) => {\n    let bytes = new Uint8Array(arraybuffer), i, len = bytes.length, base64 = '';\n    for (i = 0; i < len; i += 3) {\n        base64 += chars[bytes[i] >> 2];\n        base64 += chars[((bytes[i] & 3) << 4) | (bytes[i + 1] >> 4)];\n        base64 += chars[((bytes[i + 1] & 15) << 2) | (bytes[i + 2] >> 6)];\n        base64 += chars[bytes[i + 2] & 63];\n    }\n    if (len % 3 === 2) {\n        base64 = base64.substring(0, base64.length - 1) + '=';\n    }\n    else if (len % 3 === 1) {\n        base64 = base64.substring(0, base64.length - 2) + '==';\n    }\n    return base64;\n};\nexport const decode = (base64) => {\n    let bufferLength = base64.length * 0.75, len = base64.length, i, p = 0, encoded1, encoded2, encoded3, encoded4;\n    if (base64[base64.length - 1] === '=') {\n        bufferLength--;\n        if (base64[base64.length - 2] === '=') {\n            bufferLength--;\n        }\n    }\n    const arraybuffer = new ArrayBuffer(bufferLength), bytes = new Uint8Array(arraybuffer);\n    for (i = 0; i < len; i += 4) {\n        encoded1 = lookup[base64.charCodeAt(i)];\n        encoded2 = lookup[base64.charCodeAt(i + 1)];\n        encoded3 = lookup[base64.charCodeAt(i + 2)];\n        encoded4 = lookup[base64.charCodeAt(i + 3)];\n        bytes[p++] = (encoded1 << 2) | (encoded2 >> 4);\n        bytes[p++] = ((encoded2 & 15) << 4) | (encoded3 >> 2);\n        bytes[p++] = ((encoded3 & 3) << 6) | (encoded4 & 63);\n    }\n    return arraybuffer;\n};\n","import { ERROR_PACKET, PACKET_TYPES_REVERSE, } from \"./commons.js\";\nimport { decode } from \"./contrib/base64-arraybuffer.js\";\nconst withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nexport const decodePacket = (encodedPacket, binaryType) => {\n    if (typeof encodedPacket !== \"string\") {\n        return {\n            type: \"message\",\n            data: mapBinary(encodedPacket, binaryType),\n        };\n    }\n    const type = encodedPacket.charAt(0);\n    if (type === \"b\") {\n        return {\n            type: \"message\",\n            data: decodeBase64Packet(encodedPacket.substring(1), binaryType),\n        };\n    }\n    const packetType = PACKET_TYPES_REVERSE[type];\n    if (!packetType) {\n        return ERROR_PACKET;\n    }\n    return encodedPacket.length > 1\n        ? {\n            type: PACKET_TYPES_REVERSE[type],\n            data: encodedPacket.substring(1),\n        }\n        : {\n            type: PACKET_TYPES_REVERSE[type],\n        };\n};\nconst decodeBase64Packet = (data, binaryType) => {\n    if (withNativeArrayBuffer) {\n        const decoded = decode(data);\n        return mapBinary(decoded, binaryType);\n    }\n    else {\n        return { base64: true, data }; // fallback for old browsers\n    }\n};\nconst mapBinary = (data, binaryType) => {\n    switch (binaryType) {\n        case \"blob\":\n            if (data instanceof Blob) {\n                // from WebSocket + binaryType \"blob\"\n                return data;\n            }\n            else {\n                // from HTTP long-polling or WebTransport\n                return new Blob([data]);\n            }\n        case \"arraybuffer\":\n        default:\n            if (data instanceof ArrayBuffer) {\n                // from HTTP long-polling (base64) or WebSocket + binaryType \"arraybuffer\"\n                return data;\n            }\n            else {\n                // from WebTransport (Uint8Array)\n                return data.buffer;\n            }\n    }\n};\n","import { encodePacket, encodePacketToBinary } from \"./encodePacket.js\";\nimport { decodePacket } from \"./decodePacket.js\";\nimport { ERROR_PACKET, } from \"./commons.js\";\nconst SEPARATOR = String.fromCharCode(30); // see https://en.wikipedia.org/wiki/Delimiter#ASCII_delimited_text\nconst encodePayload = (packets, callback) => {\n    // some packets may be added to the array while encoding, so the initial length must be saved\n    const length = packets.length;\n    const encodedPackets = new Array(length);\n    let count = 0;\n    packets.forEach((packet, i) => {\n        // force base64 encoding for binary packets\n        encodePacket(packet, false, (encodedPacket) => {\n            encodedPackets[i] = encodedPacket;\n            if (++count === length) {\n                callback(encodedPackets.join(SEPARATOR));\n            }\n        });\n    });\n};\nconst decodePayload = (encodedPayload, binaryType) => {\n    const encodedPackets = encodedPayload.split(SEPARATOR);\n    const packets = [];\n    for (let i = 0; i < encodedPackets.length; i++) {\n        const decodedPacket = decodePacket(encodedPackets[i], binaryType);\n        packets.push(decodedPacket);\n        if (decodedPacket.type === \"error\") {\n            break;\n        }\n    }\n    return packets;\n};\nexport function createPacketEncoderStream() {\n    return new TransformStream({\n        transform(packet, controller) {\n            encodePacketToBinary(packet, (encodedPacket) => {\n                const payloadLength = encodedPacket.length;\n                let header;\n                // inspired by the WebSocket format: https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers#decoding_payload_length\n                if (payloadLength < 126) {\n                    header = new Uint8Array(1);\n                    new DataView(header.buffer).setUint8(0, payloadLength);\n                }\n                else if (payloadLength < 65536) {\n                    header = new Uint8Array(3);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 126);\n                    view.setUint16(1, payloadLength);\n                }\n                else {\n                    header = new Uint8Array(9);\n                    const view = new DataView(header.buffer);\n                    view.setUint8(0, 127);\n                    view.setBigUint64(1, BigInt(payloadLength));\n                }\n                // first bit indicates whether the payload is plain text (0) or binary (1)\n                if (packet.data && typeof packet.data !== \"string\") {\n                    header[0] |= 0x80;\n                }\n                controller.enqueue(header);\n                controller.enqueue(encodedPacket);\n            });\n        },\n    });\n}\nlet TEXT_DECODER;\nfunction totalLength(chunks) {\n    return chunks.reduce((acc, chunk) => acc + chunk.length, 0);\n}\nfunction concatChunks(chunks, size) {\n    if (chunks[0].length === size) {\n        return chunks.shift();\n    }\n    const buffer = new Uint8Array(size);\n    let j = 0;\n    for (let i = 0; i < size; i++) {\n        buffer[i] = chunks[0][j++];\n        if (j === chunks[0].length) {\n            chunks.shift();\n            j = 0;\n        }\n    }\n    if (chunks.length && j < chunks[0].length) {\n        chunks[0] = chunks[0].slice(j);\n    }\n    return buffer;\n}\nexport function createPacketDecoderStream(maxPayload, binaryType) {\n    if (!TEXT_DECODER) {\n        TEXT_DECODER = new TextDecoder();\n    }\n    const chunks = [];\n    let state = 0 /* State.READ_HEADER */;\n    let expectedLength = -1;\n    let isBinary = false;\n    return new TransformStream({\n        transform(chunk, controller) {\n            chunks.push(chunk);\n            while (true) {\n                if (state === 0 /* State.READ_HEADER */) {\n                    if (totalLength(chunks) < 1) {\n                        break;\n                    }\n                    const header = concatChunks(chunks, 1);\n                    isBinary = (header[0] & 0x80) === 0x80;\n                    expectedLength = header[0] & 0x7f;\n                    if (expectedLength < 126) {\n                        state = 3 /* State.READ_PAYLOAD */;\n                    }\n                    else if (expectedLength === 126) {\n                        state = 1 /* State.READ_EXTENDED_LENGTH_16 */;\n                    }\n                    else {\n                        state = 2 /* State.READ_EXTENDED_LENGTH_64 */;\n                    }\n                }\n                else if (state === 1 /* State.READ_EXTENDED_LENGTH_16 */) {\n                    if (totalLength(chunks) < 2) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 2);\n                    expectedLength = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length).getUint16(0);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else if (state === 2 /* State.READ_EXTENDED_LENGTH_64 */) {\n                    if (totalLength(chunks) < 8) {\n                        break;\n                    }\n                    const headerArray = concatChunks(chunks, 8);\n                    const view = new DataView(headerArray.buffer, headerArray.byteOffset, headerArray.length);\n                    const n = view.getUint32(0);\n                    if (n > Math.pow(2, 53 - 32) - 1) {\n                        // the maximum safe integer in JavaScript is 2^53 - 1\n                        controller.enqueue(ERROR_PACKET);\n                        break;\n                    }\n                    expectedLength = n * Math.pow(2, 32) + view.getUint32(4);\n                    state = 3 /* State.READ_PAYLOAD */;\n                }\n                else {\n                    if (totalLength(chunks) < expectedLength) {\n                        break;\n                    }\n                    const data = concatChunks(chunks, expectedLength);\n                    controller.enqueue(decodePacket(isBinary ? data : TEXT_DECODER.decode(data), binaryType));\n                    state = 0 /* State.READ_HEADER */;\n                }\n                if (expectedLength === 0 || expectedLength > maxPayload) {\n                    controller.enqueue(ERROR_PACKET);\n                    break;\n                }\n            }\n        },\n    });\n}\nexport const protocol = 4;\nexport { encodePacket, encodePayload, decodePacket, decodePayload, };\n","/**\n * Initialize a new `Emitter`.\n *\n * @api public\n */\n\nexport function Emitter(obj) {\n  if (obj) return mixin(obj);\n}\n\n/**\n * Mixin the emitter properties.\n *\n * @param {Object} obj\n * @return {Object}\n * @api private\n */\n\nfunction mixin(obj) {\n  for (var key in Emitter.prototype) {\n    obj[key] = Emitter.prototype[key];\n  }\n  return obj;\n}\n\n/**\n * Listen on the given `event` with `fn`.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.on =\nEmitter.prototype.addEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n  (this._callbacks['$' + event] = this._callbacks['$' + event] || [])\n    .push(fn);\n  return this;\n};\n\n/**\n * Adds an `event` listener that will be invoked a single\n * time then automatically removed.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.once = function(event, fn){\n  function on() {\n    this.off(event, on);\n    fn.apply(this, arguments);\n  }\n\n  on.fn = fn;\n  this.on(event, on);\n  return this;\n};\n\n/**\n * Remove the given callback for `event` or all\n * registered callbacks.\n *\n * @param {String} event\n * @param {Function} fn\n * @return {Emitter}\n * @api public\n */\n\nEmitter.prototype.off =\nEmitter.prototype.removeListener =\nEmitter.prototype.removeAllListeners =\nEmitter.prototype.removeEventListener = function(event, fn){\n  this._callbacks = this._callbacks || {};\n\n  // all\n  if (0 == arguments.length) {\n    this._callbacks = {};\n    return this;\n  }\n\n  // specific event\n  var callbacks = this._callbacks['$' + event];\n  if (!callbacks) return this;\n\n  // remove all handlers\n  if (1 == arguments.length) {\n    delete this._callbacks['$' + event];\n    return this;\n  }\n\n  // remove specific handler\n  var cb;\n  for (var i = 0; i < callbacks.length; i++) {\n    cb = callbacks[i];\n    if (cb === fn || cb.fn === fn) {\n      callbacks.splice(i, 1);\n      break;\n    }\n  }\n\n  // Remove event specific arrays for event types that no\n  // one is subscribed for to avoid memory leak.\n  if (callbacks.length === 0) {\n    delete this._callbacks['$' + event];\n  }\n\n  return this;\n};\n\n/**\n * Emit `event` with the given args.\n *\n * @param {String} event\n * @param {Mixed} ...\n * @return {Emitter}\n */\n\nEmitter.prototype.emit = function(event){\n  this._callbacks = this._callbacks || {};\n\n  var args = new Array(arguments.length - 1)\n    , callbacks = this._callbacks['$' + event];\n\n  for (var i = 1; i < arguments.length; i++) {\n    args[i - 1] = arguments[i];\n  }\n\n  if (callbacks) {\n    callbacks = callbacks.slice(0);\n    for (var i = 0, len = callbacks.length; i < len; ++i) {\n      callbacks[i].apply(this, args);\n    }\n  }\n\n  return this;\n};\n\n// alias used for reserved events (protected method)\nEmitter.prototype.emitReserved = Emitter.prototype.emit;\n\n/**\n * Return array of callbacks for `event`.\n *\n * @param {String} event\n * @return {Array}\n * @api public\n */\n\nEmitter.prototype.listeners = function(event){\n  this._callbacks = this._callbacks || {};\n  return this._callbacks['$' + event] || [];\n};\n\n/**\n * Check if this emitter has `event` handlers.\n *\n * @param {String} event\n * @return {Boolean}\n * @api public\n */\n\nEmitter.prototype.hasListeners = function(event){\n  return !! this.listeners(event).length;\n};\n","export const nextTick = (() => {\n    const isPromiseAvailable = typeof Promise === \"function\" && typeof Promise.resolve === \"function\";\n    if (isPromiseAvailable) {\n        return (cb) => Promise.resolve().then(cb);\n    }\n    else {\n        return (cb, setTimeoutFn) => setTimeoutFn(cb, 0);\n    }\n})();\nexport const globalThisShim = (() => {\n    if (typeof self !== \"undefined\") {\n        return self;\n    }\n    else if (typeof window !== \"undefined\") {\n        return window;\n    }\n    else {\n        return Function(\"return this\")();\n    }\n})();\nexport const defaultBinaryType = \"arraybuffer\";\nexport function createCookieJar() { }\n","import { globalThisShim as globalThis } from \"./globals.node.js\";\nexport function pick(obj, ...attr) {\n    return attr.reduce((acc, k) => {\n        if (obj.hasOwnProperty(k)) {\n            acc[k] = obj[k];\n        }\n        return acc;\n    }, {});\n}\n// Keep a reference to the real timeout functions so they can be used when overridden\nconst NATIVE_SET_TIMEOUT = globalThis.setTimeout;\nconst NATIVE_CLEAR_TIMEOUT = globalThis.clearTimeout;\nexport function installTimerFunctions(obj, opts) {\n    if (opts.useNativeTimers) {\n        obj.setTimeoutFn = NATIVE_SET_TIMEOUT.bind(globalThis);\n        obj.clearTimeoutFn = NATIVE_CLEAR_TIMEOUT.bind(globalThis);\n    }\n    else {\n        obj.setTimeoutFn = globalThis.setTimeout.bind(globalThis);\n        obj.clearTimeoutFn = globalThis.clearTimeout.bind(globalThis);\n    }\n}\n// base64 encoded buffers are about 33% bigger (https://en.wikipedia.org/wiki/Base64)\nconst BASE64_OVERHEAD = 1.33;\n// we could also have used `new Blob([obj]).size`, but it isn't supported in IE9\nexport function byteLength(obj) {\n    if (typeof obj === \"string\") {\n        return utf8Length(obj);\n    }\n    // arraybuffer or blob\n    return Math.ceil((obj.byteLength || obj.size) * BASE64_OVERHEAD);\n}\nfunction utf8Length(str) {\n    let c = 0, length = 0;\n    for (let i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\n/**\n * Generates a random 8-characters string.\n */\nexport function randomString() {\n    return (Date.now().toString(36).substring(3) +\n        Math.random().toString(36).substring(2, 5));\n}\n","// imported from https://github.com/galkn/querystring\n/**\n * Compiles a querystring\n * Returns string representation of the object\n *\n * @param {Object}\n * @api private\n */\nexport function encode(obj) {\n    let str = '';\n    for (let i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            if (str.length)\n                str += '&';\n            str += encodeURIComponent(i) + '=' + encodeURIComponent(obj[i]);\n        }\n    }\n    return str;\n}\n/**\n * Parses a simple querystring into an object\n *\n * @param {String} qs\n * @api private\n */\nexport function decode(qs) {\n    let qry = {};\n    let pairs = qs.split('&');\n    for (let i = 0, l = pairs.length; i < l; i++) {\n        let pair = pairs[i].split('=');\n        qry[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n    return qry;\n}\n","import { decodePacket } from \"engine.io-parser\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions } from \"./util.js\";\nimport { encode } from \"./contrib/parseqs.js\";\nexport class TransportError extends Error {\n    constructor(reason, description, context) {\n        super(reason);\n        this.description = description;\n        this.context = context;\n        this.type = \"TransportError\";\n    }\n}\nexport class Transport extends Emitter {\n    /**\n     * Transport abstract constructor.\n     *\n     * @param {Object} opts - options\n     * @protected\n     */\n    constructor(opts) {\n        super();\n        this.writable = false;\n        installTimerFunctions(this, opts);\n        this.opts = opts;\n        this.query = opts.query;\n        this.socket = opts.socket;\n        this.supportsBinary = !opts.forceBase64;\n    }\n    /**\n     * Emits an error.\n     *\n     * @param {String} reason\n     * @param description\n     * @param context - the error context\n     * @return {Transport} for chaining\n     * @protected\n     */\n    onError(reason, description, context) {\n        super.emitReserved(\"error\", new TransportError(reason, description, context));\n        return this;\n    }\n    /**\n     * Opens the transport.\n     */\n    open() {\n        this.readyState = \"opening\";\n        this.doOpen();\n        return this;\n    }\n    /**\n     * Closes the transport.\n     */\n    close() {\n        if (this.readyState === \"opening\" || this.readyState === \"open\") {\n            this.doClose();\n            this.onClose();\n        }\n        return this;\n    }\n    /**\n     * Sends multiple packets.\n     *\n     * @param {Array} packets\n     */\n    send(packets) {\n        if (this.readyState === \"open\") {\n            this.write(packets);\n        }\n        else {\n            // this might happen if the transport was silently closed in the beforeunload event handler\n        }\n    }\n    /**\n     * Called upon open\n     *\n     * @protected\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        this.writable = true;\n        super.emitReserved(\"open\");\n    }\n    /**\n     * Called with data.\n     *\n     * @param {String} data\n     * @protected\n     */\n    onData(data) {\n        const packet = decodePacket(data, this.socket.binaryType);\n        this.onPacket(packet);\n    }\n    /**\n     * Called with a decoded packet.\n     *\n     * @protected\n     */\n    onPacket(packet) {\n        super.emitReserved(\"packet\", packet);\n    }\n    /**\n     * Called upon close.\n     *\n     * @protected\n     */\n    onClose(details) {\n        this.readyState = \"closed\";\n        super.emitReserved(\"close\", details);\n    }\n    /**\n     * Pauses the transport, in order not to lose packets during an upgrade.\n     *\n     * @param onPause\n     */\n    pause(onPause) { }\n    createUri(schema, query = {}) {\n        return (schema +\n            \"://\" +\n            this._hostname() +\n            this._port() +\n            this.opts.path +\n            this._query(query));\n    }\n    _hostname() {\n        const hostname = this.opts.hostname;\n        return hostname.indexOf(\":\") === -1 ? hostname : \"[\" + hostname + \"]\";\n    }\n    _port() {\n        if (this.opts.port &&\n            ((this.opts.secure && Number(this.opts.port !== 443)) ||\n                (!this.opts.secure && Number(this.opts.port) !== 80))) {\n            return \":\" + this.opts.port;\n        }\n        else {\n            return \"\";\n        }\n    }\n    _query(query) {\n        const encodedQuery = encode(query);\n        return encodedQuery.length ? \"?\" + encodedQuery : \"\";\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { randomString } from \"../util.js\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nexport class Polling extends Transport {\n    constructor() {\n        super(...arguments);\n        this._polling = false;\n    }\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @protected\n     */\n    doOpen() {\n        this._poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} onPause - callback upon buffers are flushed and transport is paused\n     * @package\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this._polling || !this.writable) {\n            let total = 0;\n            if (this._polling) {\n                total++;\n                this.once(\"pollComplete\", function () {\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                total++;\n                this.once(\"drain\", function () {\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @private\n     */\n    _poll() {\n        this._polling = true;\n        this.doPoll();\n        this.emitReserved(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @protected\n     */\n    onData(data) {\n        const callback = (packet) => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose({ description: \"transport closed by the server\" });\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        decodePayload(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this._polling = false;\n            this.emitReserved(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this._poll();\n            }\n            else {\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @protected\n     */\n    doClose() {\n        const close = () => {\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} packets - data packets\n     * @protected\n     */\n    write(packets) {\n        this.writable = false;\n        encodePayload(packets, (data) => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emitReserved(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        const query = this.query || {};\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\n","// imported from https://github.com/component/has-cors\nlet value = false;\ntry {\n    value = typeof XMLHttpRequest !== 'undefined' &&\n        'withCredentials' in new XMLHttpRequest();\n}\ncatch (err) {\n    // if XMLHttp support is disabled in IE then it will throw\n    // when trying to create\n}\nexport const hasCORS = value;\n","import { Polling } from \"./polling.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { installTimerFunctions, pick } from \"../util.js\";\nimport { globalThisShim as globalThis } from \"../globals.node.js\";\nimport { hasCORS } from \"../contrib/has-cors.js\";\nfunction empty() { }\nexport class BaseXHR extends Polling {\n    /**\n     * XHR Polling constructor.\n     *\n     * @param {Object} opts\n     * @package\n     */\n    constructor(opts) {\n        super(opts);\n        if (typeof location !== \"undefined\") {\n            const isSSL = \"https:\" === location.protocol;\n            let port = location.port;\n            // some user agents have empty `location.port`\n            if (!port) {\n                port = isSSL ? \"443\" : \"80\";\n            }\n            this.xd =\n                (typeof location !== \"undefined\" &&\n                    opts.hostname !== location.hostname) ||\n                    port !== opts.port;\n        }\n    }\n    /**\n     * Sends data.\n     *\n     * @param {String} data to send.\n     * @param {Function} called upon flush.\n     * @private\n     */\n    doWrite(data, fn) {\n        const req = this.request({\n            method: \"POST\",\n            data: data,\n        });\n        req.on(\"success\", fn);\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr post error\", xhrStatus, context);\n        });\n    }\n    /**\n     * Starts a poll cycle.\n     *\n     * @private\n     */\n    doPoll() {\n        const req = this.request();\n        req.on(\"data\", this.onData.bind(this));\n        req.on(\"error\", (xhrStatus, context) => {\n            this.onError(\"xhr poll error\", xhrStatus, context);\n        });\n        this.pollXhr = req;\n    }\n}\nexport class Request extends Emitter {\n    /**\n     * Request constructor\n     *\n     * @param {Object} options\n     * @package\n     */\n    constructor(createRequest, uri, opts) {\n        super();\n        this.createRequest = createRequest;\n        installTimerFunctions(this, opts);\n        this._opts = opts;\n        this._method = opts.method || \"GET\";\n        this._uri = uri;\n        this._data = undefined !== opts.data ? opts.data : null;\n        this._create();\n    }\n    /**\n     * Creates the XHR object and sends the request.\n     *\n     * @private\n     */\n    _create() {\n        var _a;\n        const opts = pick(this._opts, \"agent\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"autoUnref\");\n        opts.xdomain = !!this._opts.xd;\n        const xhr = (this._xhr = this.createRequest(opts));\n        try {\n            xhr.open(this._method, this._uri, true);\n            try {\n                if (this._opts.extraHeaders) {\n                    // @ts-ignore\n                    xhr.setDisableHeaderCheck && xhr.setDisableHeaderCheck(true);\n                    for (let i in this._opts.extraHeaders) {\n                        if (this._opts.extraHeaders.hasOwnProperty(i)) {\n                            xhr.setRequestHeader(i, this._opts.extraHeaders[i]);\n                        }\n                    }\n                }\n            }\n            catch (e) { }\n            if (\"POST\" === this._method) {\n                try {\n                    xhr.setRequestHeader(\"Content-type\", \"text/plain;charset=UTF-8\");\n                }\n                catch (e) { }\n            }\n            try {\n                xhr.setRequestHeader(\"Accept\", \"*/*\");\n            }\n            catch (e) { }\n            (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.addCookies(xhr);\n            // ie6 check\n            if (\"withCredentials\" in xhr) {\n                xhr.withCredentials = this._opts.withCredentials;\n            }\n            if (this._opts.requestTimeout) {\n                xhr.timeout = this._opts.requestTimeout;\n            }\n            xhr.onreadystatechange = () => {\n                var _a;\n                if (xhr.readyState === 3) {\n                    (_a = this._opts.cookieJar) === null || _a === void 0 ? void 0 : _a.parseCookies(\n                    // @ts-ignore\n                    xhr.getResponseHeader(\"set-cookie\"));\n                }\n                if (4 !== xhr.readyState)\n                    return;\n                if (200 === xhr.status || 1223 === xhr.status) {\n                    this._onLoad();\n                }\n                else {\n                    // make sure the `error` event handler that's user-set\n                    // does not throw in the same tick and gets caught here\n                    this.setTimeoutFn(() => {\n                        this._onError(typeof xhr.status === \"number\" ? xhr.status : 0);\n                    }, 0);\n                }\n            };\n            xhr.send(this._data);\n        }\n        catch (e) {\n            // Need to defer since .create() is called directly from the constructor\n            // and thus the 'error' event can only be only bound *after* this exception\n            // occurs.  Therefore, also, we cannot throw here at all.\n            this.setTimeoutFn(() => {\n                this._onError(e);\n            }, 0);\n            return;\n        }\n        if (typeof document !== \"undefined\") {\n            this._index = Request.requestsCount++;\n            Request.requests[this._index] = this;\n        }\n    }\n    /**\n     * Called upon error.\n     *\n     * @private\n     */\n    _onError(err) {\n        this.emitReserved(\"error\", err, this._xhr);\n        this._cleanup(true);\n    }\n    /**\n     * Cleans up house.\n     *\n     * @private\n     */\n    _cleanup(fromError) {\n        if (\"undefined\" === typeof this._xhr || null === this._xhr) {\n            return;\n        }\n        this._xhr.onreadystatechange = empty;\n        if (fromError) {\n            try {\n                this._xhr.abort();\n            }\n            catch (e) { }\n        }\n        if (typeof document !== \"undefined\") {\n            delete Request.requests[this._index];\n        }\n        this._xhr = null;\n    }\n    /**\n     * Called upon load.\n     *\n     * @private\n     */\n    _onLoad() {\n        const data = this._xhr.responseText;\n        if (data !== null) {\n            this.emitReserved(\"data\", data);\n            this.emitReserved(\"success\");\n            this._cleanup();\n        }\n    }\n    /**\n     * Aborts the request.\n     *\n     * @package\n     */\n    abort() {\n        this._cleanup();\n    }\n}\nRequest.requestsCount = 0;\nRequest.requests = {};\n/**\n * Aborts pending requests when unloading the window. This is needed to prevent\n * memory leaks (e.g. when using IE) and to ensure that no spurious error is\n * emitted.\n */\nif (typeof document !== \"undefined\") {\n    // @ts-ignore\n    if (typeof attachEvent === \"function\") {\n        // @ts-ignore\n        attachEvent(\"onunload\", unloadHandler);\n    }\n    else if (typeof addEventListener === \"function\") {\n        const terminationEvent = \"onpagehide\" in globalThis ? \"pagehide\" : \"unload\";\n        addEventListener(terminationEvent, unloadHandler, false);\n    }\n}\nfunction unloadHandler() {\n    for (let i in Request.requests) {\n        if (Request.requests.hasOwnProperty(i)) {\n            Request.requests[i].abort();\n        }\n    }\n}\nconst hasXHR2 = (function () {\n    const xhr = newRequest({\n        xdomain: false,\n    });\n    return xhr && xhr.responseType !== null;\n})();\n/**\n * HTTP long-polling based on the built-in `XMLHttpRequest` object.\n *\n * Usage: browser\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n */\nexport class XHR extends BaseXHR {\n    constructor(opts) {\n        super(opts);\n        const forceBase64 = opts && opts.forceBase64;\n        this.supportsBinary = hasXHR2 && !forceBase64;\n    }\n    request(opts = {}) {\n        Object.assign(opts, { xd: this.xd }, this.opts);\n        return new Request(newRequest, this.uri(), opts);\n    }\n}\nfunction newRequest(opts) {\n    const xdomain = opts.xdomain;\n    // XMLHttpRequest can be disabled on IE\n    try {\n        if (\"undefined\" !== typeof XMLHttpRequest && (!xdomain || hasCORS)) {\n            return new XMLHttpRequest();\n        }\n    }\n    catch (e) { }\n    if (!xdomain) {\n        try {\n            return new globalThis[[\"Active\"].concat(\"Object\").join(\"X\")](\"Microsoft.XMLHTTP\");\n        }\n        catch (e) { }\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { pick, randomString } from \"../util.js\";\nimport { encodePacket } from \"engine.io-parser\";\nimport { globalThisShim as globalThis, nextTick } from \"../globals.node.js\";\n// detect ReactNative environment\nconst isReactNative = typeof navigator !== \"undefined\" &&\n    typeof navigator.product === \"string\" &&\n    navigator.product.toLowerCase() === \"reactnative\";\nexport class BaseWS extends Transport {\n    get name() {\n        return \"websocket\";\n    }\n    doOpen() {\n        const uri = this.uri();\n        const protocols = this.opts.protocols;\n        // React Native only supports the 'headers' option, and will print a warning if anything else is passed\n        const opts = isReactNative\n            ? {}\n            : pick(this.opts, \"agent\", \"perMessageDeflate\", \"pfx\", \"key\", \"passphrase\", \"cert\", \"ca\", \"ciphers\", \"rejectUnauthorized\", \"localAddress\", \"protocolVersion\", \"origin\", \"maxPayload\", \"family\", \"checkServerIdentity\");\n        if (this.opts.extraHeaders) {\n            opts.headers = this.opts.extraHeaders;\n        }\n        try {\n            this.ws = this.createSocket(uri, protocols, opts);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this.ws.binaryType = this.socket.binaryType;\n        this.addEventListeners();\n    }\n    /**\n     * Adds event listeners to the socket\n     *\n     * @private\n     */\n    addEventListeners() {\n        this.ws.onopen = () => {\n            if (this.opts.autoUnref) {\n                this.ws._socket.unref();\n            }\n            this.onOpen();\n        };\n        this.ws.onclose = (closeEvent) => this.onClose({\n            description: \"websocket connection closed\",\n            context: closeEvent,\n        });\n        this.ws.onmessage = (ev) => this.onData(ev.data);\n        this.ws.onerror = (e) => this.onError(\"websocket error\", e);\n    }\n    write(packets) {\n        this.writable = false;\n        // encodePacket efficient as it uses WS framing\n        // no need for encodePayload\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            encodePacket(packet, this.supportsBinary, (data) => {\n                // Sometimes the websocket has already been closed but the browser didn't\n                // have a chance of informing us about it yet, in that case send will\n                // throw an error\n                try {\n                    this.doWrite(packet, data);\n                }\n                catch (e) {\n                }\n                if (lastPacket) {\n                    // fake drain\n                    // defer to next tick to allow Socket to clear writeBuffer\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        if (typeof this.ws !== \"undefined\") {\n            this.ws.onerror = () => { };\n            this.ws.close();\n            this.ws = null;\n        }\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @private\n     */\n    uri() {\n        const schema = this.opts.secure ? \"wss\" : \"ws\";\n        const query = this.query || {};\n        // append timestamp to URI\n        if (this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = randomString();\n        }\n        // communicate binary support capabilities\n        if (!this.supportsBinary) {\n            query.b64 = 1;\n        }\n        return this.createUri(schema, query);\n    }\n}\nconst WebSocketCtor = globalThis.WebSocket || globalThis.MozWebSocket;\n/**\n * WebSocket transport based on the built-in `WebSocket` object.\n *\n * Usage: browser, Node.js (since v21), Deno, Bun\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket\n * @see https://caniuse.com/mdn-api_websocket\n * @see https://nodejs.org/api/globals.html#websocket\n */\nexport class WS extends BaseWS {\n    createSocket(uri, protocols, opts) {\n        return !isReactNative\n            ? protocols\n                ? new WebSocketCtor(uri, protocols)\n                : new WebSocketCtor(uri)\n            : new WebSocketCtor(uri, protocols, opts);\n    }\n    doWrite(_packet, data) {\n        this.ws.send(data);\n    }\n}\n","import { Transport } from \"../transport.js\";\nimport { nextTick } from \"../globals.node.js\";\nimport { createPacketDecoderStream, createPacketEncoderStream, } from \"engine.io-parser\";\n/**\n * WebTransport transport based on the built-in `WebTransport` object.\n *\n * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n *\n * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n * @see https://caniuse.com/webtransport\n */\nexport class WT extends Transport {\n    get name() {\n        return \"webtransport\";\n    }\n    doOpen() {\n        try {\n            // @ts-ignore\n            this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        }\n        catch (err) {\n            return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed\n            .then(() => {\n            this.onClose();\n        })\n            .catch((err) => {\n            this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n            this._transport.createBidirectionalStream().then((stream) => {\n                const decoderStream = createPacketDecoderStream(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n                const reader = stream.readable.pipeThrough(decoderStream).getReader();\n                const encoderStream = createPacketEncoderStream();\n                encoderStream.readable.pipeTo(stream.writable);\n                this._writer = encoderStream.writable.getWriter();\n                const read = () => {\n                    reader\n                        .read()\n                        .then(({ done, value }) => {\n                        if (done) {\n                            return;\n                        }\n                        this.onPacket(value);\n                        read();\n                    })\n                        .catch((err) => {\n                    });\n                };\n                read();\n                const packet = { type: \"open\" };\n                if (this.query.sid) {\n                    packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n                }\n                this._writer.write(packet).then(() => this.onOpen());\n            });\n        });\n    }\n    write(packets) {\n        this.writable = false;\n        for (let i = 0; i < packets.length; i++) {\n            const packet = packets[i];\n            const lastPacket = i === packets.length - 1;\n            this._writer.write(packet).then(() => {\n                if (lastPacket) {\n                    nextTick(() => {\n                        this.writable = true;\n                        this.emitReserved(\"drain\");\n                    }, this.setTimeoutFn);\n                }\n            });\n        }\n    }\n    doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n    }\n}\n","import { XHR } from \"./polling-xhr.node.js\";\nimport { WS } from \"./websocket.node.js\";\nimport { WT } from \"./webtransport.js\";\nexport const transports = {\n    websocket: WS,\n    webtransport: WT,\n    polling: XHR,\n};\n","// imported from https://github.com/galkn/parseuri\n/**\n * Parses a URI\n *\n * Note: we could also have used the built-in URL object, but it isn't supported on all platforms.\n *\n * See:\n * - https://developer.mozilla.org/en-US/docs/Web/API/URL\n * - https://caniuse.com/url\n * - https://www.rfc-editor.org/rfc/rfc3986#appendix-B\n *\n * History of the parse() method:\n * - first commit: https://github.com/socketio/socket.io-client/commit/4ee1d5d94b3906a9c052b459f1a818b15f38f91c\n * - export into its own module: https://github.com/socketio/engine.io-client/commit/de2c561e4564efeb78f1bdb1ba39ef81b2822cb3\n * - reimport: https://github.com/socketio/engine.io-client/commit/df32277c3f6d622eec5ed09f493cae3f3391d242\n *\n * @author Steven Levithan <stevenlevithan.com> (MIT license)\n * @api private\n */\nconst re = /^(?:(?![^:@\\/?#]+:[^:@\\/]*@)(http|https|ws|wss):\\/\\/)?((?:(([^:@\\/?#]*)(?::([^:@\\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;\nconst parts = [\n    'source', 'protocol', 'authority', 'userInfo', 'user', 'password', 'host', 'port', 'relative', 'path', 'directory', 'file', 'query', 'anchor'\n];\nexport function parse(str) {\n    if (str.length > 8000) {\n        throw \"URI too long\";\n    }\n    const src = str, b = str.indexOf('['), e = str.indexOf(']');\n    if (b != -1 && e != -1) {\n        str = str.substring(0, b) + str.substring(b, e).replace(/:/g, ';') + str.substring(e, str.length);\n    }\n    let m = re.exec(str || ''), uri = {}, i = 14;\n    while (i--) {\n        uri[parts[i]] = m[i] || '';\n    }\n    if (b != -1 && e != -1) {\n        uri.source = src;\n        uri.host = uri.host.substring(1, uri.host.length - 1).replace(/;/g, ':');\n        uri.authority = uri.authority.replace('[', '').replace(']', '').replace(/;/g, ':');\n        uri.ipv6uri = true;\n    }\n    uri.pathNames = pathNames(uri, uri['path']);\n    uri.queryKey = queryKey(uri, uri['query']);\n    return uri;\n}\nfunction pathNames(obj, path) {\n    const regx = /\\/{2,9}/g, names = path.replace(regx, \"/\").split(\"/\");\n    if (path.slice(0, 1) == '/' || path.length === 0) {\n        names.splice(0, 1);\n    }\n    if (path.slice(-1) == '/') {\n        names.splice(names.length - 1, 1);\n    }\n    return names;\n}\nfunction queryKey(uri, query) {\n    const data = {};\n    query.replace(/(?:^|&)([^&=]*)=?([^&]*)/g, function ($0, $1, $2) {\n        if ($1) {\n            data[$1] = $2;\n        }\n    });\n    return data;\n}\n","import { transports as DEFAULT_TRANSPORTS } from \"./transports/index.js\";\nimport { installTimerFunctions, byteLength } from \"./util.js\";\nimport { decode } from \"./contrib/parseqs.js\";\nimport { parse } from \"./contrib/parseuri.js\";\nimport { Emitter } from \"@socket.io/component-emitter\";\nimport { protocol } from \"engine.io-parser\";\nimport { createCookieJar, defaultBinaryType, nextTick, } from \"./globals.node.js\";\nconst withEventListeners = typeof addEventListener === \"function\" &&\n    typeof removeEventListener === \"function\";\nconst OFFLINE_EVENT_LISTENERS = [];\nif (withEventListeners) {\n    // within a ServiceWorker, any event handler for the 'offline' event must be added on the initial evaluation of the\n    // script, so we create one single event listener here which will forward the event to the socket instances\n    addEventListener(\"offline\", () => {\n        OFFLINE_EVENT_LISTENERS.forEach((listener) => listener());\n    }, false);\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes without upgrade mechanism, which means that it will keep the first low-level transport that\n * successfully establishes the connection.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithoutUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithoutUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithUpgrade\n * @see Socket\n */\nexport class SocketWithoutUpgrade extends Emitter {\n    /**\n     * Socket constructor.\n     *\n     * @param {String|Object} uri - uri or options\n     * @param {Object} opts - options\n     */\n    constructor(uri, opts) {\n        super();\n        this.binaryType = defaultBinaryType;\n        this.writeBuffer = [];\n        this._prevBufferLen = 0;\n        this._pingInterval = -1;\n        this._pingTimeout = -1;\n        this._maxPayload = -1;\n        /**\n         * The expiration timestamp of the {@link _pingTimeoutTimer} object is tracked, in case the timer is throttled and the\n         * callback is not fired on time. This can happen for example when a laptop is suspended or when a phone is locked.\n         */\n        this._pingTimeoutTime = Infinity;\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = null;\n        }\n        if (uri) {\n            const parsedUri = parse(uri);\n            opts.hostname = parsedUri.host;\n            opts.secure =\n                parsedUri.protocol === \"https\" || parsedUri.protocol === \"wss\";\n            opts.port = parsedUri.port;\n            if (parsedUri.query)\n                opts.query = parsedUri.query;\n        }\n        else if (opts.host) {\n            opts.hostname = parse(opts.host).host;\n        }\n        installTimerFunctions(this, opts);\n        this.secure =\n            null != opts.secure\n                ? opts.secure\n                : typeof location !== \"undefined\" && \"https:\" === location.protocol;\n        if (opts.hostname && !opts.port) {\n            // if no port is specified manually, use the protocol default\n            opts.port = this.secure ? \"443\" : \"80\";\n        }\n        this.hostname =\n            opts.hostname ||\n                (typeof location !== \"undefined\" ? location.hostname : \"localhost\");\n        this.port =\n            opts.port ||\n                (typeof location !== \"undefined\" && location.port\n                    ? location.port\n                    : this.secure\n                        ? \"443\"\n                        : \"80\");\n        this.transports = [];\n        this._transportsByName = {};\n        opts.transports.forEach((t) => {\n            const transportName = t.prototype.name;\n            this.transports.push(transportName);\n            this._transportsByName[transportName] = t;\n        });\n        this.opts = Object.assign({\n            path: \"/engine.io\",\n            agent: false,\n            withCredentials: false,\n            upgrade: true,\n            timestampParam: \"t\",\n            rememberUpgrade: false,\n            addTrailingSlash: true,\n            rejectUnauthorized: true,\n            perMessageDeflate: {\n                threshold: 1024,\n            },\n            transportOptions: {},\n            closeOnBeforeunload: false,\n        }, opts);\n        this.opts.path =\n            this.opts.path.replace(/\\/$/, \"\") +\n                (this.opts.addTrailingSlash ? \"/\" : \"\");\n        if (typeof this.opts.query === \"string\") {\n            this.opts.query = decode(this.opts.query);\n        }\n        if (withEventListeners) {\n            if (this.opts.closeOnBeforeunload) {\n                // Firefox closes the connection when the \"beforeunload\" event is emitted but not Chrome. This event listener\n                // ensures every browser behaves the same (no \"disconnect\" event at the Socket.IO level when the page is\n                // closed/reloaded)\n                this._beforeunloadEventListener = () => {\n                    if (this.transport) {\n                        // silently close the transport\n                        this.transport.removeAllListeners();\n                        this.transport.close();\n                    }\n                };\n                addEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n            }\n            if (this.hostname !== \"localhost\") {\n                this._offlineEventListener = () => {\n                    this._onClose(\"transport close\", {\n                        description: \"network connection lost\",\n                    });\n                };\n                OFFLINE_EVENT_LISTENERS.push(this._offlineEventListener);\n            }\n        }\n        if (this.opts.withCredentials) {\n            this._cookieJar = createCookieJar();\n        }\n        this._open();\n    }\n    /**\n     * Creates transport of the given type.\n     *\n     * @param {String} name - transport name\n     * @return {Transport}\n     * @private\n     */\n    createTransport(name) {\n        const query = Object.assign({}, this.opts.query);\n        // append engine.io protocol identifier\n        query.EIO = protocol;\n        // transport name\n        query.transport = name;\n        // session id if we already have one\n        if (this.id)\n            query.sid = this.id;\n        const opts = Object.assign({}, this.opts, {\n            query,\n            socket: this,\n            hostname: this.hostname,\n            secure: this.secure,\n            port: this.port,\n        }, this.opts.transportOptions[name]);\n        return new this._transportsByName[name](opts);\n    }\n    /**\n     * Initializes transport to use and starts probe.\n     *\n     * @private\n     */\n    _open() {\n        if (this.transports.length === 0) {\n            // Emit error on next tick so it can be listened to\n            this.setTimeoutFn(() => {\n                this.emitReserved(\"error\", \"No transports available\");\n            }, 0);\n            return;\n        }\n        const transportName = this.opts.rememberUpgrade &&\n            SocketWithoutUpgrade.priorWebsocketSuccess &&\n            this.transports.indexOf(\"websocket\") !== -1\n            ? \"websocket\"\n            : this.transports[0];\n        this.readyState = \"opening\";\n        const transport = this.createTransport(transportName);\n        transport.open();\n        this.setTransport(transport);\n    }\n    /**\n     * Sets the current transport. Disables the existing one (if any).\n     *\n     * @private\n     */\n    setTransport(transport) {\n        if (this.transport) {\n            this.transport.removeAllListeners();\n        }\n        // set up transport\n        this.transport = transport;\n        // set up transport listeners\n        transport\n            .on(\"drain\", this._onDrain.bind(this))\n            .on(\"packet\", this._onPacket.bind(this))\n            .on(\"error\", this._onError.bind(this))\n            .on(\"close\", (reason) => this._onClose(\"transport close\", reason));\n    }\n    /**\n     * Called when connection is deemed open.\n     *\n     * @private\n     */\n    onOpen() {\n        this.readyState = \"open\";\n        SocketWithoutUpgrade.priorWebsocketSuccess =\n            \"websocket\" === this.transport.name;\n        this.emitReserved(\"open\");\n        this.flush();\n    }\n    /**\n     * Handles a packet.\n     *\n     * @private\n     */\n    _onPacket(packet) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            this.emitReserved(\"packet\", packet);\n            // Socket is live - any packet counts\n            this.emitReserved(\"heartbeat\");\n            switch (packet.type) {\n                case \"open\":\n                    this.onHandshake(JSON.parse(packet.data));\n                    break;\n                case \"ping\":\n                    this._sendPacket(\"pong\");\n                    this.emitReserved(\"ping\");\n                    this.emitReserved(\"pong\");\n                    this._resetPingTimeout();\n                    break;\n                case \"error\":\n                    const err = new Error(\"server error\");\n                    // @ts-ignore\n                    err.code = packet.data;\n                    this._onError(err);\n                    break;\n                case \"message\":\n                    this.emitReserved(\"data\", packet.data);\n                    this.emitReserved(\"message\", packet.data);\n                    break;\n            }\n        }\n        else {\n        }\n    }\n    /**\n     * Called upon handshake completion.\n     *\n     * @param {Object} data - handshake obj\n     * @private\n     */\n    onHandshake(data) {\n        this.emitReserved(\"handshake\", data);\n        this.id = data.sid;\n        this.transport.query.sid = data.sid;\n        this._pingInterval = data.pingInterval;\n        this._pingTimeout = data.pingTimeout;\n        this._maxPayload = data.maxPayload;\n        this.onOpen();\n        // In case open handler closes socket\n        if (\"closed\" === this.readyState)\n            return;\n        this._resetPingTimeout();\n    }\n    /**\n     * Sets and resets ping timeout timer based on server pings.\n     *\n     * @private\n     */\n    _resetPingTimeout() {\n        this.clearTimeoutFn(this._pingTimeoutTimer);\n        const delay = this._pingInterval + this._pingTimeout;\n        this._pingTimeoutTime = Date.now() + delay;\n        this._pingTimeoutTimer = this.setTimeoutFn(() => {\n            this._onClose(\"ping timeout\");\n        }, delay);\n        if (this.opts.autoUnref) {\n            this._pingTimeoutTimer.unref();\n        }\n    }\n    /**\n     * Called on `drain` event\n     *\n     * @private\n     */\n    _onDrain() {\n        this.writeBuffer.splice(0, this._prevBufferLen);\n        // setting prevBufferLen = 0 is very important\n        // for example, when upgrading, upgrade packet is sent over,\n        // and a nonzero prevBufferLen could cause problems on `drain`\n        this._prevBufferLen = 0;\n        if (0 === this.writeBuffer.length) {\n            this.emitReserved(\"drain\");\n        }\n        else {\n            this.flush();\n        }\n    }\n    /**\n     * Flush write buffers.\n     *\n     * @private\n     */\n    flush() {\n        if (\"closed\" !== this.readyState &&\n            this.transport.writable &&\n            !this.upgrading &&\n            this.writeBuffer.length) {\n            const packets = this._getWritablePackets();\n            this.transport.send(packets);\n            // keep track of current length of writeBuffer\n            // splice writeBuffer and callbackBuffer on `drain`\n            this._prevBufferLen = packets.length;\n            this.emitReserved(\"flush\");\n        }\n    }\n    /**\n     * Ensure the encoded size of the writeBuffer is below the maxPayload value sent by the server (only for HTTP\n     * long-polling)\n     *\n     * @private\n     */\n    _getWritablePackets() {\n        const shouldCheckPayloadSize = this._maxPayload &&\n            this.transport.name === \"polling\" &&\n            this.writeBuffer.length > 1;\n        if (!shouldCheckPayloadSize) {\n            return this.writeBuffer;\n        }\n        let payloadSize = 1; // first packet type\n        for (let i = 0; i < this.writeBuffer.length; i++) {\n            const data = this.writeBuffer[i].data;\n            if (data) {\n                payloadSize += byteLength(data);\n            }\n            if (i > 0 && payloadSize > this._maxPayload) {\n                return this.writeBuffer.slice(0, i);\n            }\n            payloadSize += 2; // separator + packet type\n        }\n        return this.writeBuffer;\n    }\n    /**\n     * Checks whether the heartbeat timer has expired but the socket has not yet been notified.\n     *\n     * Note: this method is private for now because it does not really fit the WebSocket API, but if we put it in the\n     * `write()` method then the message would not be buffered by the Socket.IO client.\n     *\n     * @return {boolean}\n     * @private\n     */\n    /* private */ _hasPingExpired() {\n        if (!this._pingTimeoutTime)\n            return true;\n        const hasExpired = Date.now() > this._pingTimeoutTime;\n        if (hasExpired) {\n            this._pingTimeoutTime = 0;\n            nextTick(() => {\n                this._onClose(\"ping timeout\");\n            }, this.setTimeoutFn);\n        }\n        return hasExpired;\n    }\n    /**\n     * Sends a message.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    write(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a message. Alias of {@link Socket#write}.\n     *\n     * @param {String} msg - message.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @return {Socket} for chaining.\n     */\n    send(msg, options, fn) {\n        this._sendPacket(\"message\", msg, options, fn);\n        return this;\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param {String} type: packet type.\n     * @param {String} data.\n     * @param {Object} options.\n     * @param {Function} fn - callback function.\n     * @private\n     */\n    _sendPacket(type, data, options, fn) {\n        if (\"function\" === typeof data) {\n            fn = data;\n            data = undefined;\n        }\n        if (\"function\" === typeof options) {\n            fn = options;\n            options = null;\n        }\n        if (\"closing\" === this.readyState || \"closed\" === this.readyState) {\n            return;\n        }\n        options = options || {};\n        options.compress = false !== options.compress;\n        const packet = {\n            type: type,\n            data: data,\n            options: options,\n        };\n        this.emitReserved(\"packetCreate\", packet);\n        this.writeBuffer.push(packet);\n        if (fn)\n            this.once(\"flush\", fn);\n        this.flush();\n    }\n    /**\n     * Closes the connection.\n     */\n    close() {\n        const close = () => {\n            this._onClose(\"forced close\");\n            this.transport.close();\n        };\n        const cleanupAndClose = () => {\n            this.off(\"upgrade\", cleanupAndClose);\n            this.off(\"upgradeError\", cleanupAndClose);\n            close();\n        };\n        const waitForUpgrade = () => {\n            // wait for upgrade to finish since we can't send packets while pausing a transport\n            this.once(\"upgrade\", cleanupAndClose);\n            this.once(\"upgradeError\", cleanupAndClose);\n        };\n        if (\"opening\" === this.readyState || \"open\" === this.readyState) {\n            this.readyState = \"closing\";\n            if (this.writeBuffer.length) {\n                this.once(\"drain\", () => {\n                    if (this.upgrading) {\n                        waitForUpgrade();\n                    }\n                    else {\n                        close();\n                    }\n                });\n            }\n            else if (this.upgrading) {\n                waitForUpgrade();\n            }\n            else {\n                close();\n            }\n        }\n        return this;\n    }\n    /**\n     * Called upon transport error\n     *\n     * @private\n     */\n    _onError(err) {\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        if (this.opts.tryAllTransports &&\n            this.transports.length > 1 &&\n            this.readyState === \"opening\") {\n            this.transports.shift();\n            return this._open();\n        }\n        this.emitReserved(\"error\", err);\n        this._onClose(\"transport error\", err);\n    }\n    /**\n     * Called upon transport close.\n     *\n     * @private\n     */\n    _onClose(reason, description) {\n        if (\"opening\" === this.readyState ||\n            \"open\" === this.readyState ||\n            \"closing\" === this.readyState) {\n            // clear timers\n            this.clearTimeoutFn(this._pingTimeoutTimer);\n            // stop event from firing again for transport\n            this.transport.removeAllListeners(\"close\");\n            // ensure transport won't stay open\n            this.transport.close();\n            // ignore further transport communication\n            this.transport.removeAllListeners();\n            if (withEventListeners) {\n                if (this._beforeunloadEventListener) {\n                    removeEventListener(\"beforeunload\", this._beforeunloadEventListener, false);\n                }\n                if (this._offlineEventListener) {\n                    const i = OFFLINE_EVENT_LISTENERS.indexOf(this._offlineEventListener);\n                    if (i !== -1) {\n                        OFFLINE_EVENT_LISTENERS.splice(i, 1);\n                    }\n                }\n            }\n            // set ready state\n            this.readyState = \"closed\";\n            // clear session id\n            this.id = null;\n            // emit close event\n            this.emitReserved(\"close\", reason, description);\n            // clean buffers after, so users can still\n            // grab the buffers on `close` event\n            this.writeBuffer = [];\n            this._prevBufferLen = 0;\n        }\n    }\n}\nSocketWithoutUpgrade.protocol = protocol;\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * In order to allow tree-shaking, there are no transports included, that's why the `transports` option is mandatory.\n *\n * @example\n * import { SocketWithUpgrade, WebSocket } from \"engine.io-client\";\n *\n * const socket = new SocketWithUpgrade({\n *   transports: [WebSocket]\n * });\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see Socket\n */\nexport class SocketWithUpgrade extends SocketWithoutUpgrade {\n    constructor() {\n        super(...arguments);\n        this._upgrades = [];\n    }\n    onOpen() {\n        super.onOpen();\n        if (\"open\" === this.readyState && this.opts.upgrade) {\n            for (let i = 0; i < this._upgrades.length; i++) {\n                this._probe(this._upgrades[i]);\n            }\n        }\n    }\n    /**\n     * Probes a transport.\n     *\n     * @param {String} name - transport name\n     * @private\n     */\n    _probe(name) {\n        let transport = this.createTransport(name);\n        let failed = false;\n        SocketWithoutUpgrade.priorWebsocketSuccess = false;\n        const onTransportOpen = () => {\n            if (failed)\n                return;\n            transport.send([{ type: \"ping\", data: \"probe\" }]);\n            transport.once(\"packet\", (msg) => {\n                if (failed)\n                    return;\n                if (\"pong\" === msg.type && \"probe\" === msg.data) {\n                    this.upgrading = true;\n                    this.emitReserved(\"upgrading\", transport);\n                    if (!transport)\n                        return;\n                    SocketWithoutUpgrade.priorWebsocketSuccess =\n                        \"websocket\" === transport.name;\n                    this.transport.pause(() => {\n                        if (failed)\n                            return;\n                        if (\"closed\" === this.readyState)\n                            return;\n                        cleanup();\n                        this.setTransport(transport);\n                        transport.send([{ type: \"upgrade\" }]);\n                        this.emitReserved(\"upgrade\", transport);\n                        transport = null;\n                        this.upgrading = false;\n                        this.flush();\n                    });\n                }\n                else {\n                    const err = new Error(\"probe error\");\n                    // @ts-ignore\n                    err.transport = transport.name;\n                    this.emitReserved(\"upgradeError\", err);\n                }\n            });\n        };\n        function freezeTransport() {\n            if (failed)\n                return;\n            // Any callback called by transport should be ignored since now\n            failed = true;\n            cleanup();\n            transport.close();\n            transport = null;\n        }\n        // Handle any error that happens while probing\n        const onerror = (err) => {\n            const error = new Error(\"probe error: \" + err);\n            // @ts-ignore\n            error.transport = transport.name;\n            freezeTransport();\n            this.emitReserved(\"upgradeError\", error);\n        };\n        function onTransportClose() {\n            onerror(\"transport closed\");\n        }\n        // When the socket is closed while we're probing\n        function onclose() {\n            onerror(\"socket closed\");\n        }\n        // When the socket is upgraded while we're probing\n        function onupgrade(to) {\n            if (transport && to.name !== transport.name) {\n                freezeTransport();\n            }\n        }\n        // Remove all listeners on the transport and on self\n        const cleanup = () => {\n            transport.removeListener(\"open\", onTransportOpen);\n            transport.removeListener(\"error\", onerror);\n            transport.removeListener(\"close\", onTransportClose);\n            this.off(\"close\", onclose);\n            this.off(\"upgrading\", onupgrade);\n        };\n        transport.once(\"open\", onTransportOpen);\n        transport.once(\"error\", onerror);\n        transport.once(\"close\", onTransportClose);\n        this.once(\"close\", onclose);\n        this.once(\"upgrading\", onupgrade);\n        if (this._upgrades.indexOf(\"webtransport\") !== -1 &&\n            name !== \"webtransport\") {\n            // favor WebTransport\n            this.setTimeoutFn(() => {\n                if (!failed) {\n                    transport.open();\n                }\n            }, 200);\n        }\n        else {\n            transport.open();\n        }\n    }\n    onHandshake(data) {\n        this._upgrades = this._filterUpgrades(data.upgrades);\n        super.onHandshake(data);\n    }\n    /**\n     * Filters upgrades, returning only those matching client transports.\n     *\n     * @param {Array} upgrades - server upgrades\n     * @private\n     */\n    _filterUpgrades(upgrades) {\n        const filteredUpgrades = [];\n        for (let i = 0; i < upgrades.length; i++) {\n            if (~this.transports.indexOf(upgrades[i]))\n                filteredUpgrades.push(upgrades[i]);\n        }\n        return filteredUpgrades;\n    }\n}\n/**\n * This class provides a WebSocket-like interface to connect to an Engine.IO server. The connection will be established\n * with one of the available low-level transports, like HTTP long-polling, WebSocket or WebTransport.\n *\n * This class comes with an upgrade mechanism, which means that once the connection is established with the first\n * low-level transport, it will try to upgrade to a better transport.\n *\n * @example\n * import { Socket } from \"engine.io-client\";\n *\n * const socket = new Socket();\n *\n * socket.on(\"open\", () => {\n *   socket.send(\"hello\");\n * });\n *\n * @see SocketWithoutUpgrade\n * @see SocketWithUpgrade\n */\nexport class Socket extends SocketWithUpgrade {\n    constructor(uri, opts = {}) {\n        const o = typeof uri === \"object\" ? uri : opts;\n        if (!o.transports ||\n            (o.transports && typeof o.transports[0] === \"string\")) {\n            o.transports = (o.transports || [\"polling\", \"websocket\", \"webtransport\"])\n                .map((transportName) => DEFAULT_TRANSPORTS[transportName])\n                .filter((t) => !!t);\n        }\n        super(uri, o);\n    }\n}\n","import { parse } from \"engine.io-client\";\n/**\n * URL parser.\n *\n * @param uri - url\n * @param path - the request path of the connection\n * @param loc - An object meant to mimic window.location.\n *        Defaults to window.location.\n * @public\n */\nexport function url(uri, path = \"\", loc) {\n    let obj = uri;\n    // default to window.location\n    loc = loc || (typeof location !== \"undefined\" && location);\n    if (null == uri)\n        uri = loc.protocol + \"//\" + loc.host;\n    // relative path support\n    if (typeof uri === \"string\") {\n        if (\"/\" === uri.charAt(0)) {\n            if (\"/\" === uri.charAt(1)) {\n                uri = loc.protocol + uri;\n            }\n            else {\n                uri = loc.host + uri;\n            }\n        }\n        if (!/^(https?|wss?):\\/\\//.test(uri)) {\n            if (\"undefined\" !== typeof loc) {\n                uri = loc.protocol + \"//\" + uri;\n            }\n            else {\n                uri = \"https://\" + uri;\n            }\n        }\n        // parse\n        obj = parse(uri);\n    }\n    // make sure we treat `localhost:80` and `localhost` equally\n    if (!obj.port) {\n        if (/^(http|ws)$/.test(obj.protocol)) {\n            obj.port = \"80\";\n        }\n        else if (/^(http|ws)s$/.test(obj.protocol)) {\n            obj.port = \"443\";\n        }\n    }\n    obj.path = obj.path || \"/\";\n    const ipv6 = obj.host.indexOf(\":\") !== -1;\n    const host = ipv6 ? \"[\" + obj.host + \"]\" : obj.host;\n    // define unique id\n    obj.id = obj.protocol + \"://\" + host + \":\" + obj.port + path;\n    // define href\n    obj.href =\n        obj.protocol +\n            \"://\" +\n            host +\n            (loc && loc.port === obj.port ? \"\" : \":\" + obj.port);\n    return obj;\n}\n","const withNativeArrayBuffer = typeof ArrayBuffer === \"function\";\nconst isView = (obj) => {\n    return typeof ArrayBuffer.isView === \"function\"\n        ? ArrayBuffer.isView(obj)\n        : obj.buffer instanceof ArrayBuffer;\n};\nconst toString = Object.prototype.toString;\nconst withNativeBlob = typeof Blob === \"function\" ||\n    (typeof Blob !== \"undefined\" &&\n        toString.call(Blob) === \"[object BlobConstructor]\");\nconst withNativeFile = typeof File === \"function\" ||\n    (typeof File !== \"undefined\" &&\n        toString.call(File) === \"[object FileConstructor]\");\n/**\n * Returns true if obj is a Buffer, an ArrayBuffer, a Blob or a File.\n *\n * @private\n */\nexport function isBinary(obj) {\n    return ((withNativeArrayBuffer && (obj instanceof ArrayBuffer || isView(obj))) ||\n        (withNativeBlob && obj instanceof Blob) ||\n        (withNativeFile && obj instanceof File));\n}\nexport function hasBinary(obj, toJSON) {\n    if (!obj || typeof obj !== \"object\") {\n        return false;\n    }\n    if (Array.isArray(obj)) {\n        for (let i = 0, l = obj.length; i < l; i++) {\n            if (hasBinary(obj[i])) {\n                return true;\n            }\n        }\n        return false;\n    }\n    if (isBinary(obj)) {\n        return true;\n    }\n    if (obj.toJSON &&\n        typeof obj.toJSON === \"function\" &&\n        arguments.length === 1) {\n        return hasBinary(obj.toJSON(), true);\n    }\n    for (const key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key) && hasBinary(obj[key])) {\n            return true;\n        }\n    }\n    return false;\n}\n","import { isBinary } from \"./is-binary.js\";\n/**\n * Replaces every Buffer | ArrayBuffer | Blob | File in packet with a numbered placeholder.\n *\n * @param {Object} packet - socket.io event packet\n * @return {Object} with deconstructed packet and list of buffers\n * @public\n */\nexport function deconstructPacket(packet) {\n    const buffers = [];\n    const packetData = packet.data;\n    const pack = packet;\n    pack.data = _deconstructPacket(packetData, buffers);\n    pack.attachments = buffers.length; // number of binary 'attachments'\n    return { packet: pack, buffers: buffers };\n}\nfunction _deconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (isBinary(data)) {\n        const placeholder = { _placeholder: true, num: buffers.length };\n        buffers.push(data);\n        return placeholder;\n    }\n    else if (Array.isArray(data)) {\n        const newData = new Array(data.length);\n        for (let i = 0; i < data.length; i++) {\n            newData[i] = _deconstructPacket(data[i], buffers);\n        }\n        return newData;\n    }\n    else if (typeof data === \"object\" && !(data instanceof Date)) {\n        const newData = {};\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                newData[key] = _deconstructPacket(data[key], buffers);\n            }\n        }\n        return newData;\n    }\n    return data;\n}\n/**\n * Reconstructs a binary packet from its placeholder packet and buffers\n *\n * @param {Object} packet - event packet with placeholders\n * @param {Array} buffers - binary buffers to put in placeholder positions\n * @return {Object} reconstructed packet\n * @public\n */\nexport function reconstructPacket(packet, buffers) {\n    packet.data = _reconstructPacket(packet.data, buffers);\n    delete packet.attachments; // no longer useful\n    return packet;\n}\nfunction _reconstructPacket(data, buffers) {\n    if (!data)\n        return data;\n    if (data && data._placeholder === true) {\n        const isIndexValid = typeof data.num === \"number\" &&\n            data.num >= 0 &&\n            data.num < buffers.length;\n        if (isIndexValid) {\n            return buffers[data.num]; // appropriate buffer (should be natural order anyway)\n        }\n        else {\n            throw new Error(\"illegal attachments\");\n        }\n    }\n    else if (Array.isArray(data)) {\n        for (let i = 0; i < data.length; i++) {\n            data[i] = _reconstructPacket(data[i], buffers);\n        }\n    }\n    else if (typeof data === \"object\") {\n        for (const key in data) {\n            if (Object.prototype.hasOwnProperty.call(data, key)) {\n                data[key] = _reconstructPacket(data[key], buffers);\n            }\n        }\n    }\n    return data;\n}\n","import { Emitter } from \"@socket.io/component-emitter\";\nimport { deconstructPacket, reconstructPacket } from \"./binary.js\";\nimport { isBinary, hasBinary } from \"./is-binary.js\";\n/**\n * These strings must not be used as event names, as they have a special meaning.\n */\nconst RESERVED_EVENTS = [\n    \"connect\",\n    \"connect_error\",\n    \"disconnect\",\n    \"disconnecting\",\n    \"newListener\",\n    \"removeListener\", // used by the Node.js EventEmitter\n];\n/**\n * Protocol version.\n *\n * @public\n */\nexport const protocol = 5;\nexport var PacketType;\n(function (PacketType) {\n    PacketType[PacketType[\"CONNECT\"] = 0] = \"CONNECT\";\n    PacketType[PacketType[\"DISCONNECT\"] = 1] = \"DISCONNECT\";\n    PacketType[PacketType[\"EVENT\"] = 2] = \"EVENT\";\n    PacketType[PacketType[\"ACK\"] = 3] = \"ACK\";\n    PacketType[PacketType[\"CONNECT_ERROR\"] = 4] = \"CONNECT_ERROR\";\n    PacketType[PacketType[\"BINARY_EVENT\"] = 5] = \"BINARY_EVENT\";\n    PacketType[PacketType[\"BINARY_ACK\"] = 6] = \"BINARY_ACK\";\n})(PacketType || (PacketType = {}));\n/**\n * A socket.io Encoder instance\n */\nexport class Encoder {\n    /**\n     * Encoder constructor\n     *\n     * @param {function} replacer - custom replacer to pass down to JSON.parse\n     */\n    constructor(replacer) {\n        this.replacer = replacer;\n    }\n    /**\n     * Encode a packet as a single string if non-binary, or as a\n     * buffer sequence, depending on packet type.\n     *\n     * @param {Object} obj - packet object\n     */\n    encode(obj) {\n        if (obj.type === PacketType.EVENT || obj.type === PacketType.ACK) {\n            if (hasBinary(obj)) {\n                return this.encodeAsBinary({\n                    type: obj.type === PacketType.EVENT\n                        ? PacketType.BINARY_EVENT\n                        : PacketType.BINARY_ACK,\n                    nsp: obj.nsp,\n                    data: obj.data,\n                    id: obj.id,\n                });\n            }\n        }\n        return [this.encodeAsString(obj)];\n    }\n    /**\n     * Encode packet as string.\n     */\n    encodeAsString(obj) {\n        // first is type\n        let str = \"\" + obj.type;\n        // attachments if we have them\n        if (obj.type === PacketType.BINARY_EVENT ||\n            obj.type === PacketType.BINARY_ACK) {\n            str += obj.attachments + \"-\";\n        }\n        // if we have a namespace other than `/`\n        // we append it followed by a comma `,`\n        if (obj.nsp && \"/\" !== obj.nsp) {\n            str += obj.nsp + \",\";\n        }\n        // immediately followed by the id\n        if (null != obj.id) {\n            str += obj.id;\n        }\n        // json data\n        if (null != obj.data) {\n            str += JSON.stringify(obj.data, this.replacer);\n        }\n        return str;\n    }\n    /**\n     * Encode packet as 'buffer sequence' by removing blobs, and\n     * deconstructing packet into object with placeholders and\n     * a list of buffers.\n     */\n    encodeAsBinary(obj) {\n        const deconstruction = deconstructPacket(obj);\n        const pack = this.encodeAsString(deconstruction.packet);\n        const buffers = deconstruction.buffers;\n        buffers.unshift(pack); // add packet info to beginning of data list\n        return buffers; // write all the buffers\n    }\n}\n// see https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript\nfunction isObject(value) {\n    return Object.prototype.toString.call(value) === \"[object Object]\";\n}\n/**\n * A socket.io Decoder instance\n *\n * @return {Object} decoder\n */\nexport class Decoder extends Emitter {\n    /**\n     * Decoder constructor\n     *\n     * @param {function} reviver - custom reviver to pass down to JSON.stringify\n     */\n    constructor(reviver) {\n        super();\n        this.reviver = reviver;\n    }\n    /**\n     * Decodes an encoded packet string into packet JSON.\n     *\n     * @param {String} obj - encoded packet\n     */\n    add(obj) {\n        let packet;\n        if (typeof obj === \"string\") {\n            if (this.reconstructor) {\n                throw new Error(\"got plaintext data when reconstructing a packet\");\n            }\n            packet = this.decodeString(obj);\n            const isBinaryEvent = packet.type === PacketType.BINARY_EVENT;\n            if (isBinaryEvent || packet.type === PacketType.BINARY_ACK) {\n                packet.type = isBinaryEvent ? PacketType.EVENT : PacketType.ACK;\n                // binary packet's json\n                this.reconstructor = new BinaryReconstructor(packet);\n                // no attachments, labeled binary but no binary data to follow\n                if (packet.attachments === 0) {\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n            else {\n                // non-binary full packet\n                super.emitReserved(\"decoded\", packet);\n            }\n        }\n        else if (isBinary(obj) || obj.base64) {\n            // raw binary data\n            if (!this.reconstructor) {\n                throw new Error(\"got binary data when not reconstructing a packet\");\n            }\n            else {\n                packet = this.reconstructor.takeBinaryData(obj);\n                if (packet) {\n                    // received final buffer\n                    this.reconstructor = null;\n                    super.emitReserved(\"decoded\", packet);\n                }\n            }\n        }\n        else {\n            throw new Error(\"Unknown type: \" + obj);\n        }\n    }\n    /**\n     * Decode a packet String (JSON data)\n     *\n     * @param {String} str\n     * @return {Object} packet\n     */\n    decodeString(str) {\n        let i = 0;\n        // look up type\n        const p = {\n            type: Number(str.charAt(0)),\n        };\n        if (PacketType[p.type] === undefined) {\n            throw new Error(\"unknown packet type \" + p.type);\n        }\n        // look up attachments if type binary\n        if (p.type === PacketType.BINARY_EVENT ||\n            p.type === PacketType.BINARY_ACK) {\n            const start = i + 1;\n            while (str.charAt(++i) !== \"-\" && i != str.length) { }\n            const buf = str.substring(start, i);\n            if (buf != Number(buf) || str.charAt(i) !== \"-\") {\n                throw new Error(\"Illegal attachments\");\n            }\n            p.attachments = Number(buf);\n        }\n        // look up namespace (if any)\n        if (\"/\" === str.charAt(i + 1)) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (\",\" === c)\n                    break;\n                if (i === str.length)\n                    break;\n            }\n            p.nsp = str.substring(start, i);\n        }\n        else {\n            p.nsp = \"/\";\n        }\n        // look up id\n        const next = str.charAt(i + 1);\n        if (\"\" !== next && Number(next) == next) {\n            const start = i + 1;\n            while (++i) {\n                const c = str.charAt(i);\n                if (null == c || Number(c) != c) {\n                    --i;\n                    break;\n                }\n                if (i === str.length)\n                    break;\n            }\n            p.id = Number(str.substring(start, i + 1));\n        }\n        // look up json data\n        if (str.charAt(++i)) {\n            const payload = this.tryParse(str.substr(i));\n            if (Decoder.isPayloadValid(p.type, payload)) {\n                p.data = payload;\n            }\n            else {\n                throw new Error(\"invalid payload\");\n            }\n        }\n        return p;\n    }\n    tryParse(str) {\n        try {\n            return JSON.parse(str, this.reviver);\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    static isPayloadValid(type, payload) {\n        switch (type) {\n            case PacketType.CONNECT:\n                return isObject(payload);\n            case PacketType.DISCONNECT:\n                return payload === undefined;\n            case PacketType.CONNECT_ERROR:\n                return typeof payload === \"string\" || isObject(payload);\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                return (Array.isArray(payload) &&\n                    (typeof payload[0] === \"number\" ||\n                        (typeof payload[0] === \"string\" &&\n                            RESERVED_EVENTS.indexOf(payload[0]) === -1)));\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                return Array.isArray(payload);\n        }\n    }\n    /**\n     * Deallocates a parser's resources\n     */\n    destroy() {\n        if (this.reconstructor) {\n            this.reconstructor.finishedReconstruction();\n            this.reconstructor = null;\n        }\n    }\n}\n/**\n * A manager of a binary event's 'buffer sequence'. Should\n * be constructed whenever a packet of type BINARY_EVENT is\n * decoded.\n *\n * @param {Object} packet\n * @return {BinaryReconstructor} initialized reconstructor\n */\nclass BinaryReconstructor {\n    constructor(packet) {\n        this.packet = packet;\n        this.buffers = [];\n        this.reconPack = packet;\n    }\n    /**\n     * Method to be called when binary data received from connection\n     * after a BINARY_EVENT packet.\n     *\n     * @param {Buffer | ArrayBuffer} binData - the raw binary data received\n     * @return {null | Object} returns null if more binary data is expected or\n     *   a reconstructed packet object if all buffers have been received.\n     */\n    takeBinaryData(binData) {\n        this.buffers.push(binData);\n        if (this.buffers.length === this.reconPack.attachments) {\n            // done with buffer list\n            const packet = reconstructPacket(this.reconPack, this.buffers);\n            this.finishedReconstruction();\n            return packet;\n        }\n        return null;\n    }\n    /**\n     * Cleans up binary packet reconstruction variables.\n     */\n    finishedReconstruction() {\n        this.reconPack = null;\n        this.buffers = [];\n    }\n}\n","export function on(obj, ev, fn) {\n    obj.on(ev, fn);\n    return function subDestroy() {\n        obj.off(ev, fn);\n    };\n}\n","import { PacketType } from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\n/**\n * Internal events.\n * These events can't be emitted by the user.\n */\nconst RESERVED_EVENTS = Object.freeze({\n    connect: 1,\n    connect_error: 1,\n    disconnect: 1,\n    disconnecting: 1,\n    // EventEmitter reserved events: https://nodejs.org/api/events.html#events_event_newlistener\n    newListener: 1,\n    removeListener: 1,\n});\n/**\n * A Socket is the fundamental class for interacting with the server.\n *\n * A Socket belongs to a certain Namespace (by default /) and uses an underlying {@link Manager} to communicate.\n *\n * @example\n * const socket = io();\n *\n * socket.on(\"connect\", () => {\n *   console.log(\"connected\");\n * });\n *\n * // send an event to the server\n * socket.emit(\"foo\", \"bar\");\n *\n * socket.on(\"foobar\", () => {\n *   // an event was received from the server\n * });\n *\n * // upon disconnection\n * socket.on(\"disconnect\", (reason) => {\n *   console.log(`disconnected due to ${reason}`);\n * });\n */\nexport class Socket extends Emitter {\n    /**\n     * `Socket` constructor.\n     */\n    constructor(io, nsp, opts) {\n        super();\n        /**\n         * Whether the socket is currently connected to the server.\n         *\n         * @example\n         * const socket = io();\n         *\n         * socket.on(\"connect\", () => {\n         *   console.log(socket.connected); // true\n         * });\n         *\n         * socket.on(\"disconnect\", () => {\n         *   console.log(socket.connected); // false\n         * });\n         */\n        this.connected = false;\n        /**\n         * Whether the connection state was recovered after a temporary disconnection. In that case, any missed packets will\n         * be transmitted by the server.\n         */\n        this.recovered = false;\n        /**\n         * Buffer for packets received before the CONNECT packet\n         */\n        this.receiveBuffer = [];\n        /**\n         * Buffer for packets that will be sent once the socket is connected\n         */\n        this.sendBuffer = [];\n        /**\n         * The queue of packets to be sent with retry in case of failure.\n         *\n         * Packets are sent one by one, each waiting for the server acknowledgement, in order to guarantee the delivery order.\n         * @private\n         */\n        this._queue = [];\n        /**\n         * A sequence to generate the ID of the {@link QueuedPacket}.\n         * @private\n         */\n        this._queueSeq = 0;\n        this.ids = 0;\n        /**\n         * A map containing acknowledgement handlers.\n         *\n         * The `withError` attribute is used to differentiate handlers that accept an error as first argument:\n         *\n         * - `socket.emit(\"test\", (err, value) => { ... })` with `ackTimeout` option\n         * - `socket.timeout(5000).emit(\"test\", (err, value) => { ... })`\n         * - `const value = await socket.emitWithAck(\"test\")`\n         *\n         * From those that don't:\n         *\n         * - `socket.emit(\"test\", (value) => { ... });`\n         *\n         * In the first case, the handlers will be called with an error when:\n         *\n         * - the timeout is reached\n         * - the socket gets disconnected\n         *\n         * In the second case, the handlers will be simply discarded upon disconnection, since the client will never receive\n         * an acknowledgement from the server.\n         *\n         * @private\n         */\n        this.acks = {};\n        this.flags = {};\n        this.io = io;\n        this.nsp = nsp;\n        if (opts && opts.auth) {\n            this.auth = opts.auth;\n        }\n        this._opts = Object.assign({}, opts);\n        if (this.io._autoConnect)\n            this.open();\n    }\n    /**\n     * Whether the socket is currently disconnected\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"connect\", () => {\n     *   console.log(socket.disconnected); // false\n     * });\n     *\n     * socket.on(\"disconnect\", () => {\n     *   console.log(socket.disconnected); // true\n     * });\n     */\n    get disconnected() {\n        return !this.connected;\n    }\n    /**\n     * Subscribe to open, close and packet events\n     *\n     * @private\n     */\n    subEvents() {\n        if (this.subs)\n            return;\n        const io = this.io;\n        this.subs = [\n            on(io, \"open\", this.onopen.bind(this)),\n            on(io, \"packet\", this.onpacket.bind(this)),\n            on(io, \"error\", this.onerror.bind(this)),\n            on(io, \"close\", this.onclose.bind(this)),\n        ];\n    }\n    /**\n     * Whether the Socket will try to reconnect when its Manager connects or reconnects.\n     *\n     * @example\n     * const socket = io();\n     *\n     * console.log(socket.active); // true\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   if (reason === \"io server disconnect\") {\n     *     // the disconnection was initiated by the server, you need to manually reconnect\n     *     console.log(socket.active); // false\n     *   }\n     *   // else the socket will automatically try to reconnect\n     *   console.log(socket.active); // true\n     * });\n     */\n    get active() {\n        return !!this.subs;\n    }\n    /**\n     * \"Opens\" the socket.\n     *\n     * @example\n     * const socket = io({\n     *   autoConnect: false\n     * });\n     *\n     * socket.connect();\n     */\n    connect() {\n        if (this.connected)\n            return this;\n        this.subEvents();\n        if (!this.io[\"_reconnecting\"])\n            this.io.open(); // ensure open\n        if (\"open\" === this.io._readyState)\n            this.onopen();\n        return this;\n    }\n    /**\n     * Alias for {@link connect()}.\n     */\n    open() {\n        return this.connect();\n    }\n    /**\n     * Sends a `message` event.\n     *\n     * This method mimics the WebSocket.send() method.\n     *\n     * @see https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/send\n     *\n     * @example\n     * socket.send(\"hello\");\n     *\n     * // this is equivalent to\n     * socket.emit(\"message\", \"hello\");\n     *\n     * @return self\n     */\n    send(...args) {\n        args.unshift(\"message\");\n        this.emit.apply(this, args);\n        return this;\n    }\n    /**\n     * Override `emit`.\n     * If the event is in `events`, it's emitted normally.\n     *\n     * @example\n     * socket.emit(\"hello\", \"world\");\n     *\n     * // all serializable datastructures are supported (no need to call JSON.stringify)\n     * socket.emit(\"hello\", 1, \"2\", { 3: [\"4\"], 5: Uint8Array.from([6]) });\n     *\n     * // with an acknowledgement from the server\n     * socket.emit(\"hello\", \"world\", (val) => {\n     *   // ...\n     * });\n     *\n     * @return self\n     */\n    emit(ev, ...args) {\n        var _a, _b, _c;\n        if (RESERVED_EVENTS.hasOwnProperty(ev)) {\n            throw new Error('\"' + ev.toString() + '\" is a reserved event name');\n        }\n        args.unshift(ev);\n        if (this._opts.retries && !this.flags.fromQueue && !this.flags.volatile) {\n            this._addToQueue(args);\n            return this;\n        }\n        const packet = {\n            type: PacketType.EVENT,\n            data: args,\n        };\n        packet.options = {};\n        packet.options.compress = this.flags.compress !== false;\n        // event ack callback\n        if (\"function\" === typeof args[args.length - 1]) {\n            const id = this.ids++;\n            const ack = args.pop();\n            this._registerAckCallback(id, ack);\n            packet.id = id;\n        }\n        const isTransportWritable = (_b = (_a = this.io.engine) === null || _a === void 0 ? void 0 : _a.transport) === null || _b === void 0 ? void 0 : _b.writable;\n        const isConnected = this.connected && !((_c = this.io.engine) === null || _c === void 0 ? void 0 : _c._hasPingExpired());\n        const discardPacket = this.flags.volatile && !isTransportWritable;\n        if (discardPacket) {\n        }\n        else if (isConnected) {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        }\n        else {\n            this.sendBuffer.push(packet);\n        }\n        this.flags = {};\n        return this;\n    }\n    /**\n     * @private\n     */\n    _registerAckCallback(id, ack) {\n        var _a;\n        const timeout = (_a = this.flags.timeout) !== null && _a !== void 0 ? _a : this._opts.ackTimeout;\n        if (timeout === undefined) {\n            this.acks[id] = ack;\n            return;\n        }\n        // @ts-ignore\n        const timer = this.io.setTimeoutFn(() => {\n            delete this.acks[id];\n            for (let i = 0; i < this.sendBuffer.length; i++) {\n                if (this.sendBuffer[i].id === id) {\n                    this.sendBuffer.splice(i, 1);\n                }\n            }\n            ack.call(this, new Error(\"operation has timed out\"));\n        }, timeout);\n        const fn = (...args) => {\n            // @ts-ignore\n            this.io.clearTimeoutFn(timer);\n            ack.apply(this, args);\n        };\n        fn.withError = true;\n        this.acks[id] = fn;\n    }\n    /**\n     * Emits an event and waits for an acknowledgement\n     *\n     * @example\n     * // without timeout\n     * const response = await socket.emitWithAck(\"hello\", \"world\");\n     *\n     * // with a specific timeout\n     * try {\n     *   const response = await socket.timeout(1000).emitWithAck(\"hello\", \"world\");\n     * } catch (err) {\n     *   // the server did not acknowledge the event in the given delay\n     * }\n     *\n     * @return a Promise that will be fulfilled when the server acknowledges the event\n     */\n    emitWithAck(ev, ...args) {\n        return new Promise((resolve, reject) => {\n            const fn = (arg1, arg2) => {\n                return arg1 ? reject(arg1) : resolve(arg2);\n            };\n            fn.withError = true;\n            args.push(fn);\n            this.emit(ev, ...args);\n        });\n    }\n    /**\n     * Add the packet to the queue.\n     * @param args\n     * @private\n     */\n    _addToQueue(args) {\n        let ack;\n        if (typeof args[args.length - 1] === \"function\") {\n            ack = args.pop();\n        }\n        const packet = {\n            id: this._queueSeq++,\n            tryCount: 0,\n            pending: false,\n            args,\n            flags: Object.assign({ fromQueue: true }, this.flags),\n        };\n        args.push((err, ...responseArgs) => {\n            if (packet !== this._queue[0]) {\n                // the packet has already been acknowledged\n                return;\n            }\n            const hasError = err !== null;\n            if (hasError) {\n                if (packet.tryCount > this._opts.retries) {\n                    this._queue.shift();\n                    if (ack) {\n                        ack(err);\n                    }\n                }\n            }\n            else {\n                this._queue.shift();\n                if (ack) {\n                    ack(null, ...responseArgs);\n                }\n            }\n            packet.pending = false;\n            return this._drainQueue();\n        });\n        this._queue.push(packet);\n        this._drainQueue();\n    }\n    /**\n     * Send the first packet of the queue, and wait for an acknowledgement from the server.\n     * @param force - whether to resend a packet that has not been acknowledged yet\n     *\n     * @private\n     */\n    _drainQueue(force = false) {\n        if (!this.connected || this._queue.length === 0) {\n            return;\n        }\n        const packet = this._queue[0];\n        if (packet.pending && !force) {\n            return;\n        }\n        packet.pending = true;\n        packet.tryCount++;\n        this.flags = packet.flags;\n        this.emit.apply(this, packet.args);\n    }\n    /**\n     * Sends a packet.\n     *\n     * @param packet\n     * @private\n     */\n    packet(packet) {\n        packet.nsp = this.nsp;\n        this.io._packet(packet);\n    }\n    /**\n     * Called upon engine `open`.\n     *\n     * @private\n     */\n    onopen() {\n        if (typeof this.auth == \"function\") {\n            this.auth((data) => {\n                this._sendConnectPacket(data);\n            });\n        }\n        else {\n            this._sendConnectPacket(this.auth);\n        }\n    }\n    /**\n     * Sends a CONNECT packet to initiate the Socket.IO session.\n     *\n     * @param data\n     * @private\n     */\n    _sendConnectPacket(data) {\n        this.packet({\n            type: PacketType.CONNECT,\n            data: this._pid\n                ? Object.assign({ pid: this._pid, offset: this._lastOffset }, data)\n                : data,\n        });\n    }\n    /**\n     * Called upon engine or manager `error`.\n     *\n     * @param err\n     * @private\n     */\n    onerror(err) {\n        if (!this.connected) {\n            this.emitReserved(\"connect_error\", err);\n        }\n    }\n    /**\n     * Called upon engine `close`.\n     *\n     * @param reason\n     * @param description\n     * @private\n     */\n    onclose(reason, description) {\n        this.connected = false;\n        delete this.id;\n        this.emitReserved(\"disconnect\", reason, description);\n        this._clearAcks();\n    }\n    /**\n     * Clears the acknowledgement handlers upon disconnection, since the client will never receive an acknowledgement from\n     * the server.\n     *\n     * @private\n     */\n    _clearAcks() {\n        Object.keys(this.acks).forEach((id) => {\n            const isBuffered = this.sendBuffer.some((packet) => String(packet.id) === id);\n            if (!isBuffered) {\n                // note: handlers that do not accept an error as first argument are ignored here\n                const ack = this.acks[id];\n                delete this.acks[id];\n                if (ack.withError) {\n                    ack.call(this, new Error(\"socket has been disconnected\"));\n                }\n            }\n        });\n    }\n    /**\n     * Called with socket packet.\n     *\n     * @param packet\n     * @private\n     */\n    onpacket(packet) {\n        const sameNamespace = packet.nsp === this.nsp;\n        if (!sameNamespace)\n            return;\n        switch (packet.type) {\n            case PacketType.CONNECT:\n                if (packet.data && packet.data.sid) {\n                    this.onconnect(packet.data.sid, packet.data.pid);\n                }\n                else {\n                    this.emitReserved(\"connect_error\", new Error(\"It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)\"));\n                }\n                break;\n            case PacketType.EVENT:\n            case PacketType.BINARY_EVENT:\n                this.onevent(packet);\n                break;\n            case PacketType.ACK:\n            case PacketType.BINARY_ACK:\n                this.onack(packet);\n                break;\n            case PacketType.DISCONNECT:\n                this.ondisconnect();\n                break;\n            case PacketType.CONNECT_ERROR:\n                this.destroy();\n                const err = new Error(packet.data.message);\n                // @ts-ignore\n                err.data = packet.data.data;\n                this.emitReserved(\"connect_error\", err);\n                break;\n        }\n    }\n    /**\n     * Called upon a server event.\n     *\n     * @param packet\n     * @private\n     */\n    onevent(packet) {\n        const args = packet.data || [];\n        if (null != packet.id) {\n            args.push(this.ack(packet.id));\n        }\n        if (this.connected) {\n            this.emitEvent(args);\n        }\n        else {\n            this.receiveBuffer.push(Object.freeze(args));\n        }\n    }\n    emitEvent(args) {\n        if (this._anyListeners && this._anyListeners.length) {\n            const listeners = this._anyListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, args);\n            }\n        }\n        super.emit.apply(this, args);\n        if (this._pid && args.length && typeof args[args.length - 1] === \"string\") {\n            this._lastOffset = args[args.length - 1];\n        }\n    }\n    /**\n     * Produces an ack callback to emit with an event.\n     *\n     * @private\n     */\n    ack(id) {\n        const self = this;\n        let sent = false;\n        return function (...args) {\n            // prevent double callbacks\n            if (sent)\n                return;\n            sent = true;\n            self.packet({\n                type: PacketType.ACK,\n                id: id,\n                data: args,\n            });\n        };\n    }\n    /**\n     * Called upon a server acknowledgement.\n     *\n     * @param packet\n     * @private\n     */\n    onack(packet) {\n        const ack = this.acks[packet.id];\n        if (typeof ack !== \"function\") {\n            return;\n        }\n        delete this.acks[packet.id];\n        // @ts-ignore FIXME ack is incorrectly inferred as 'never'\n        if (ack.withError) {\n            packet.data.unshift(null);\n        }\n        // @ts-ignore\n        ack.apply(this, packet.data);\n    }\n    /**\n     * Called upon server connect.\n     *\n     * @private\n     */\n    onconnect(id, pid) {\n        this.id = id;\n        this.recovered = pid && this._pid === pid;\n        this._pid = pid; // defined only if connection state recovery is enabled\n        this.connected = true;\n        this.emitBuffered();\n        this.emitReserved(\"connect\");\n        this._drainQueue(true);\n    }\n    /**\n     * Emit buffered events (received and emitted).\n     *\n     * @private\n     */\n    emitBuffered() {\n        this.receiveBuffer.forEach((args) => this.emitEvent(args));\n        this.receiveBuffer = [];\n        this.sendBuffer.forEach((packet) => {\n            this.notifyOutgoingListeners(packet);\n            this.packet(packet);\n        });\n        this.sendBuffer = [];\n    }\n    /**\n     * Called upon server disconnect.\n     *\n     * @private\n     */\n    ondisconnect() {\n        this.destroy();\n        this.onclose(\"io server disconnect\");\n    }\n    /**\n     * Called upon forced client/server side disconnections,\n     * this method ensures the manager stops tracking us and\n     * that reconnections don't get triggered for this.\n     *\n     * @private\n     */\n    destroy() {\n        if (this.subs) {\n            // clean subscriptions to avoid reconnections\n            this.subs.forEach((subDestroy) => subDestroy());\n            this.subs = undefined;\n        }\n        this.io[\"_destroy\"](this);\n    }\n    /**\n     * Disconnects the socket manually. In that case, the socket will not try to reconnect.\n     *\n     * If this is the last active Socket instance of the {@link Manager}, the low-level connection will be closed.\n     *\n     * @example\n     * const socket = io();\n     *\n     * socket.on(\"disconnect\", (reason) => {\n     *   // console.log(reason); prints \"io client disconnect\"\n     * });\n     *\n     * socket.disconnect();\n     *\n     * @return self\n     */\n    disconnect() {\n        if (this.connected) {\n            this.packet({ type: PacketType.DISCONNECT });\n        }\n        // remove socket from pool\n        this.destroy();\n        if (this.connected) {\n            // fire events\n            this.onclose(\"io client disconnect\");\n        }\n        return this;\n    }\n    /**\n     * Alias for {@link disconnect()}.\n     *\n     * @return self\n     */\n    close() {\n        return this.disconnect();\n    }\n    /**\n     * Sets the compress flag.\n     *\n     * @example\n     * socket.compress(false).emit(\"hello\");\n     *\n     * @param compress - if `true`, compresses the sending data\n     * @return self\n     */\n    compress(compress) {\n        this.flags.compress = compress;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the event message will be dropped when this socket is not\n     * ready to send messages.\n     *\n     * @example\n     * socket.volatile.emit(\"hello\"); // the server may or may not receive it\n     *\n     * @returns self\n     */\n    get volatile() {\n        this.flags.volatile = true;\n        return this;\n    }\n    /**\n     * Sets a modifier for a subsequent event emission that the callback will be called with an error when the\n     * given number of milliseconds have elapsed without an acknowledgement from the server:\n     *\n     * @example\n     * socket.timeout(5000).emit(\"my-event\", (err) => {\n     *   if (err) {\n     *     // the server did not acknowledge the event in the given delay\n     *   }\n     * });\n     *\n     * @returns self\n     */\n    timeout(timeout) {\n        this.flags.timeout = timeout;\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * @example\n     * socket.onAny((event, ...args) => {\n     *   console.log(`got ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * @example\n     * socket.prependAny((event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAny(listener) {\n        this._anyListeners = this._anyListeners || [];\n        this._anyListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`got event ${event}`);\n     * }\n     *\n     * socket.onAny(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAny(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAny();\n     *\n     * @param listener\n     */\n    offAny(listener) {\n        if (!this._anyListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAny() {\n        return this._anyListeners || [];\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.onAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    onAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.push(listener);\n        return this;\n    }\n    /**\n     * Adds a listener that will be fired when any event is emitted. The event name is passed as the first argument to the\n     * callback. The listener is added to the beginning of the listeners array.\n     *\n     * Note: acknowledgements sent to the server are not included.\n     *\n     * @example\n     * socket.prependAnyOutgoing((event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * });\n     *\n     * @param listener\n     */\n    prependAnyOutgoing(listener) {\n        this._anyOutgoingListeners = this._anyOutgoingListeners || [];\n        this._anyOutgoingListeners.unshift(listener);\n        return this;\n    }\n    /**\n     * Removes the listener that will be fired when any event is emitted.\n     *\n     * @example\n     * const catchAllListener = (event, ...args) => {\n     *   console.log(`sent event ${event}`);\n     * }\n     *\n     * socket.onAnyOutgoing(catchAllListener);\n     *\n     * // remove a specific listener\n     * socket.offAnyOutgoing(catchAllListener);\n     *\n     * // or remove all listeners\n     * socket.offAnyOutgoing();\n     *\n     * @param [listener] - the catch-all listener (optional)\n     */\n    offAnyOutgoing(listener) {\n        if (!this._anyOutgoingListeners) {\n            return this;\n        }\n        if (listener) {\n            const listeners = this._anyOutgoingListeners;\n            for (let i = 0; i < listeners.length; i++) {\n                if (listener === listeners[i]) {\n                    listeners.splice(i, 1);\n                    return this;\n                }\n            }\n        }\n        else {\n            this._anyOutgoingListeners = [];\n        }\n        return this;\n    }\n    /**\n     * Returns an array of listeners that are listening for any event that is specified. This array can be manipulated,\n     * e.g. to remove listeners.\n     */\n    listenersAnyOutgoing() {\n        return this._anyOutgoingListeners || [];\n    }\n    /**\n     * Notify the listeners for each packet sent\n     *\n     * @param packet\n     *\n     * @private\n     */\n    notifyOutgoingListeners(packet) {\n        if (this._anyOutgoingListeners && this._anyOutgoingListeners.length) {\n            const listeners = this._anyOutgoingListeners.slice();\n            for (const listener of listeners) {\n                listener.apply(this, packet.data);\n            }\n        }\n    }\n}\n","/**\n * Initialize backoff timer with `opts`.\n *\n * - `min` initial timeout in milliseconds [100]\n * - `max` max timeout [10000]\n * - `jitter` [0]\n * - `factor` [2]\n *\n * @param {Object} opts\n * @api public\n */\nexport function Backoff(opts) {\n    opts = opts || {};\n    this.ms = opts.min || 100;\n    this.max = opts.max || 10000;\n    this.factor = opts.factor || 2;\n    this.jitter = opts.jitter > 0 && opts.jitter <= 1 ? opts.jitter : 0;\n    this.attempts = 0;\n}\n/**\n * Return the backoff duration.\n *\n * @return {Number}\n * @api public\n */\nBackoff.prototype.duration = function () {\n    var ms = this.ms * Math.pow(this.factor, this.attempts++);\n    if (this.jitter) {\n        var rand = Math.random();\n        var deviation = Math.floor(rand * this.jitter * ms);\n        ms = (Math.floor(rand * 10) & 1) == 0 ? ms - deviation : ms + deviation;\n    }\n    return Math.min(ms, this.max) | 0;\n};\n/**\n * Reset the number of attempts.\n *\n * @api public\n */\nBackoff.prototype.reset = function () {\n    this.attempts = 0;\n};\n/**\n * Set the minimum duration\n *\n * @api public\n */\nBackoff.prototype.setMin = function (min) {\n    this.ms = min;\n};\n/**\n * Set the maximum duration\n *\n * @api public\n */\nBackoff.prototype.setMax = function (max) {\n    this.max = max;\n};\n/**\n * Set the jitter\n *\n * @api public\n */\nBackoff.prototype.setJitter = function (jitter) {\n    this.jitter = jitter;\n};\n","import { Socket as Engine, installTimerFunctions, nextTick, } from \"engine.io-client\";\nimport { Socket } from \"./socket.js\";\nimport * as parser from \"socket.io-parser\";\nimport { on } from \"./on.js\";\nimport { Backoff } from \"./contrib/backo2.js\";\nimport { Emitter, } from \"@socket.io/component-emitter\";\nexport class Manager extends Emitter {\n    constructor(uri, opts) {\n        var _a;\n        super();\n        this.nsps = {};\n        this.subs = [];\n        if (uri && \"object\" === typeof uri) {\n            opts = uri;\n            uri = undefined;\n        }\n        opts = opts || {};\n        opts.path = opts.path || \"/socket.io\";\n        this.opts = opts;\n        installTimerFunctions(this, opts);\n        this.reconnection(opts.reconnection !== false);\n        this.reconnectionAttempts(opts.reconnectionAttempts || Infinity);\n        this.reconnectionDelay(opts.reconnectionDelay || 1000);\n        this.reconnectionDelayMax(opts.reconnectionDelayMax || 5000);\n        this.randomizationFactor((_a = opts.randomizationFactor) !== null && _a !== void 0 ? _a : 0.5);\n        this.backoff = new Backoff({\n            min: this.reconnectionDelay(),\n            max: this.reconnectionDelayMax(),\n            jitter: this.randomizationFactor(),\n        });\n        this.timeout(null == opts.timeout ? 20000 : opts.timeout);\n        this._readyState = \"closed\";\n        this.uri = uri;\n        const _parser = opts.parser || parser;\n        this.encoder = new _parser.Encoder();\n        this.decoder = new _parser.Decoder();\n        this._autoConnect = opts.autoConnect !== false;\n        if (this._autoConnect)\n            this.open();\n    }\n    reconnection(v) {\n        if (!arguments.length)\n            return this._reconnection;\n        this._reconnection = !!v;\n        if (!v) {\n            this.skipReconnect = true;\n        }\n        return this;\n    }\n    reconnectionAttempts(v) {\n        if (v === undefined)\n            return this._reconnectionAttempts;\n        this._reconnectionAttempts = v;\n        return this;\n    }\n    reconnectionDelay(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelay;\n        this._reconnectionDelay = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMin(v);\n        return this;\n    }\n    randomizationFactor(v) {\n        var _a;\n        if (v === undefined)\n            return this._randomizationFactor;\n        this._randomizationFactor = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setJitter(v);\n        return this;\n    }\n    reconnectionDelayMax(v) {\n        var _a;\n        if (v === undefined)\n            return this._reconnectionDelayMax;\n        this._reconnectionDelayMax = v;\n        (_a = this.backoff) === null || _a === void 0 ? void 0 : _a.setMax(v);\n        return this;\n    }\n    timeout(v) {\n        if (!arguments.length)\n            return this._timeout;\n        this._timeout = v;\n        return this;\n    }\n    /**\n     * Starts trying to reconnect if reconnection is enabled and we have not\n     * started reconnecting yet\n     *\n     * @private\n     */\n    maybeReconnectOnOpen() {\n        // Only try to reconnect if it's the first time we're connecting\n        if (!this._reconnecting &&\n            this._reconnection &&\n            this.backoff.attempts === 0) {\n            // keeps reconnection from firing twice for the same reconnection loop\n            this.reconnect();\n        }\n    }\n    /**\n     * Sets the current transport `socket`.\n     *\n     * @param {Function} fn - optional, callback\n     * @return self\n     * @public\n     */\n    open(fn) {\n        if (~this._readyState.indexOf(\"open\"))\n            return this;\n        this.engine = new Engine(this.uri, this.opts);\n        const socket = this.engine;\n        const self = this;\n        this._readyState = \"opening\";\n        this.skipReconnect = false;\n        // emit `open`\n        const openSubDestroy = on(socket, \"open\", function () {\n            self.onopen();\n            fn && fn();\n        });\n        const onError = (err) => {\n            this.cleanup();\n            this._readyState = \"closed\";\n            this.emitReserved(\"error\", err);\n            if (fn) {\n                fn(err);\n            }\n            else {\n                // Only do this if there is no fn to handle the error\n                this.maybeReconnectOnOpen();\n            }\n        };\n        // emit `error`\n        const errorSub = on(socket, \"error\", onError);\n        if (false !== this._timeout) {\n            const timeout = this._timeout;\n            // set timer\n            const timer = this.setTimeoutFn(() => {\n                openSubDestroy();\n                onError(new Error(\"timeout\"));\n                socket.close();\n            }, timeout);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n        this.subs.push(openSubDestroy);\n        this.subs.push(errorSub);\n        return this;\n    }\n    /**\n     * Alias for open()\n     *\n     * @return self\n     * @public\n     */\n    connect(fn) {\n        return this.open(fn);\n    }\n    /**\n     * Called upon transport open.\n     *\n     * @private\n     */\n    onopen() {\n        // clear old subs\n        this.cleanup();\n        // mark as open\n        this._readyState = \"open\";\n        this.emitReserved(\"open\");\n        // add new subs\n        const socket = this.engine;\n        this.subs.push(on(socket, \"ping\", this.onping.bind(this)), on(socket, \"data\", this.ondata.bind(this)), on(socket, \"error\", this.onerror.bind(this)), on(socket, \"close\", this.onclose.bind(this)), \n        // @ts-ignore\n        on(this.decoder, \"decoded\", this.ondecoded.bind(this)));\n    }\n    /**\n     * Called upon a ping.\n     *\n     * @private\n     */\n    onping() {\n        this.emitReserved(\"ping\");\n    }\n    /**\n     * Called with data.\n     *\n     * @private\n     */\n    ondata(data) {\n        try {\n            this.decoder.add(data);\n        }\n        catch (e) {\n            this.onclose(\"parse error\", e);\n        }\n    }\n    /**\n     * Called when parser fully decodes a packet.\n     *\n     * @private\n     */\n    ondecoded(packet) {\n        // the nextTick call prevents an exception in a user-provided event listener from triggering a disconnection due to a \"parse error\"\n        nextTick(() => {\n            this.emitReserved(\"packet\", packet);\n        }, this.setTimeoutFn);\n    }\n    /**\n     * Called upon socket error.\n     *\n     * @private\n     */\n    onerror(err) {\n        this.emitReserved(\"error\", err);\n    }\n    /**\n     * Creates a new socket for the given `nsp`.\n     *\n     * @return {Socket}\n     * @public\n     */\n    socket(nsp, opts) {\n        let socket = this.nsps[nsp];\n        if (!socket) {\n            socket = new Socket(this, nsp, opts);\n            this.nsps[nsp] = socket;\n        }\n        else if (this._autoConnect && !socket.active) {\n            socket.connect();\n        }\n        return socket;\n    }\n    /**\n     * Called upon a socket close.\n     *\n     * @param socket\n     * @private\n     */\n    _destroy(socket) {\n        const nsps = Object.keys(this.nsps);\n        for (const nsp of nsps) {\n            const socket = this.nsps[nsp];\n            if (socket.active) {\n                return;\n            }\n        }\n        this._close();\n    }\n    /**\n     * Writes a packet.\n     *\n     * @param packet\n     * @private\n     */\n    _packet(packet) {\n        const encodedPackets = this.encoder.encode(packet);\n        for (let i = 0; i < encodedPackets.length; i++) {\n            this.engine.write(encodedPackets[i], packet.options);\n        }\n    }\n    /**\n     * Clean up transport subscriptions and packet buffer.\n     *\n     * @private\n     */\n    cleanup() {\n        this.subs.forEach((subDestroy) => subDestroy());\n        this.subs.length = 0;\n        this.decoder.destroy();\n    }\n    /**\n     * Close the current socket.\n     *\n     * @private\n     */\n    _close() {\n        this.skipReconnect = true;\n        this._reconnecting = false;\n        this.onclose(\"forced close\");\n    }\n    /**\n     * Alias for close()\n     *\n     * @private\n     */\n    disconnect() {\n        return this._close();\n    }\n    /**\n     * Called when:\n     *\n     * - the low-level engine is closed\n     * - the parser encountered a badly formatted packet\n     * - all sockets are disconnected\n     *\n     * @private\n     */\n    onclose(reason, description) {\n        var _a;\n        this.cleanup();\n        (_a = this.engine) === null || _a === void 0 ? void 0 : _a.close();\n        this.backoff.reset();\n        this._readyState = \"closed\";\n        this.emitReserved(\"close\", reason, description);\n        if (this._reconnection && !this.skipReconnect) {\n            this.reconnect();\n        }\n    }\n    /**\n     * Attempt a reconnection.\n     *\n     * @private\n     */\n    reconnect() {\n        if (this._reconnecting || this.skipReconnect)\n            return this;\n        const self = this;\n        if (this.backoff.attempts >= this._reconnectionAttempts) {\n            this.backoff.reset();\n            this.emitReserved(\"reconnect_failed\");\n            this._reconnecting = false;\n        }\n        else {\n            const delay = this.backoff.duration();\n            this._reconnecting = true;\n            const timer = this.setTimeoutFn(() => {\n                if (self.skipReconnect)\n                    return;\n                this.emitReserved(\"reconnect_attempt\", self.backoff.attempts);\n                // check again for the case socket closed in above events\n                if (self.skipReconnect)\n                    return;\n                self.open((err) => {\n                    if (err) {\n                        self._reconnecting = false;\n                        self.reconnect();\n                        this.emitReserved(\"reconnect_error\", err);\n                    }\n                    else {\n                        self.onreconnect();\n                    }\n                });\n            }, delay);\n            if (this.opts.autoUnref) {\n                timer.unref();\n            }\n            this.subs.push(() => {\n                this.clearTimeoutFn(timer);\n            });\n        }\n    }\n    /**\n     * Called upon successful reconnect.\n     *\n     * @private\n     */\n    onreconnect() {\n        const attempt = this.backoff.attempts;\n        this._reconnecting = false;\n        this.backoff.reset();\n        this.emitReserved(\"reconnect\", attempt);\n    }\n}\n","import { url } from \"./url.js\";\nimport { Manager } from \"./manager.js\";\nimport { Socket } from \"./socket.js\";\n/**\n * Managers cache.\n */\nconst cache = {};\nfunction lookup(uri, opts) {\n    if (typeof uri === \"object\") {\n        opts = uri;\n        uri = undefined;\n    }\n    opts = opts || {};\n    const parsed = url(uri, opts.path || \"/socket.io\");\n    const source = parsed.source;\n    const id = parsed.id;\n    const path = parsed.path;\n    const sameNamespace = cache[id] && path in cache[id][\"nsps\"];\n    const newConnection = opts.forceNew ||\n        opts[\"force new connection\"] ||\n        false === opts.multiplex ||\n        sameNamespace;\n    let io;\n    if (newConnection) {\n        io = new Manager(source, opts);\n    }\n    else {\n        if (!cache[id]) {\n            cache[id] = new Manager(source, opts);\n        }\n        io = cache[id];\n    }\n    if (parsed.query && !opts.query) {\n        opts.query = parsed.queryKey;\n    }\n    return io.socket(parsed.path, opts);\n}\n// so that \"lookup\" can be used both as a function (e.g. `io(...)`) and as a\n// namespace (e.g. `io.connect(...)`), for backward compatibility\nObject.assign(lookup, {\n    Manager,\n    Socket,\n    io: lookup,\n    connect: lookup,\n});\n/**\n * Protocol version.\n *\n * @public\n */\nexport { protocol } from \"socket.io-parser\";\n/**\n * Expose constructors for standalone build.\n *\n * @public\n */\nexport { Manager, Socket, lookup as io, lookup as connect, lookup as default, };\nexport { Fetch, NodeXHR, XHR, NodeWebSocket, WebSocket, WebTransport, } from \"engine.io-client\";\n","import { io, Socket } from 'socket.io-client';\n\nexport class MapEventsSocket {\n  private socket!: Socket;\n  private isConnected: boolean = false;\n  private reconnectAttempts: number = 0;\n  private readonly maxReconnectAttempts: number = 5;\n  private connectionPromise: Promise<void>;\n  private resolveConnection!: () => void;\n  private rejectConnection!: (reason: any) => void;\n\n  constructor() {\n    this.connectionPromise = new Promise((resolve, reject) => {\n      this.resolveConnection = resolve;\n      this.rejectConnection = reject;\n    });\n    this.initializeSocket();\n  }\n\n  private initializeSocket() {\n    this.socket = io('http://localhost:3000/map-events', {\n      withCredentials: true,\n      reconnection: true,\n      reconnectionAttempts: this.maxReconnectAttempts,\n      reconnectionDelay: 1000,\n      transports: ['websocket'],\n      upgrade: false\n    });\n\n    this.setupEventListeners();\n  }\n\n  private setupEventListeners() {\n    this.socket.on('connect', () => {\n      console.log('Connected to map events WebSocket server');\n      this.isConnected = true;\n      this.reconnectAttempts = 0;\n      this.resolveConnection();\n    });\n\n    this.socket.on('disconnect', () => {\n      console.log('Disconnected from map events WebSocket server');\n      this.isConnected = false;\n      // Reset connection promise for next connection attempt\n      this.connectionPromise = new Promise((resolve, reject) => {\n        this.resolveConnection = resolve;\n        this.rejectConnection = reject;\n      });\n    });\n\n    this.socket.on('connect_error', (error) => {\n      console.error('WebSocket connection error:', error);\n      this.reconnectAttempts++;\n      \n      if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n        console.error('Max reconnection attempts reached, falling back to HTTP');\n        this.rejectConnection(error);\n      }\n    });\n  }\n\n  public async waitForConnection(): Promise<void> {\n    if (this.isConnected) {\n      return Promise.resolve();\n    }\n    return this.connectionPromise;\n  }\n\n  public async sendRoomState(players: any[], map: any): Promise<void> {\n    try {\n      await this.waitForConnection();\n      \n      this.socket.emit('room-state', { players, map }, (response: any) => {\n        if (response?.status === 'error') {\n          console.error('Error sending room state:', response.message);\n        }\n      });\n    } catch (error) {\n      console.error('Failed to send room state:', error);\n      throw error;\n    }\n  }\n\n  public async sendPlayerMove(player: any, oldPosition: any, newPosition: any): Promise<void> {\n    try {\n      await this.waitForConnection();\n\n      this.socket.emit('player-move', {\n        data: {\n          type: 'move',\n          player,\n          oldPosition,\n          newPosition\n        }\n      }, (response: any) => {\n        if (response?.status === 'error') {\n          console.error('Error sending player move:', response.message);\n        }\n      });\n    } catch (error) {\n      console.error('Failed to send player move:', error);\n      throw error;\n    }\n  }\n\n  public async sendPlayerEnter(player: any): Promise<void> {\n    try {\n      await this.waitForConnection();\n\n      this.socket.emit('player-enter', {\n        data: {\n          type: 'enter',\n          player\n        }\n      }, (response: any) => {\n        if (response?.status === 'error') {\n          console.error('Error sending player enter:', response.message);\n        }\n      });\n    } catch (error) {\n      console.error('Failed to send player enter:', error);\n      throw error;\n    }\n  }\n\n  public async sendPlayerLeave(player: any): Promise<void> {\n    try {\n      await this.waitForConnection();\n\n      this.socket.emit('player-leave', {\n        data: {\n          type: 'leave',\n          player\n        }\n      }, (response: any) => {\n        if (response?.status === 'error') {\n          console.error('Error sending player leave:', response.message);\n        }\n      });\n    } catch (error) {\n      console.error('Failed to send player leave:', error);\n      throw error;\n    }\n  }\n\n  public disconnect() {\n    if (this.socket) {\n      this.socket.disconnect();\n    }\n  }\n} ","/// <reference types=\"@workadventure/iframe-api-typings\" />\n\nimport { bootstrapExtra, getVariables } from \"@workadventure/scripting-api-extra\";\nimport { updateMyPlace } from \"./places\";\nimport { RemotePlayerInterface } from \"@workadventure/iframe-api-typings\";\nimport { RemotePlayerMoved } from \"@workadventure/iframe-api-typings/play/src/front/Api/Iframe/Players/RemotePlayer\";\n// import { robot } from \"./robot\";\nimport { MapEventsSocket } from \"./map-events-socket\";\n\nconsole.log('Script started successfully');\n\nlet currentPopup: any = undefined;\nlet mapEventsSocket: MapEventsSocket;\n\n// Waiting for the API to be ready\nWA.onInit().then(async () => {\n    console.log('Scripting API ready');\n    console.log('Player tags: ',WA.player.tags);\n    const variables = await getVariables();\n    console.log(variables);\n\n    // Initialize WebSocket connection\n    mapEventsSocket = new MapEventsSocket();\n\n    WA.room.area.onEnter('clock').subscribe(() => {\n        const today = new Date();\n        const time = today.getHours() + \":\" + today.getMinutes();\n        currentPopup = WA.ui.openPopup(\"clockPopup\", \"It's \" + time, []);\n    })\n\n    WA.room.area.onLeave('clock').subscribe(closePopup)\n\n    // The line below bootstraps the Scripting API Extra library that adds a number of advanced properties/features to WorkAdventure\n    bootstrapExtra().then(async () => {\n        console.log('Scripting API Extra ready');\n        WA.players.configureTracking({\n            players: true,\n            movement: true,\n        });\n\n        const roomId = WA.room.id;\n        const roomIdWithoutProtocol = roomId.split('~')[1];\n        console.log('Room ID without protocol: ', roomIdWithoutProtocol);\n        const folderName = roomIdWithoutProtocol.split('/')[1];\n        const officeName = roomIdWithoutProtocol.split('/')[2];\n        console.log('Folder ID: ', folderName);\n        console.log('Room ID: ', officeName);\n        \n        const players = await WA.players.list();\n        console.log('Players: ', players);\n        const tiledMap = await WA.room.getTiledMap();\n        \n        // Send initial state through WebSocket\n        console.log('Sending initial state through WebSocket...');\n        try {\n            await mapEventsSocket.sendRoomState([], tiledMap);\n            console.log('Initial state sent successfully');\n        } catch (error) {\n            console.error('Failed to send initial state:', error);\n        }\n\n        // Subscribe to player events and forward them through WebSocket\n        WA.players.onPlayerMoves.subscribe(async (event: RemotePlayerMoved) => {\n            const player = event.player;\n            const oldPosition = event.oldPosition;\n            const newPosition = event.newPosition;\n            console.log(`Player ${player.name} moved from ${oldPosition.x},${oldPosition.y} to ${newPosition.x},${newPosition.y}`);\n            \n            try {\n                console.log(`Sending player move event for ${player.name} through WebSocket`);\n                await mapEventsSocket.sendPlayerMove(player, oldPosition, newPosition);\n                console.log(`Player move event sent successfully for ${player.name}`);\n            } catch (error) {\n                console.error(`Failed to send player move event for ${player.name}:`, error);\n            }\n        });\n\n        WA.players.onPlayerEnters.subscribe(async (player: RemotePlayerInterface) => {\n            console.log(`Player ${player.name} entered your nearby zone`);\n            \n            try {\n                console.log(`Sending player enter event for ${player.name} through WebSocket`);\n                await mapEventsSocket.sendPlayerEnter(player);\n                console.log(`Player enter event sent successfully for ${player.name}`);\n            } catch (error) {\n                console.error(`Failed to send player enter event for ${player.name}:`, error);\n            }\n        });\n\n        WA.players.onPlayerLeaves.subscribe(async (player: RemotePlayerInterface) => {\n            console.log(`Player ${player.name} left your nearby zone`);\n            \n            try {\n                console.log(`Sending player leave event for ${player.name} through WebSocket`);\n                await mapEventsSocket.sendPlayerLeave(player);\n                console.log(`Player leave event sent successfully for ${player.name}`);\n            } catch (error) {\n                console.error(`Failed to send player leave event for ${player.name}:`, error);\n            }\n        });\n\n        updateMyPlace();\n    \n        // Let's initialize the \"tags\" variable to expose our tags to others\n        WA.player.state.saveVariable('tags', WA.player.tags, {\n            persist: false,\n            public: true,\n        });\n\n        // robot.init();\n       \n    }).catch(e => console.error(e));\n\n}).catch(e => console.error(e));\n\nfunction closePopup(){\n    if (currentPopup !== undefined) {\n        currentPopup.close();\n        currentPopup = undefined;\n    }\n}\n\n// Clean up WebSocket connection when the window is closed\nwindow.addEventListener('beforeunload', () => {\n    if (mapEventsSocket) {\n        mapEventsSocket.disconnect();\n    }\n});\n\nexport {};\n"],"names":["Properties","properties","name","values","property","type","value","types","defaultAssetsUrl","VariableDescriptor","object","readableBy","writableBy","openConfig","variables","parameters","getVariables","layerFilter","variablesFilter","map","getAllVariablesRecursive","layers","layer","layersMapPromise","getLayersMap","getLayersMapWithoutCache","flattenGroupLayersMap","flatLayers","flattenGroupLayers","prefix","getAreaObject","areaArray","findLayerBoundaries","left","top","bottom","right","data","j","i","findLayersBoundaries","boundaries","objectToString","isArray","isFunction","typeStr","obj","escapeRegExp","string","hasProperty","propName","primitiveHasOwnProperty","primitive","regExpTest","testRegExp","re","nonSpaceRe","isWhitespace","entityMap","escapeHtml","s","whiteRe","spaceRe","equalsRe","curlyRe","tagRe","parseTemplate","template","tags","lineHasNonSpace","sections","tokens","spaces","hasTag","nonSpace","indentation","tagIndex","stripSpace","openingTagRe","closingTagRe","closingCurlyRe","compileTags","tagsToCompile","mustache","scanner","Scanner","start","chr","token","openSection","valueLength","nestTokens","squashTokens","squashedTokens","lastToken","numTokens","nestedTokens","collector","section","match","index","Context","view","parentContext","cache","context","intermediateValue","names","lookupHit","Writer","key","cacheKey","isCacheEnabled","partials","config","originalTemplate","buffer","symbol","self","subRender","partial","filteredIndentation","partialByNl","indentedValue","escape","defaultWriter","TemplateValue","state","Mustache","callback","subscriptions","variableName","newValue","subscription","ast","subAst","initPropertiesTemplatesArea","_a","areas","area","setPropertyArea","initPropertiesTemplates","layerName","setProperty","areaName","propertyName","workadventureAssetsHtmlUrl","layersMap","playerX","playerY","updateDoorLayers","variable","playOpenSound","url","radius","volume","distance","getDistance","playCloseSound","getTileLayers","layerNames","xLayer","yLayer","initDoor","initDoorstep","doorstepZone","doorVariable","assetsUrl","actionMessage","keypadWebsite","inZone","tag","allowed","accessRestricted","displayCloseDoorMessage","displayOpenDoorMessage","openKeypad","closeKeypad","onEnter","onLeave","playBellSound","initBell","initBellLayer","bellVariable","bellZone","popup","bellPopupName","objectName","initDoors","doorVariableName","moveEvent","initVariableActionLayer","enterValue","leaveValue","triggerMessage","setupVariableActionLayer","initSpecialProperties","initConfiguration","configurationLayer","openConfigVariables","initLocalConfigurationPanel","allowedByTag","displayConfigurationMessage","closeConfigurationPanel","openConfigTriggerValue","bootstrapExtra","e","findPlaces","resolve","zones","updateMyPlace","places","PACKET_TYPES","PACKET_TYPES_REVERSE","ERROR_PACKET","withNativeBlob","withNativeArrayBuffer","isView","encodePacket","supportsBinary","encodeBlobAsBase64","fileReader","content","toArray","TEXT_ENCODER","encodePacketToBinary","packet","encoded","chars","lookup","decode","base64","bufferLength","len","p","encoded1","encoded2","encoded3","encoded4","arraybuffer","bytes","decodePacket","encodedPacket","binaryType","mapBinary","decodeBase64Packet","decoded","SEPARATOR","encodePayload","packets","length","encodedPackets","count","decodePayload","encodedPayload","decodedPacket","createPacketEncoderStream","controller","payloadLength","header","TEXT_DECODER","totalLength","chunks","acc","chunk","concatChunks","size","createPacketDecoderStream","maxPayload","expectedLength","isBinary","headerArray","n","protocol","Emitter","mixin","event","fn","on","callbacks","cb","args","nextTick","setTimeoutFn","globalThisShim","defaultBinaryType","pick","attr","k","NATIVE_SET_TIMEOUT","globalThis","NATIVE_CLEAR_TIMEOUT","installTimerFunctions","opts","BASE64_OVERHEAD","byteLength","utf8Length","str","c","l","randomString","encode","qs","qry","pairs","pair","TransportError","reason","description","Transport","details","onPause","schema","query","hostname","encodedQuery","Polling","pause","total","close","hasCORS","empty","BaseXHR","isSSL","port","req","xhrStatus","Request","createRequest","uri","xhr","err","fromError","unloadHandler","terminationEvent","hasXHR2","newRequest","XHR","forceBase64","xdomain","isReactNative","BaseWS","protocols","closeEvent","ev","lastPacket","WebSocketCtor","WS","_packet","WT","stream","decoderStream","reader","encoderStream","read","done","transports","parts","parse","src","b","m","pathNames","queryKey","path","regx","$0","$1","$2","withEventListeners","OFFLINE_EVENT_LISTENERS","listener","SocketWithoutUpgrade","parsedUri","t","transportName","transport","delay","payloadSize","hasExpired","msg","options","cleanupAndClose","waitForUpgrade","SocketWithUpgrade","failed","onTransportOpen","cleanup","freezeTransport","onerror","error","onTransportClose","onclose","onupgrade","to","upgrades","filteredUpgrades","o","DEFAULT_TRANSPORTS","loc","host","toString","withNativeFile","hasBinary","toJSON","deconstructPacket","buffers","packetData","pack","_deconstructPacket","placeholder","newData","reconstructPacket","_reconstructPacket","RESERVED_EVENTS","PacketType","Encoder","replacer","deconstruction","isObject","Decoder","reviver","isBinaryEvent","BinaryReconstructor","buf","next","payload","binData","Socket","io","nsp","_b","_c","id","ack","isTransportWritable","isConnected","timeout","timer","reject","arg1","arg2","responseArgs","force","listeners","sent","pid","subDestroy","compress","Backoff","ms","rand","deviation","min","max","jitter","Manager","_parser","parser","v","Engine","socket","openSubDestroy","onError","errorSub","nsps","attempt","parsed","source","sameNamespace","newConnection","MapEventsSocket","__publicField","players","response","player","oldPosition","newPosition","currentPopup","mapEventsSocket","today","time","closePopup","roomIdWithoutProtocol","folderName","officeName","tiledMap"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42]}