var Tn=Object.defineProperty;var En=(n,e,t)=>e in n?Tn(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var W=(n,e,t)=>(En(n,typeof e!="symbol"?e+"":e,t),t);class ie{constructor(e){this.properties=e??[]}get(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.value);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}getString(e){return this.getByType(e,"string")}getNumber(e){return this.getByType(e,"number")}getBoolean(e){return this.getByType(e,"boolean")}getByType(e,t){const r=this.get(e);if(r!==void 0){if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}}mustGetString(e){return this.mustGetByType(e,"string")}mustGetNumber(e){return this.mustGetByType(e,"number")}mustGetBoolean(e){return this.mustGetByType(e,"boolean")}mustGetByType(e,t){const r=this.get(e);if(r===void 0)throw new Error('Property "'+e+'" is missing');if(t!=="json"&&typeof r!==t)throw new Error('Expected property "'+e+'" to have type "'+t+'"');return r}getType(e){const t=this.properties.filter(r=>r.name===e).map(r=>r.type);if(t.length>1)throw new Error('Expected only one property to be named "'+e+'"');if(t.length!==0)return t[0]}}const $t="https://unpkg.com/@workadventure/scripting-api-extra@1.9.1/dist";class An{constructor(e){this.name=e.name,this.x=e.x,this.y=e.y,this.properties=new ie(e.properties)}get isReadable(){const e=this.properties.getString("readableBy");return e?WA.player.tags.includes(e):!0}get isWritable(){const e=this.properties.getString("writableBy");return e?WA.player.tags.includes(e):!0}}function At(n){const e=n?"#"+n.join():"";WA.nav.openCoWebSite($t+"/configuration.html"+e,!0)}async function Ut(n,e){const t=await WA.room.getTiledMap(),r=new Map;return zt(t.layers,r,n,e),r}function zt(n,e,t,r){for(const s of n)if(s.type==="objectgroup"){for(const i of s.objects)if(i.type==="variable"||i.class==="variable"){if(t&&s.name!==t||r&&!r.includes(i.name))continue;e.set(i.name,new An(i))}}else s.type==="group"&&zt(s.layers,e,t,r)}let tt;async function me(){return tt===void 0&&(tt=Sn()),tt}async function Sn(){return Cn(await WA.room.getTiledMap())}function Cn(n){const e=new Map;return Ft(n.layers,"",e),e}function Ft(n,e,t){for(const r of n)r.type==="group"?Ft(r.layers,e+r.name+"/",t):(r.name=e+r.name,t.set(r.name,r))}async function Ht(){const n=await me(),e=[];for(const t of n.values())if(t.type==="objectgroup")for(const r of t.objects)(r.type==="area"||r.class==="area")&&e.push(r);return e}function Rn(n){let e=1/0,t=1/0,r=0,s=0;const i=n.data;if(typeof i=="string")throw new Error("Unsupported tile layer data stored as string instead of CSV");for(let o=0;o<n.height;o++)for(let a=0;a<n.width;a++)i[a+o*n.width]!==0&&(e=Math.min(e,a),s=Math.max(s,a),t=Math.min(t,o),r=Math.max(r,o));return{top:t,left:e,right:s+1,bottom:r+1}}function Gt(n){let e=1/0,t=1/0,r=0,s=0;for(const i of n){const o=Rn(i);o.left<e&&(e=o.left),o.top<t&&(t=o.top),o.right>s&&(s=o.right),o.bottom>r&&(r=o.bottom)}return{top:t,left:e,right:s,bottom:r}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var On=Object.prototype.toString,ye=Array.isArray||function(e){return On.call(e)==="[object Array]"};function vt(n){return typeof n=="function"}function Nn(n){return ye(n)?"array":typeof n}function nt(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function St(n,e){return n!=null&&typeof n=="object"&&e in n}function Pn(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var Ln=RegExp.prototype.test;function Bn(n,e){return Ln.call(n,e)}var Mn=/\S/;function In(n){return!Bn(Mn,n)}var Wn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Zn(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Wn[t]})}var jn=/\s*/,Vn=/\s+/,Ct=/\s*=/,Dn=/\s*\}/,qn=/#|\^|\/|>|\{|&|=|!/;function $n(n,e){if(!n)return[];var t=!1,r=[],s=[],i=[],o=!1,a=!1,c="",l=0;function d(){if(o&&!a)for(;i.length;)delete s[i.pop()];else i=[];o=!1,a=!1}var p,w,O;function I(G){if(typeof G=="string"&&(G=G.split(Vn,2)),!ye(G)||G.length!==2)throw new Error("Invalid tags: "+G);p=new RegExp(nt(G[0])+"\\s*"),w=new RegExp("\\s*"+nt(G[1])),O=new RegExp("\\s*"+nt("}"+G[1]))}I(e||L.tags);for(var T=new Le(n),C,k,A,H,ne,B;!T.eos();){if(C=T.pos,A=T.scanUntil(p),A)for(var le=0,xn=A.length;le<xn;++le)H=A.charAt(le),In(H)?(i.push(s.length),c+=H):(a=!0,t=!0,c+=" "),s.push(["text",H,C,C+1]),C+=1,H===`
`&&(d(),c="",l=0,t=!1);if(!T.scan(p))break;if(o=!0,k=T.scan(qn)||"name",T.scan(jn),k==="="?(A=T.scanUntil(Ct),T.scan(Ct),T.scanUntil(w)):k==="{"?(A=T.scanUntil(O),T.scan(Dn),T.scanUntil(w),k="&"):A=T.scanUntil(w),!T.scan(w))throw new Error("Unclosed tag at "+T.pos);if(k==">"?ne=[k,A,C,T.pos,c,l,t]:ne=[k,A,C,T.pos],l++,s.push(ne),k==="#"||k==="^")r.push(ne);else if(k==="/"){if(B=r.pop(),!B)throw new Error('Unopened section "'+A+'" at '+C);if(B[1]!==A)throw new Error('Unclosed section "'+B[1]+'" at '+C)}else k==="name"||k==="{"||k==="&"?a=!0:k==="="&&I(A)}if(d(),B=r.pop(),B)throw new Error('Unclosed section "'+B[1]+'" at '+T.pos);return zn(Un(s))}function Un(n){for(var e=[],t,r,s=0,i=n.length;s<i;++s)t=n[s],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function zn(n){for(var e=[],t=e,r=[],s,i,o=0,a=n.length;o<a;++o)switch(s=n[o],s[0]){case"#":case"^":t.push(s),r.push(s),t=s[4]=[];break;case"/":i=r.pop(),i[5]=s[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(s)}return e}function Le(n){this.string=n,this.tail=n,this.pos=0}Le.prototype.eos=function(){return this.tail===""};Le.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Le.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function he(n,e){this.view=n,this.cache={".":this.view},this.parent=e}he.prototype.push=function(e){return new he(e,this)};he.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var s=this,i,o,a,c=!1;s;){if(e.indexOf(".")>0)for(i=s.view,o=e.split("."),a=0;i!=null&&a<o.length;)a===o.length-1&&(c=St(i,o[a])||Pn(i,o[a])),i=i[o[a++]];else i=s.view[e],c=St(s.view,e);if(c){r=i;break}s=s.parent}t[e]=r}return vt(r)&&(r=r.call(this.view)),r};function P(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}P.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};P.prototype.parse=function(e,t){var r=this.templateCache,s=e+":"+(t||L.tags).join(":"),i=typeof r<"u",o=i?r.get(s):void 0;return o==null&&(o=$n(e,t),i&&r.set(s,o)),o};P.prototype.render=function(e,t,r,s){var i=this.getConfigTags(s),o=this.parse(e,i),a=t instanceof he?t:new he(t,void 0);return this.renderTokens(o,a,r,e,s)};P.prototype.renderTokens=function(e,t,r,s,i){for(var o="",a,c,l,d=0,p=e.length;d<p;++d)l=void 0,a=e[d],c=a[0],c==="#"?l=this.renderSection(a,t,r,s,i):c==="^"?l=this.renderInverted(a,t,r,s,i):c===">"?l=this.renderPartial(a,t,r,i):c==="&"?l=this.unescapedValue(a,t):c==="name"?l=this.escapedValue(a,t,i):c==="text"&&(l=this.rawValue(a)),l!==void 0&&(o+=l);return o};P.prototype.renderSection=function(e,t,r,s,i){var o=this,a="",c=t.lookup(e[1]);function l(w){return o.render(w,t,r,i)}if(c){if(ye(c))for(var d=0,p=c.length;d<p;++d)a+=this.renderTokens(e[4],t.push(c[d]),r,s,i);else if(typeof c=="object"||typeof c=="string"||typeof c=="number")a+=this.renderTokens(e[4],t.push(c),r,s,i);else if(vt(c)){if(typeof s!="string")throw new Error("Cannot use higher-order sections without the original template");c=c.call(t.view,s.slice(e[3],e[5]),l),c!=null&&(a+=c)}else a+=this.renderTokens(e[4],t,r,s,i);return a}};P.prototype.renderInverted=function(e,t,r,s,i){var o=t.lookup(e[1]);if(!o||ye(o)&&o.length===0)return this.renderTokens(e[4],t,r,s,i)};P.prototype.indentPartial=function(e,t,r){for(var s=t.replace(/[^ \t]/g,""),i=e.split(`
`),o=0;o<i.length;o++)i[o].length&&(o>0||!r)&&(i[o]=s+i[o]);return i.join(`
`)};P.prototype.renderPartial=function(e,t,r,s){if(r){var i=this.getConfigTags(s),o=vt(r)?r(e[1]):r[e[1]];if(o!=null){var a=e[6],c=e[5],l=e[4],d=o;c==0&&l&&(d=this.indentPartial(o,l,a));var p=this.parse(d,i);return this.renderTokens(p,t,r,d,s)}}};P.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};P.prototype.escapedValue=function(e,t,r){var s=this.getConfigEscape(r)||L.escape,i=t.lookup(e[1]);if(i!=null)return typeof i=="number"&&s===L.escape?String(i):s(i)};P.prototype.rawValue=function(e){return e[1]};P.prototype.getConfigTags=function(e){return ye(e)?e:e&&typeof e=="object"?e.tags:void 0};P.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!ye(e))return e.escape};var L={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){be.templateCache=n},get templateCache(){return be.templateCache}},be=new P;L.clearCache=function(){return be.clearCache()};L.parse=function(e,t){return be.parse(e,t)};L.render=function(e,t,r,s){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Nn(e)+'" was given as the first argument for mustache#render(template, view, partials)');return be.render(e,t,r,s)};L.escape=Zn;L.Scanner=Le;L.Context=he;L.Writer=P;class Yt{constructor(e,t){this.template=e,this.state=t,this.ast=L.parse(e)}getValue(){return this.value===void 0&&(this.value=L.render(this.template,this.state)),this.value}onChange(e){const t=[];for(const r of this.getUsedVariables().values())t.push(this.state.onVariableChange(r).subscribe(()=>{const s=L.render(this.template,this.state);s!==this.value&&(this.value=s,e(this.value))}));return{unsubscribe:()=>{for(const r of t)r.unsubscribe()}}}isPureString(){return this.ast.length===0||this.ast.length===1&&this.ast[0][0]==="text"}getUsedVariables(){const e=new Set;return this.recursiveGetUsedVariables(this.ast,e),e}recursiveGetUsedVariables(e,t){for(const r of e){const s=r[0],i=r[1],o=r[4];["name","&","#","^"].includes(s)&&t.add(i),o!==void 0&&typeof o!="string"&&this.recursiveGetUsedVariables(o,t)}}}async function Fn(){var n;const e=await Ht();for(const t of e){const r=(n=t.properties)!==null&&n!==void 0?n:[];for(const s of r){if(s.type==="int"||s.type==="bool"||s.type==="object"||typeof s.value!="string")continue;const i=new Yt(s.value,WA.state);if(i.isPureString())continue;const o=i.getValue();await Rt(t.name,s.name,o),i.onChange(async a=>{await Rt(t.name,s.name,a)})}}}async function Hn(){var n;const e=await me();for(const[t,r]of e.entries())if(r.type!=="objectgroup"){const s=(n=r.properties)!==null&&n!==void 0?n:[];for(const i of s){if(i.type==="int"||i.type==="bool"||i.type==="object"||typeof i.value!="string")continue;const o=new Yt(i.value,WA.state);if(o.isPureString())continue;const a=o.getValue();Ot(t,i.name,a),o.onChange(c=>{Ot(t,i.name,c)})}}}async function Rt(n,e,t){console.log(n),(await WA.room.area.get(n)).setProperty(e,t)}function Ot(n,e,t){WA.room.setProperty(n,e,t),e==="visible"&&(t?WA.room.showLayer(n):WA.room.hideLayer(n))}const Gn="https://admin.workadventu.re/html";let at,_t=0,bt=0;function Nt(n){if(WA.state[n.name]){let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.showLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.hideLayer(t)}else{let e=n.properties.mustGetString("openLayer");for(const t of e.split(`
`))WA.room.hideLayer(t);e=n.properties.mustGetString("closeLayer");for(const t of e.split(`
`))WA.room.showLayer(t)}}function Yn(n){const e=n.properties.getString("openSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Kt(n.properties.mustGetString("openLayer").split(`
`));if(s>t)return;r=1-s/t}e&&WA.sound.loadSound(e).play({volume:r})}function Jn(n){const e=n.properties.getString("closeSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Kt(n.properties.mustGetString("closeLayer").split(`
`));if(s>t)return;r=1-s/t}e&&WA.sound.loadSound(e).play({volume:r})}function Jt(n){return n.map(e=>at.get(e)).filter(e=>(e==null?void 0:e.type)==="tilelayer")}function Kt(n){const e=Jt(n),t=Gt(e),r=((t.right-t.left)/2+t.left)*32,s=((t.bottom-t.top)/2+t.top)*32;return Math.sqrt(Math.pow(_t-r,2)+Math.pow(bt-s,2))}function Kn(n){WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]?Yn(n):Jn(n),Nt(n)}),Nt(n)}function Pt(n,e,t,r){const s=n.name;let i,o,a=!1;const c=t.getString("tag");let l=!0;c&&!WA.player.tags.includes(c)&&(l=!1);const d=!!c;function p(){var k;i&&i.remove(),i=WA.ui.displayActionMessage({message:(k=t.getString("closeTriggerMessage"))!==null&&k!==void 0?k:"Press SPACE to close the door",callback:()=>{WA.state[e.name]=!1,w()}})}function w(){var k;i&&i.remove(),i=WA.ui.displayActionMessage({message:(k=t.getString("openTriggerMessage"))!==null&&k!==void 0?k:"Press SPACE to open the door",callback:()=>{WA.state[e.name]=!0,p()}})}function O(){let k;if(n.type==="tilelayer")k=Gt(Jt(e.properties.mustGetString("closeLayer").split(`
`)));else{if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error(`Doorstep zone "${n.name}" is missing x, y, width or height`);k={top:n.y,left:n.x,right:n.x+n.width,bottom:n.y+n.height}}o=WA.room.website.create({name:"doorKeypad"+s,url:r+"/keypad.html#"+encodeURIComponent(s),position:{x:k.right*32,y:k.top*32,width:32*3,height:32*4},allowApi:!0})}function I(){o&&(WA.room.website.delete(o.name),o=void 0)}function T(){if(a=!0,t.getBoolean("autoOpen")&&l){WA.state[e.name]=!0;return}if(!WA.state[e.name]&&(d&&!l||!d)&&(t.getString("code")||t.getString("codeVariable"))){O();return}l&&(WA.state[e.name]?p():w())}function C(){a=!1,t.getBoolean("autoClose")&&(WA.state[e.name]=!1),i&&i.remove(),I()}n.type==="tilelayer"?(WA.room.onEnterLayer(s).subscribe(T),WA.room.onLeaveLayer(s).subscribe(C)):(WA.room.area.onEnter(s).subscribe(T),WA.room.area.onLeave(s).subscribe(C)),WA.state.onVariableChange(e.name).subscribe(()=>{a&&(!t.getBoolean("autoClose")&&WA.state[e.name]===!0&&p(),o&&WA.state[e.name]===!0&&I(),!t.getBoolean("autoOpen")&&WA.state[e.name]===!1&&w())})}function Xn(n){const e=n.properties.mustGetString("bellSound"),t=n.properties.getNumber("soundRadius");let r=1;if(t){const s=Math.sqrt(Math.pow(n.x-_t,2)+Math.pow(n.y-bt,2));if(s>t)return;r=1-s/t}WA.sound.loadSound(e).play({volume:r})}function Qn(n){WA.state[n.name]===void 0&&(WA.state[n.name]=0),WA.state.onVariableChange(n.name).subscribe(()=>{WA.state[n.name]&&Xn(n)})}function Lt(n,e,t){let r;const s=e.getString("bellPopup");if(t.type==="tilelayer"){const i=t.name;WA.room.onEnterLayer(i).subscribe(()=>{var o;s?r=WA.ui.openPopup(s,"",[{label:(o=e.getString("bellButtonText"))!==null&&o!==void 0?o:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.onLeaveLayer(i).subscribe(()=>{r&&(r.close(),r=void 0)})}else{const i=t.name;WA.room.area.onEnter(i).subscribe(()=>{var o;s?r=WA.ui.openPopup(s,"",[{label:(o=e.getString("bellButtonText"))!==null&&o!==void 0?o:"Ring",callback:()=>{WA.state[n]=WA.state[n]+1}}]):WA.state[n]=WA.state[n]+1}),WA.room.area.onLeave(i).subscribe(()=>{r&&(r.close(),r=void 0)})}}async function er(n){n=n??Gn;const e=await Ut();at=await me();for(const t of e.values())t.properties.get("door")&&Kn(t),t.properties.get("bell")&&Qn(t);for(const t of at.values()){const r=new ie(t.properties),s=r.getString("doorVariable");if(s&&t.type==="tilelayer"){const o=e.get(s);if(o===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of layer "'+t.name+'"');Pt(t,o,r,n)}const i=r.getString("bellVariable");i&&t.type==="tilelayer"&&Lt(i,r,t)}for(const t of await Ht()){const r=new ie(t.properties),s=r.getString("doorVariable");if(s){const o=e.get(s);if(o===void 0)throw new Error('Cannot find variable "'+s+'" referred in the "doorVariable" property of object "'+t.name+'"');Pt(t,o,r,n)}const i=r.getString("bellVariable");i&&Lt(i,r,t)}WA.player.onPlayerMove(t=>{_t=t.x,bt=t.y})}function tr(n,e){const t=n.getString("bindVariable");if(t){const r=n.get("enterValue"),s=n.get("leaveValue"),i=n.getString("triggerMessage"),o=n.getString("tag");nr(t,e,r,s,i,o)}}function nr(n,e,t,r,s,i){i&&!WA.player.tags.includes(i)||(t!==void 0&&WA.room.onEnterLayer(e).subscribe(()=>{s||(WA.state[n]=t)}),r!==void 0&&WA.room.onLeaveLayer(e).subscribe(()=>{WA.state[n]=r}))}async function rr(){const n=await me();for(const e of n.values()){const t=new ie(e.properties);tr(t,e.name)}}let Bt;async function sr(n){const e=await WA.room.getTiledMap();n=n??$t,Bt=await me();const t=e.layers.find(r=>r.name==="configuration");if(t){const s=new ie(t.properties).getString("tag");(!s||WA.player.tags.includes(s))&&WA.ui.registerMenuCommand("Configure the room",()=>{WA.nav.openCoWebSite(n+"/configuration.html",!0)});for(const i of Bt.values()){const o=new ie(i.properties),a=o.getString("openConfig");a&&i.type==="tilelayer"&&ir(a.split(","),i.name,o)}}}function ir(n,e,t){let r;const s=t.getString("openConfigAdminTag");let i=!0;s&&!WA.player.tags.includes(s)&&(i=!1);function o(){var c;r&&r.remove(),r=WA.ui.displayActionMessage({message:(c=t.getString("openConfigTriggerMessage"))!==null&&c!==void 0?c:"Press SPACE or touch here to configure",callback:()=>At(n)})}function a(){WA.nav.closeCoWebSite()}WA.room.onEnterLayer(e).subscribe(()=>{const c=t.getString("openConfigTrigger");i&&(c&&c==="onaction"?o():At(n))}),WA.room.onLeaveLayer(e).subscribe(()=>{r&&r.remove(),a()})}function or(){return WA.onInit().then(()=>{er().catch(n=>console.error(n)),rr().catch(n=>console.error(n)),sr().catch(n=>console.error(n)),Hn().catch(n=>console.error(n)),Fn().catch(n=>console.error(n))}).catch(n=>console.error(n))}async function Xt(){return new Promise(async n=>{const e=new Map,t=await me();for(const r of t.values())if(r.type==="objectgroup"){for(const s of r.objects)if(s.type==="area"||s.class==="area"){const i=new ie(s.properties);i.getBoolean("ai-zone")===!0&&e.set(s.name,i.getString("description"))}}n(e)})}async function ar(){const n=await Xt();for(const e of n.keys())WA.room.area.onEnter(e).subscribe(()=>{WA.player.state.saveVariable("currentPlace",e,{persist:!1,public:!0})})}function cr(n,e,t){var r=t||{},s=r.noTrailing,i=s===void 0?!1:s,o=r.noLeading,a=o===void 0?!1:o,c=r.debounceMode,l=c===void 0?void 0:c,d,p=!1,w=0;function O(){d&&clearTimeout(d)}function I(C){var k=C||{},A=k.upcomingOnly,H=A===void 0?!1:A;O(),p=!H}function T(){for(var C=arguments.length,k=new Array(C),A=0;A<C;A++)k[A]=arguments[A];var H=this,ne=Date.now()-w;if(p)return;function B(){w=Date.now(),e.apply(H,k)}function le(){d=void 0}!a&&l&&!d&&B(),O(),l===void 0&&ne>n?a?(w=Date.now(),i||(d=setTimeout(l?le:B,n))):B():i!==!0&&(d=setTimeout(l?le:B,l===void 0?n-ne:n))}return T.cancel=I,T}var x;(function(n){n.assertEqual=s=>s;function e(s){}n.assertIs=e;function t(s){throw new Error}n.assertNever=t,n.arrayToEnum=s=>{const i={};for(const o of s)i[o]=o;return i},n.getValidEnumValues=s=>{const i=n.objectKeys(s).filter(a=>typeof s[s[a]]!="number"),o={};for(const a of i)o[a]=s[a];return n.objectValues(o)},n.objectValues=s=>n.objectKeys(s).map(function(i){return s[i]}),n.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{const i=[];for(const o in s)Object.prototype.hasOwnProperty.call(s,o)&&i.push(o);return i},n.find=(s,i)=>{for(const o of s)if(i(o))return o},n.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&isFinite(s)&&Math.floor(s)===s;function r(s,i=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(x||(x={}));var ct;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(ct||(ct={}));const h=x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),K=n=>{switch(typeof n){case"undefined":return h.undefined;case"string":return h.string;case"number":return isNaN(n)?h.nan:h.number;case"boolean":return h.boolean;case"function":return h.function;case"bigint":return h.bigint;case"symbol":return h.symbol;case"object":return Array.isArray(n)?h.array:n===null?h.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?h.promise:typeof Map<"u"&&n instanceof Map?h.map:typeof Set<"u"&&n instanceof Set?h.set:typeof Date<"u"&&n instanceof Date?h.date:h.object;default:return h.unknown}},u=x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),lr=n=>JSON.stringify(n,null,2).replace(/"([^"]+)":/g,"$1:");class V extends Error{constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(i){return i.message},r={_errors:[]},s=i=>{for(const o of i.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(t(o));else{let a=r,c=0;for(;c<o.path.length;){const l=o.path[c];c===o.path.length-1?(a[l]=a[l]||{_errors:[]},a[l]._errors.push(t(o))):a[l]=a[l]||{_errors:[]},a=a[l],c++}}};return s(this),r}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}V.create=n=>new V(n);const we=(n,e)=>{let t;switch(n.code){case u.invalid_type:n.received===h.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case u.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,x.jsonStringifyReplacer)}`;break;case u.unrecognized_keys:t=`Unrecognized key(s) in object: ${x.joinValues(n.keys,", ")}`;break;case u.invalid_union:t="Invalid input";break;case u.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${x.joinValues(n.options)}`;break;case u.invalid_enum_value:t=`Invalid enum value. Expected ${x.joinValues(n.options)}, received '${n.received}'`;break;case u.invalid_arguments:t="Invalid function arguments";break;case u.invalid_return_type:t="Invalid function return type";break;case u.invalid_date:t="Invalid date";break;case u.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:x.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case u.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case u.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case u.custom:t="Invalid input";break;case u.invalid_intersection_types:t="Intersection results could not be merged";break;case u.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case u.not_finite:t="Number must be finite";break;default:t=e.defaultError,x.assertNever(n)}return{message:t}};let Qt=we;function ur(n){Qt=n}function $e(){return Qt}const Ue=n=>{const{data:e,path:t,errorMaps:r,issueData:s}=n,i=[...t,...s.path||[]],o={...s,path:i};let a="";const c=r.filter(l=>!!l).slice().reverse();for(const l of c)a=l(o,{data:e,defaultError:a}).message;return{...s,path:i,message:s.message||a}},dr=[];function f(n,e){const t=Ue({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,$e(),we].filter(r=>!!r)});n.common.issues.push(t)}class R{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const s of t){if(s.status==="aborted")return g;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const s of t)r.push({key:await s.key,value:await s.value});return R.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const s of t){const{key:i,value:o}=s;if(i.status==="aborted"||o.status==="aborted")return g;i.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof o.value<"u"||s.alwaysSet)&&(r[i.value]=o.value)}return{status:e.value,value:r}}}const g=Object.freeze({status:"aborted"}),en=n=>({status:"dirty",value:n}),N=n=>({status:"valid",value:n}),lt=n=>n.status==="aborted",ut=n=>n.status==="dirty",ke=n=>n.status==="valid",ze=n=>typeof Promise<"u"&&n instanceof Promise;var m;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(m||(m={}));class U{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Mt=(n,e)=>{if(ke(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new V(n.common.issues);return this._error=t,this._error}}};function v(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:s}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(o,a)=>o.code!=="invalid_type"?{message:a.defaultError}:typeof a.data>"u"?{message:r??a.defaultError}:{message:t??a.defaultError},description:s}}class _{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return K(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:K(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new R,ctx:{common:e.parent.common,data:e.data,parsedType:K(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(ze(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;const s={common:{issues:[],async:(r=t==null?void 0:t.async)!==null&&r!==void 0?r:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:K(e)},i=this._parseSync({data:e,path:s.path,parent:s});return Mt(s,i)}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:K(e)},s=this._parse({data:e,path:r.path,parent:r}),i=await(ze(s)?s:Promise.resolve(s));return Mt(r,i)}refine(e,t){const r=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{const o=e(s),a=()=>i.addIssue({code:u.custom,...r(s)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(a(),!1)):o?!0:(a(),!1)})}refinement(e,t){return this._refinement((r,s)=>e(r)?!0:(s.addIssue(typeof t=="function"?t(r,s):t),!1))}_refinement(e){return new q({schema:this,typeName:y.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return Y.create(this,this._def)}nullable(){return ce.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return D.create(this,this._def)}promise(){return pe.create(this,this._def)}or(e){return Ae.create([this,e],this._def)}and(e){return Se.create(this,e,this._def)}transform(e){return new q({...v(this._def),schema:this,typeName:y.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Pe({...v(this._def),innerType:this,defaultValue:t,typeName:y.ZodDefault})}brand(){return new nn({typeName:y.ZodBranded,type:this,...v(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Ye({...v(this._def),innerType:this,catchValue:t,typeName:y.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Be.create(this,e)}readonly(){return Ke.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const hr=/^c[^\s-]{8,}$/i,fr=/^[a-z][a-z0-9]*$/,pr=/^[0-9A-HJKMNP-TV-Z]{26}$/,mr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yr=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,gr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let rt;const vr=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,_r=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,br=n=>n.precision?n.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${n.precision}}Z$`):n.precision===0?n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):n.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$");function wr(n,e){return!!((e==="v4"||!e)&&vr.test(n)||(e==="v6"||!e)&&_r.test(n))}class j extends _{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==h.string){const i=this._getOrReturnCtx(e);return f(i,{code:u.invalid_type,expected:h.string,received:i.parsedType}),g}const r=new R;let s;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const o=e.data.length>i.value,a=e.data.length<i.value;(o||a)&&(s=this._getOrReturnCtx(e,s),o?f(s,{code:u.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):a&&f(s,{code:u.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")yr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"email",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")rt||(rt=new RegExp(gr,"u")),rt.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"emoji",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")mr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"uuid",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")hr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"cuid",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")fr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"cuid2",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")pr.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"ulid",code:u.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),f(s,{validation:"url",code:u.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"regex",code:u.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?br(i).test(e.data)||(s=this._getOrReturnCtx(e,s),f(s,{code:u.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="ip"?wr(e.data,i.version)||(s=this._getOrReturnCtx(e,s),f(s,{validation:"ip",code:u.invalid_string,message:i.message}),r.dirty()):x.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(s=>e.test(s),{validation:t,code:u.invalid_string,...m.errToObj(r)})}_addCheck(e){return new j({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...m.errToObj(e)})}url(e){return this._addCheck({kind:"url",...m.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...m.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...m.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...m.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...m.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...m.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...m.errToObj(e)})}datetime(e){var t;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,...m.errToObj(e==null?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...m.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...m.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...m.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...m.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...m.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...m.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...m.errToObj(t)})}nonempty(e){return this.min(1,m.errToObj(e))}trim(){return new j({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new j({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new j({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}j.create=n=>{var e;return new j({checks:[],typeName:y.ZodString,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...v(n)})};function kr(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=t>r?t:r,i=parseInt(n.toFixed(s).replace(".","")),o=parseInt(e.toFixed(s).replace(".",""));return i%o/Math.pow(10,s)}class Q extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==h.number){const i=this._getOrReturnCtx(e);return f(i,{code:u.invalid_type,expected:h.number,received:i.parsedType}),g}let r;const s=new R;for(const i of this._def.checks)i.kind==="int"?x.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{code:u.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?kr(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),f(r,{code:u.not_finite,message:i.message}),s.dirty()):x.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,m.toString(t))}gt(e,t){return this.setLimit("min",e,!1,m.toString(t))}lte(e,t){return this.setLimit("max",e,!0,m.toString(t))}lt(e,t){return this.setLimit("max",e,!1,m.toString(t))}setLimit(e,t,r,s){return new Q({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:m.toString(s)}]})}_addCheck(e){return new Q({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:m.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:m.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:m.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:m.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:m.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&x.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Q.create=n=>new Q({checks:[],typeName:y.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...v(n)});class ee extends _{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==h.bigint){const i=this._getOrReturnCtx(e);return f(i,{code:u.invalid_type,expected:h.bigint,received:i.parsedType}),g}let r;const s=new R;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),f(r,{code:u.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):x.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,m.toString(t))}gt(e,t){return this.setLimit("min",e,!1,m.toString(t))}lte(e,t){return this.setLimit("max",e,!0,m.toString(t))}lt(e,t){return this.setLimit("max",e,!1,m.toString(t))}setLimit(e,t,r,s){return new ee({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:m.toString(s)}]})}_addCheck(e){return new ee({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:m.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:m.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:m.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:m.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:m.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ee.create=n=>{var e;return new ee({checks:[],typeName:y.ZodBigInt,coerce:(e=n==null?void 0:n.coerce)!==null&&e!==void 0?e:!1,...v(n)})};class xe extends _{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==h.boolean){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.boolean,received:r.parsedType}),g}return N(e.data)}}xe.create=n=>new xe({typeName:y.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...v(n)});class oe extends _{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==h.date){const i=this._getOrReturnCtx(e);return f(i,{code:u.invalid_type,expected:h.date,received:i.parsedType}),g}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return f(i,{code:u.invalid_date}),g}const r=new R;let s;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),f(s,{code:u.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):x.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new oe({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:m.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:m.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}oe.create=n=>new oe({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:y.ZodDate,...v(n)});class Fe extends _{_parse(e){if(this._getType(e)!==h.symbol){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.symbol,received:r.parsedType}),g}return N(e.data)}}Fe.create=n=>new Fe({typeName:y.ZodSymbol,...v(n)});class Te extends _{_parse(e){if(this._getType(e)!==h.undefined){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.undefined,received:r.parsedType}),g}return N(e.data)}}Te.create=n=>new Te({typeName:y.ZodUndefined,...v(n)});class Ee extends _{_parse(e){if(this._getType(e)!==h.null){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.null,received:r.parsedType}),g}return N(e.data)}}Ee.create=n=>new Ee({typeName:y.ZodNull,...v(n)});class fe extends _{constructor(){super(...arguments),this._any=!0}_parse(e){return N(e.data)}}fe.create=n=>new fe({typeName:y.ZodAny,...v(n)});class se extends _{constructor(){super(...arguments),this._unknown=!0}_parse(e){return N(e.data)}}se.create=n=>new se({typeName:y.ZodUnknown,...v(n)});class J extends _{_parse(e){const t=this._getOrReturnCtx(e);return f(t,{code:u.invalid_type,expected:h.never,received:t.parsedType}),g}}J.create=n=>new J({typeName:y.ZodNever,...v(n)});class He extends _{_parse(e){if(this._getType(e)!==h.undefined){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.void,received:r.parsedType}),g}return N(e.data)}}He.create=n=>new He({typeName:y.ZodVoid,...v(n)});class D extends _{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==h.array)return f(t,{code:u.invalid_type,expected:h.array,received:t.parsedType}),g;if(s.exactLength!==null){const o=t.data.length>s.exactLength.value,a=t.data.length<s.exactLength.value;(o||a)&&(f(t,{code:o?u.too_big:u.too_small,minimum:a?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(f(t,{code:u.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(f(t,{code:u.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((o,a)=>s.type._parseAsync(new U(t,o,t.path,a)))).then(o=>R.mergeArray(r,o));const i=[...t.data].map((o,a)=>s.type._parseSync(new U(t,o,t.path,a)));return R.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new D({...this._def,minLength:{value:e,message:m.toString(t)}})}max(e,t){return new D({...this._def,maxLength:{value:e,message:m.toString(t)}})}length(e,t){return new D({...this._def,exactLength:{value:e,message:m.toString(t)}})}nonempty(e){return this.min(1,e)}}D.create=(n,e)=>new D({type:n,minLength:null,maxLength:null,exactLength:null,typeName:y.ZodArray,...v(e)});function ue(n){if(n instanceof E){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Y.create(ue(r))}return new E({...n._def,shape:()=>e})}else return n instanceof D?new D({...n._def,type:ue(n.element)}):n instanceof Y?Y.create(ue(n.unwrap())):n instanceof ce?ce.create(ue(n.unwrap())):n instanceof z?z.create(n.items.map(e=>ue(e))):n}class E extends _{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=x.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==h.object){const l=this._getOrReturnCtx(e);return f(l,{code:u.invalid_type,expected:h.object,received:l.parsedType}),g}const{status:r,ctx:s}=this._processInputParams(e),{shape:i,keys:o}=this._getCached(),a=[];if(!(this._def.catchall instanceof J&&this._def.unknownKeys==="strip"))for(const l in s.data)o.includes(l)||a.push(l);const c=[];for(const l of o){const d=i[l],p=s.data[l];c.push({key:{status:"valid",value:l},value:d._parse(new U(s,p,s.path,l)),alwaysSet:l in s.data})}if(this._def.catchall instanceof J){const l=this._def.unknownKeys;if(l==="passthrough")for(const d of a)c.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(l==="strict")a.length>0&&(f(s,{code:u.unrecognized_keys,keys:a}),r.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const d of a){const p=s.data[d];c.push({key:{status:"valid",value:d},value:l._parse(new U(s,p,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{const l=[];for(const d of c){const p=await d.key;l.push({key:p,value:await d.value,alwaysSet:d.alwaysSet})}return l}).then(l=>R.mergeObjectSync(r,l)):R.mergeObjectSync(r,c)}get shape(){return this._def.shape()}strict(e){return m.errToObj,new E({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var s,i,o,a;const c=(o=(i=(s=this._def).errorMap)===null||i===void 0?void 0:i.call(s,t,r).message)!==null&&o!==void 0?o:r.defaultError;return t.code==="unrecognized_keys"?{message:(a=m.errToObj(e).message)!==null&&a!==void 0?a:c}:{message:c}}}:{}})}strip(){return new E({...this._def,unknownKeys:"strip"})}passthrough(){return new E({...this._def,unknownKeys:"passthrough"})}extend(e){return new E({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new E({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:y.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new E({...this._def,catchall:e})}pick(e){const t={};return x.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new E({...this._def,shape:()=>t})}omit(e){const t={};return x.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new E({...this._def,shape:()=>t})}deepPartial(){return ue(this)}partial(e){const t={};return x.objectKeys(this.shape).forEach(r=>{const s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new E({...this._def,shape:()=>t})}required(e){const t={};return x.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Y;)i=i._def.innerType;t[r]=i}}),new E({...this._def,shape:()=>t})}keyof(){return tn(x.objectKeys(this.shape))}}E.create=(n,e)=>new E({shape:()=>n,unknownKeys:"strip",catchall:J.create(),typeName:y.ZodObject,...v(e)});E.strictCreate=(n,e)=>new E({shape:()=>n,unknownKeys:"strict",catchall:J.create(),typeName:y.ZodObject,...v(e)});E.lazycreate=(n,e)=>new E({shape:n,unknownKeys:"strip",catchall:J.create(),typeName:y.ZodObject,...v(e)});class Ae extends _{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function s(i){for(const a of i)if(a.result.status==="valid")return a.result;for(const a of i)if(a.result.status==="dirty")return t.common.issues.push(...a.ctx.common.issues),a.result;const o=i.map(a=>new V(a.ctx.common.issues));return f(t,{code:u.invalid_union,unionErrors:o}),g}if(t.common.async)return Promise.all(r.map(async i=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(s);{let i;const o=[];for(const c of r){const l={...t,common:{...t.common,issues:[]},parent:null},d=c._parseSync({data:t.data,path:t.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!i&&(i={result:d,ctx:l}),l.common.issues.length&&o.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const a=o.map(c=>new V(c));return f(t,{code:u.invalid_union,unionErrors:a}),g}}get options(){return this._def.options}}Ae.create=(n,e)=>new Ae({options:n,typeName:y.ZodUnion,...v(e)});const We=n=>n instanceof Re?We(n.schema):n instanceof q?We(n.innerType()):n instanceof Oe?[n.value]:n instanceof te?n.options:n instanceof Ne?Object.keys(n.enum):n instanceof Pe?We(n._def.innerType):n instanceof Te?[void 0]:n instanceof Ee?[null]:null;class Xe extends _{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.object)return f(t,{code:u.invalid_type,expected:h.object,received:t.parsedType}),g;const r=this.discriminator,s=t.data[r],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(f(t,{code:u.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),g)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const s=new Map;for(const i of t){const o=We(i.shape[e]);if(!o)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const a of o){if(s.has(a))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(a)}`);s.set(a,i)}}return new Xe({typeName:y.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...v(r)})}}function dt(n,e){const t=K(n),r=K(e);if(n===e)return{valid:!0,data:n};if(t===h.object&&r===h.object){const s=x.objectKeys(e),i=x.objectKeys(n).filter(a=>s.indexOf(a)!==-1),o={...n,...e};for(const a of i){const c=dt(n[a],e[a]);if(!c.valid)return{valid:!1};o[a]=c.data}return{valid:!0,data:o}}else if(t===h.array&&r===h.array){if(n.length!==e.length)return{valid:!1};const s=[];for(let i=0;i<n.length;i++){const o=n[i],a=e[i],c=dt(o,a);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===h.date&&r===h.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Se extends _{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=(i,o)=>{if(lt(i)||lt(o))return g;const a=dt(i.value,o.value);return a.valid?((ut(i)||ut(o))&&t.dirty(),{status:t.value,value:a.data}):(f(r,{code:u.invalid_intersection_types}),g)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,o])=>s(i,o)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Se.create=(n,e,t)=>new Se({left:n,right:e,typeName:y.ZodIntersection,...v(t)});class z extends _{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.array)return f(r,{code:u.invalid_type,expected:h.array,received:r.parsedType}),g;if(r.data.length<this._def.items.length)return f(r,{code:u.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),g;!this._def.rest&&r.data.length>this._def.items.length&&(f(r,{code:u.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((o,a)=>{const c=this._def.items[a]||this._def.rest;return c?c._parse(new U(r,o,r.path,a)):null}).filter(o=>!!o);return r.common.async?Promise.all(i).then(o=>R.mergeArray(t,o)):R.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new z({...this._def,rest:e})}}z.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new z({items:n,typeName:y.ZodTuple,rest:null,...v(e)})};class Ce extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.object)return f(r,{code:u.invalid_type,expected:h.object,received:r.parsedType}),g;const s=[],i=this._def.keyType,o=this._def.valueType;for(const a in r.data)s.push({key:i._parse(new U(r,a,r.path,a)),value:o._parse(new U(r,r.data[a],r.path,a))});return r.common.async?R.mergeObjectAsync(t,s):R.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof _?new Ce({keyType:e,valueType:t,typeName:y.ZodRecord,...v(r)}):new Ce({keyType:j.create(),valueType:e,typeName:y.ZodRecord,...v(t)})}}class Ge extends _{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.map)return f(r,{code:u.invalid_type,expected:h.map,received:r.parsedType}),g;const s=this._def.keyType,i=this._def.valueType,o=[...r.data.entries()].map(([a,c],l)=>({key:s._parse(new U(r,a,r.path,[l,"key"])),value:i._parse(new U(r,c,r.path,[l,"value"]))}));if(r.common.async){const a=new Map;return Promise.resolve().then(async()=>{for(const c of o){const l=await c.key,d=await c.value;if(l.status==="aborted"||d.status==="aborted")return g;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(l.value,d.value)}return{status:t.value,value:a}})}else{const a=new Map;for(const c of o){const l=c.key,d=c.value;if(l.status==="aborted"||d.status==="aborted")return g;(l.status==="dirty"||d.status==="dirty")&&t.dirty(),a.set(l.value,d.value)}return{status:t.value,value:a}}}}Ge.create=(n,e,t)=>new Ge({valueType:e,keyType:n,typeName:y.ZodMap,...v(t)});class ae extends _{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==h.set)return f(r,{code:u.invalid_type,expected:h.set,received:r.parsedType}),g;const s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(f(r,{code:u.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(f(r,{code:u.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());const i=this._def.valueType;function o(c){const l=new Set;for(const d of c){if(d.status==="aborted")return g;d.status==="dirty"&&t.dirty(),l.add(d.value)}return{status:t.value,value:l}}const a=[...r.data.values()].map((c,l)=>i._parse(new U(r,c,r.path,l)));return r.common.async?Promise.all(a).then(c=>o(c)):o(a)}min(e,t){return new ae({...this._def,minSize:{value:e,message:m.toString(t)}})}max(e,t){return new ae({...this._def,maxSize:{value:e,message:m.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ae.create=(n,e)=>new ae({valueType:n,minSize:null,maxSize:null,typeName:y.ZodSet,...v(e)});class de extends _{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.function)return f(t,{code:u.invalid_type,expected:h.function,received:t.parsedType}),g;function r(a,c){return Ue({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$e(),we].filter(l=>!!l),issueData:{code:u.invalid_arguments,argumentsError:c}})}function s(a,c){return Ue({data:a,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,$e(),we].filter(l=>!!l),issueData:{code:u.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},o=t.data;if(this._def.returns instanceof pe){const a=this;return N(async function(...c){const l=new V([]),d=await a._def.args.parseAsync(c,i).catch(O=>{throw l.addIssue(r(c,O)),l}),p=await Reflect.apply(o,this,d);return await a._def.returns._def.type.parseAsync(p,i).catch(O=>{throw l.addIssue(s(p,O)),l})})}else{const a=this;return N(function(...c){const l=a._def.args.safeParse(c,i);if(!l.success)throw new V([r(c,l.error)]);const d=Reflect.apply(o,this,l.data),p=a._def.returns.safeParse(d,i);if(!p.success)throw new V([s(d,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new de({...this._def,args:z.create(e).rest(se.create())})}returns(e){return new de({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new de({args:e||z.create([]).rest(se.create()),returns:t||se.create(),typeName:y.ZodFunction,...v(r)})}}class Re extends _{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Re.create=(n,e)=>new Re({getter:n,typeName:y.ZodLazy,...v(e)});class Oe extends _{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return f(t,{received:t.data,code:u.invalid_literal,expected:this._def.value}),g}return{status:"valid",value:e.data}}get value(){return this._def.value}}Oe.create=(n,e)=>new Oe({value:n,typeName:y.ZodLiteral,...v(e)});function tn(n,e){return new te({values:n,typeName:y.ZodEnum,...v(e)})}class te extends _{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return f(t,{expected:x.joinValues(r),received:t.parsedType,code:u.invalid_type}),g}if(this._def.values.indexOf(e.data)===-1){const t=this._getOrReturnCtx(e),r=this._def.values;return f(t,{received:t.data,code:u.invalid_enum_value,options:r}),g}return N(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return te.create(e)}exclude(e){return te.create(this.options.filter(t=>!e.includes(t)))}}te.create=tn;class Ne extends _{_parse(e){const t=x.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==h.string&&r.parsedType!==h.number){const s=x.objectValues(t);return f(r,{expected:x.joinValues(s),received:r.parsedType,code:u.invalid_type}),g}if(t.indexOf(e.data)===-1){const s=x.objectValues(t);return f(r,{received:r.data,code:u.invalid_enum_value,options:s}),g}return N(e.data)}get enum(){return this._def.values}}Ne.create=(n,e)=>new Ne({values:n,typeName:y.ZodNativeEnum,...v(e)});class pe extends _{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==h.promise&&t.common.async===!1)return f(t,{code:u.invalid_type,expected:h.promise,received:t.parsedType}),g;const r=t.parsedType===h.promise?t.data:Promise.resolve(t.data);return N(r.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}}pe.create=(n,e)=>new pe({type:n,typeName:y.ZodPromise,...v(e)});class q extends _{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===y.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:o=>{f(r,o),o.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){const o=s.transform(r.data,i);return r.common.issues.length?{status:"dirty",value:r.data}:r.common.async?Promise.resolve(o).then(a=>this._def.schema._parseAsync({data:a,path:r.path,parent:r})):this._def.schema._parseSync({data:o,path:r.path,parent:r})}if(s.type==="refinement"){const o=a=>{const c=s.refinement(a,i);if(r.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(r.common.async===!1){const a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?g:(a.status==="dirty"&&t.dirty(),o(a.value),{status:t.value,value:a.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(a=>a.status==="aborted"?g:(a.status==="dirty"&&t.dirty(),o(a.value).then(()=>({status:t.value,value:a.value}))))}if(s.type==="transform")if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!ke(o))return o;const a=s.transform(o.value,i);if(a instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>ke(o)?Promise.resolve(s.transform(o.value,i)).then(a=>({status:t.value,value:a})):o);x.assertNever(s)}}q.create=(n,e,t)=>new q({schema:n,typeName:y.ZodEffects,effect:e,...v(t)});q.createWithPreprocess=(n,e,t)=>new q({schema:e,effect:{type:"preprocess",transform:n},typeName:y.ZodEffects,...v(t)});class Y extends _{_parse(e){return this._getType(e)===h.undefined?N(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Y.create=(n,e)=>new Y({innerType:n,typeName:y.ZodOptional,...v(e)});class ce extends _{_parse(e){return this._getType(e)===h.null?N(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}ce.create=(n,e)=>new ce({innerType:n,typeName:y.ZodNullable,...v(e)});class Pe extends _{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===h.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Pe.create=(n,e)=>new Pe({innerType:n,typeName:y.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});class Ye extends _{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ze(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new V(r.common.issues)},input:r.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new V(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Ye.create=(n,e)=>new Ye({innerType:n,typeName:y.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});class Je extends _{_parse(e){if(this._getType(e)!==h.nan){const r=this._getOrReturnCtx(e);return f(r,{code:u.invalid_type,expected:h.nan,received:r.parsedType}),g}return{status:"valid",value:e.data}}}Je.create=n=>new Je({typeName:y.ZodNaN,...v(n)});const xr=Symbol("zod_brand");class nn extends _{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Be extends _{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?g:i.status==="dirty"?(t.dirty(),en(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?g:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,t){return new Be({in:e,out:t,typeName:y.ZodPipeline})}}class Ke extends _{_parse(e){const t=this._def.innerType._parse(e);return ke(t)&&(t.value=Object.freeze(t.value)),t}}Ke.create=(n,e)=>new Ke({innerType:n,typeName:y.ZodReadonly,...v(e)});const rn=(n,e={},t)=>n?fe.create().superRefine((r,s)=>{var i,o;if(!n(r)){const a=typeof e=="function"?e(r):typeof e=="string"?{message:e}:e,c=(o=(i=a.fatal)!==null&&i!==void 0?i:t)!==null&&o!==void 0?o:!0,l=typeof a=="string"?{message:a}:a;s.addIssue({code:"custom",...l,fatal:c})}}):fe.create(),Tr={object:E.lazycreate};var y;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(y||(y={}));const Er=(n,e={message:`Input not instance of ${n.name}`})=>rn(t=>t instanceof n,e),sn=j.create,on=Q.create,Ar=Je.create,Sr=ee.create,an=xe.create,Cr=oe.create,Rr=Fe.create,Or=Te.create,Nr=Ee.create,Pr=fe.create,Lr=se.create,Br=J.create,Mr=He.create,Ir=D.create,Wr=E.create,Zr=E.strictCreate,jr=Ae.create,Vr=Xe.create,Dr=Se.create,qr=z.create,$r=Ce.create,Ur=Ge.create,zr=ae.create,Fr=de.create,Hr=Re.create,Gr=Oe.create,Yr=te.create,Jr=Ne.create,Kr=pe.create,It=q.create,Xr=Y.create,Qr=ce.create,es=q.createWithPreprocess,ts=Be.create,ns=()=>sn().optional(),rs=()=>on().optional(),ss=()=>an().optional(),is={string:n=>j.create({...n,coerce:!0}),number:n=>Q.create({...n,coerce:!0}),boolean:n=>xe.create({...n,coerce:!0}),bigint:n=>ee.create({...n,coerce:!0}),date:n=>oe.create({...n,coerce:!0})},os=g;var cn=Object.freeze({__proto__:null,defaultErrorMap:we,setErrorMap:ur,getErrorMap:$e,makeIssue:Ue,EMPTY_PATH:dr,addIssueToContext:f,ParseStatus:R,INVALID:g,DIRTY:en,OK:N,isAborted:lt,isDirty:ut,isValid:ke,isAsync:ze,get util(){return x},get objectUtil(){return ct},ZodParsedType:h,getParsedType:K,ZodType:_,ZodString:j,ZodNumber:Q,ZodBigInt:ee,ZodBoolean:xe,ZodDate:oe,ZodSymbol:Fe,ZodUndefined:Te,ZodNull:Ee,ZodAny:fe,ZodUnknown:se,ZodNever:J,ZodVoid:He,ZodArray:D,ZodObject:E,ZodUnion:Ae,ZodDiscriminatedUnion:Xe,ZodIntersection:Se,ZodTuple:z,ZodRecord:Ce,ZodMap:Ge,ZodSet:ae,ZodFunction:de,ZodLazy:Re,ZodLiteral:Oe,ZodEnum:te,ZodNativeEnum:Ne,ZodPromise:pe,ZodEffects:q,ZodTransformer:q,ZodOptional:Y,ZodNullable:ce,ZodDefault:Pe,ZodCatch:Ye,ZodNaN:Je,BRAND:xr,ZodBranded:nn,ZodPipeline:Be,ZodReadonly:Ke,custom:rn,Schema:_,ZodSchema:_,late:Tr,get ZodFirstPartyTypeKind(){return y},coerce:is,any:Pr,array:Ir,bigint:Sr,boolean:an,date:Cr,discriminatedUnion:Vr,effect:It,enum:Yr,function:Fr,instanceof:Er,intersection:Dr,lazy:Hr,literal:Gr,map:Ur,nan:Ar,nativeEnum:Jr,never:Br,null:Nr,nullable:Qr,number:on,object:Wr,oboolean:ss,onumber:rs,optional:Xr,ostring:ns,pipeline:ts,preprocess:es,promise:Kr,record:$r,set:zr,strictObject:Zr,string:sn,symbol:Rr,transformer:It,tuple:qr,undefined:Or,union:jr,unknown:Lr,void:Mr,NEVER:os,ZodIssueCode:u,quotelessJson:lr,ZodError:V});function as(){const n=WA.players.list(),e=new Map;for(const t of n){const r=cn.string().optional().safeParse(t.state.currentPlace);if(r.success===!1){console.warn("Invalid place for a player: ",t.state.currentPlace);continue}const s=r.data??"corridor";let i=e.get(s);i===void 0&&(i=[],e.set(s,i)),i.push(t)}return e}function cs(n){const e=cn.string().array().optional().safeParse(n.state.tags);return e.success?(e.data??[]).includes("member"):(console.warn("Invalid tags for a player: ",n.state.tags),!1)}function ls(n){return`${n.name} joined the chat. ${n.name} is a ${cs(n)?"coworker":"visitor"}. You can welcome him/her and make a summary of the conversation you were having.`}const F=Object.create(null);F.open="0";F.close="1";F.ping="2";F.pong="3";F.message="4";F.upgrade="5";F.noop="6";const Ze=Object.create(null);Object.keys(F).forEach(n=>{Ze[F[n]]=n});const ht={type:"error",data:"parser error"},ln=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",un=typeof ArrayBuffer=="function",dn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,wt=({type:n,data:e},t,r)=>ln&&e instanceof Blob?t?r(e):Wt(e,r):un&&(e instanceof ArrayBuffer||dn(e))?t?r(e):Wt(new Blob([e]),r):r(F[n]+(e||"")),Wt=(n,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(n)};function Zt(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let st;function us(n,e){if(ln&&n.data instanceof Blob)return n.data.arrayBuffer().then(Zt).then(e);if(un&&(n.data instanceof ArrayBuffer||dn(n.data)))return e(Zt(n.data));wt(n,!1,t=>{st||(st=new TextEncoder),e(st.encode(t))})}const jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_e=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<jt.length;n++)_e[jt.charCodeAt(n)]=n;const ds=n=>{let e=n.length*.75,t=n.length,r,s=0,i,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const l=new ArrayBuffer(e),d=new Uint8Array(l);for(r=0;r<t;r+=4)i=_e[n.charCodeAt(r)],o=_e[n.charCodeAt(r+1)],a=_e[n.charCodeAt(r+2)],c=_e[n.charCodeAt(r+3)],d[s++]=i<<2|o>>4,d[s++]=(o&15)<<4|a>>2,d[s++]=(a&3)<<6|c&63;return l},hs=typeof ArrayBuffer=="function",kt=(n,e)=>{if(typeof n!="string")return{type:"message",data:hn(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:fs(n.substring(1),e)}:Ze[t]?n.length>1?{type:Ze[t],data:n.substring(1)}:{type:Ze[t]}:ht},fs=(n,e)=>{if(hs){const t=ds(n);return hn(t,e)}else return{base64:!0,data:n}},hn=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},fn=String.fromCharCode(30),ps=(n,e)=>{const t=n.length,r=new Array(t);let s=0;n.forEach((i,o)=>{wt(i,!1,a=>{r[o]=a,++s===t&&e(r.join(fn))})})},ms=(n,e)=>{const t=n.split(fn),r=[];for(let s=0;s<t.length;s++){const i=kt(t[s],e);if(r.push(i),i.type==="error")break}return r};function ys(){return new TransformStream({transform(n,e){us(n,t=>{const r=t.length;let s;if(r<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,r);else if(r<65536){s=new Uint8Array(3);const i=new DataView(s.buffer);i.setUint8(0,126),i.setUint16(1,r)}else{s=new Uint8Array(9);const i=new DataView(s.buffer);i.setUint8(0,127),i.setBigUint64(1,BigInt(r))}n.data&&typeof n.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(t)})}})}let it;function Me(n){return n.reduce((e,t)=>e+t.length,0)}function Ie(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let r=0;for(let s=0;s<e;s++)t[s]=n[0][r++],r===n[0].length&&(n.shift(),r=0);return n.length&&r<n[0].length&&(n[0]=n[0].slice(r)),t}function gs(n,e){it||(it=new TextDecoder);const t=[];let r=0,s=-1,i=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if(Me(t)<1)break;const c=Ie(t,1);i=(c[0]&128)===128,s=c[0]&127,s<126?r=3:s===126?r=1:r=2}else if(r===1){if(Me(t)<2)break;const c=Ie(t,2);s=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),r=3}else if(r===2){if(Me(t)<8)break;const c=Ie(t,8),l=new DataView(c.buffer,c.byteOffset,c.length),d=l.getUint32(0);if(d>Math.pow(2,53-32)-1){a.enqueue(ht);break}s=d*Math.pow(2,32)+l.getUint32(4),r=3}else{if(Me(t)<s)break;const c=Ie(t,s);a.enqueue(kt(i?c:it.decode(c),e)),r=0}if(s===0||s>n){a.enqueue(ht);break}}}})}const pn=4;function S(n){if(n)return vs(n)}function vs(n){for(var e in S.prototype)n[e]=S.prototype[e];return n}S.prototype.on=S.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};S.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};S.prototype.off=S.prototype.removeListener=S.prototype.removeAllListeners=S.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var r,s=0;s<t.length;s++)if(r=t[s],r===e||r.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+n],this};S.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,s=t.length;r<s;++r)t[r].apply(this,e)}return this};S.prototype.emitReserved=S.prototype.emit;S.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};S.prototype.hasListeners=function(n){return!!this.listeners(n).length};const Qe=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),M=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),_s="arraybuffer";function mn(n,...e){return e.reduce((t,r)=>(n.hasOwnProperty(r)&&(t[r]=n[r]),t),{})}const bs=M.setTimeout,ws=M.clearTimeout;function et(n,e){e.useNativeTimers?(n.setTimeoutFn=bs.bind(M),n.clearTimeoutFn=ws.bind(M)):(n.setTimeoutFn=M.setTimeout.bind(M),n.clearTimeoutFn=M.clearTimeout.bind(M))}const ks=1.33;function xs(n){return typeof n=="string"?Ts(n):Math.ceil((n.byteLength||n.size)*ks)}function Ts(n){let e=0,t=0;for(let r=0,s=n.length;r<s;r++)e=n.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function yn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Es(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function As(n){let e={},t=n.split("&");for(let r=0,s=t.length;r<s;r++){let i=t[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}class Ss extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class xt extends S{constructor(e){super(),this.writable=!1,et(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new Ss(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=kt(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Es(e);return t.length?"?"+t:""}}class Cs extends xt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};ms(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ps(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=yn()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let gn=!1;try{gn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Rs=gn;function Os(){}class Ns extends Cs{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(s,i)=>{this.onError("xhr post error",s,i)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class $ extends S{constructor(e,t,r){super(),this.createRequest=e,et(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=mn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&r.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var s;r.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=$.requestsCount++,$.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Os,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete $.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}$.requestsCount=0;$.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Vt);else if(typeof addEventListener=="function"){const n="onpagehide"in M?"pagehide":"unload";addEventListener(n,Vt,!1)}}function Vt(){for(let n in $.requests)$.requests.hasOwnProperty(n)&&$.requests[n].abort()}const Ps=function(){const n=vn({xdomain:!1});return n&&n.responseType!==null}();class Ls extends Ns{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=Ps&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new $(vn,this.uri(),e)}}function vn(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Rs))return new XMLHttpRequest}catch{}if(!e)try{return new M[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const _n=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Bs extends xt{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=_n?{}:mn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],s=t===e.length-1;wt(r,this.supportsBinary,i=>{try{this.doWrite(r,i)}catch{}s&&Qe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=yn()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const ot=M.WebSocket||M.MozWebSocket;class Ms extends Bs{createSocket(e,t,r){return _n?new ot(e,t,r):t?new ot(e,t):new ot(e)}doWrite(e,t){this.ws.send(t)}}class Is extends xt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=gs(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),s=ys();s.readable.pipeTo(e.writable),this._writer=s.writable.getWriter();const i=()=>{r.read().then(({done:a,value:c})=>{a||(this.onPacket(c),i())}).catch(a=>{})};i();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],s=t===e.length-1;this._writer.write(r).then(()=>{s&&Qe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Ws={websocket:Ms,webtransport:Is,polling:Ls},Zs=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,js=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function ft(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),r=n.indexOf("]");t!=-1&&r!=-1&&(n=n.substring(0,t)+n.substring(t,r).replace(/:/g,";")+n.substring(r,n.length));let s=Zs.exec(n||""),i={},o=14;for(;o--;)i[js[o]]=s[o]||"";return t!=-1&&r!=-1&&(i.source=e,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Vs(i,i.path),i.queryKey=Ds(i,i.query),i}function Vs(n,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function Ds(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,s,i){s&&(t[s]=i)}),t}const pt=typeof addEventListener=="function"&&typeof removeEventListener=="function",je=[];pt&&addEventListener("offline",()=>{je.forEach(n=>n())},!1);class X extends S{constructor(e,t){if(super(),this.binaryType=_s,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=ft(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=ft(t.host).host);et(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const s=r.prototype.name;this.transports.push(s),this._transportsByName[s]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=As(this.opts.query)),pt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},je.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=pn,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&X.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",X.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const s=this.writeBuffer[r].data;if(s&&(t+=xs(s)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Qe(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,s){if(typeof t=="function"&&(s=t,t=void 0),typeof r=="function"&&(s=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const i={type:e,data:t,options:r};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(X.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),pt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=je.indexOf(this._offlineEventListener);r!==-1&&je.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}X.protocol=pn;class qs extends X{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;X.priorWebsocketSuccess=!1;const s=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",p=>{if(!r)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;X.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(d(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const w=new Error("probe error");w.transport=t.name,this.emitReserved("upgradeError",w)}}))};function i(){r||(r=!0,d(),t.close(),t=null)}const o=p=>{const w=new Error("probe error: "+p);w.transport=t.name,i(),this.emitReserved("upgradeError",w)};function a(){o("transport closed")}function c(){o("socket closed")}function l(p){t&&p.name!==t.name&&i()}const d=()=>{t.removeListener("open",s),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",s),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let $s=class extends qs{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(s=>Ws[s]).filter(s=>!!s)),super(e,r)}};function Us(n,e="",t){let r=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),r=ft(n)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+e,r.href=r.protocol+"://"+i+(t&&t.port===r.port?"":":"+r.port),r}const zs=typeof ArrayBuffer=="function",Fs=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,bn=Object.prototype.toString,Hs=typeof Blob=="function"||typeof Blob<"u"&&bn.call(Blob)==="[object BlobConstructor]",Gs=typeof File=="function"||typeof File<"u"&&bn.call(File)==="[object FileConstructor]";function Tt(n){return zs&&(n instanceof ArrayBuffer||Fs(n))||Hs&&n instanceof Blob||Gs&&n instanceof File}function Ve(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Ve(n[t]))return!0;return!1}if(Tt(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return Ve(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&Ve(n[t]))return!0;return!1}function Ys(n){const e=[],t=n.data,r=n;return r.data=mt(t,e),r.attachments=e.length,{packet:r,buffers:e}}function mt(n,e){if(!n)return n;if(Tt(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<n.length;r++)t[r]=mt(n[r],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=mt(n[r],e));return t}return n}function Js(n,e){return n.data=yt(n.data,e),delete n.attachments,n}function yt(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=yt(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=yt(n[t],e));return n}const Ks=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Xs=5;var b;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(b||(b={}));class Qs{constructor(e){this.replacer=e}encode(e){return(e.type===b.EVENT||e.type===b.ACK)&&Ve(e)?this.encodeAsBinary({type:e.type===b.EVENT?b.BINARY_EVENT:b.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===b.BINARY_EVENT||e.type===b.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ys(e),r=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(r),s}}function Dt(n){return Object.prototype.toString.call(n)==="[object Object]"}class Et extends S{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===b.BINARY_EVENT;r||t.type===b.BINARY_ACK?(t.type=r?b.EVENT:b.ACK,this.reconstructor=new ei(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Tt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(b[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===b.BINARY_EVENT||r.type===b.BINARY_ACK){const i=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(i,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const i=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(i,t)}else r.nsp="/";const s=e.charAt(t+1);if(s!==""&&Number(s)==s){const i=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(i,t+1))}if(e.charAt(++t)){const i=this.tryParse(e.substr(t));if(Et.isPayloadValid(r.type,i))r.data=i;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case b.CONNECT:return Dt(t);case b.DISCONNECT:return t===void 0;case b.CONNECT_ERROR:return typeof t=="string"||Dt(t);case b.EVENT:case b.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Ks.indexOf(t[0])===-1);case b.ACK:case b.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class ei{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Js(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ti=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Et,Encoder:Qs,get PacketType(){return b},protocol:Xs},Symbol.toStringTag,{value:"Module"}));function Z(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const ni=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class wn extends S{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Z(e,"open",this.onopen.bind(this)),Z(e,"packet",this.onpacket.bind(this)),Z(e,"error",this.onerror.bind(this)),Z(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,s,i;if(ni.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:b.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const d=this.ids++,p=t.pop();this._registerAckCallback(d,p),o.id=d}const a=(s=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||s===void 0?void 0:s.writable,c=this.connected&&!(!((i=this.io.engine)===null||i===void 0)&&i._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;const s=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}const i=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},s),o=(...a)=>{this.io.clearTimeoutFn(i),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,s)=>{const i=(o,a)=>o?s(o):r(a);i.withError=!0,t.push(i),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...i)=>r!==this._queue[0]?void 0:(s!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...i)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:b.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case b.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case b.EVENT:case b.BINARY_EVENT:this.onevent(e);break;case b.ACK:case b.BINARY_ACK:this.onack(e);break;case b.DISCONNECT:this.ondisconnect();break;case b.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...s){r||(r=!0,t.packet({type:b.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:b.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function ge(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}ge.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};ge.prototype.reset=function(){this.attempts=0};ge.prototype.setMin=function(n){this.ms=n};ge.prototype.setMax=function(n){this.max=n};ge.prototype.setJitter=function(n){this.jitter=n};class gt extends S{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,et(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new ge({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||ti;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new $s(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const s=Z(t,"open",function(){r.onopen(),e&&e()}),i=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Z(t,"error",i);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{s(),i(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(s),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Z(e,"ping",this.onping.bind(this)),Z(e,"data",this.ondata.bind(this)),Z(e,"error",this.onerror.bind(this)),Z(e,"close",this.onclose.bind(this)),Z(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Qe(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new wn(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ve={};function De(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=Us(n,e.path||"/socket.io"),r=t.source,s=t.id,i=t.path,o=ve[s]&&i in ve[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return a?c=new gt(r,e):(ve[s]||(ve[s]=new gt(r,e)),c=ve[s]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(De,{Manager:gt,Socket:wn,io:De,connect:De});class kn{constructor(){W(this,"socket");W(this,"isConnected",!1);W(this,"reconnectAttempts",0);W(this,"maxReconnectAttempts",5);W(this,"connectionPromise");W(this,"resolveConnection");W(this,"rejectConnection");W(this,"movementCallback");this.connectionPromise=new Promise((e,t)=>{this.resolveConnection=e,this.rejectConnection=t}),this.initializeSocket()}initializeSocket(){this.socket=De("http://localhost:3000/map-events",{withCredentials:!0,reconnection:!0,reconnectionAttempts:this.maxReconnectAttempts,reconnectionDelay:1e3,transports:["websocket"],upgrade:!1}),this.setupEventListeners()}setupEventListeners(){this.socket.on("connect",()=>{console.log("[MapEventsSocket] Connected to map events WebSocket server"),this.isConnected=!0,this.reconnectAttempts=0,this.resolveConnection()}),this.socket.on("disconnect",()=>{console.log("[MapEventsSocket] Disconnected from map events WebSocket server"),this.isConnected=!1,this.connectionPromise=new Promise((e,t)=>{this.resolveConnection=e,this.rejectConnection=t})}),this.socket.on("connect_error",e=>{console.error("[MapEventsSocket] WebSocket connection error:",e),this.reconnectAttempts++,this.reconnectAttempts>=this.maxReconnectAttempts&&(console.error("[MapEventsSocket] Max reconnection attempts reached, falling back to HTTP"),this.rejectConnection(e))}),this.socket.on("robot-move-command",e=>{console.log("[MapEventsSocket] Received movement trigger command:",e),this.movementCallback?(console.log("[MapEventsSocket] Executing movement callback"),this.movementCallback(e.destPlayerName),console.log("[MapEventsSocket] Movement callback executed")):console.warn("[MapEventsSocket] No movement callback registered!")})}async waitForConnection(){return this.isConnected?Promise.resolve():this.connectionPromise}onMovementCommand(e){console.log("[MapEventsSocket] Registering movement callback"),this.movementCallback=e}async sendRoomState(e,t,r,s){try{await this.waitForConnection(),this.socket.emit("room-state",{players:e,map:t,places:r,peopleByPlace:s},i=>{(i==null?void 0:i.status)==="error"&&console.error("Error sending room state:",i.message)})}catch(i){throw console.error("Failed to send room state:",i),i}}async sendPlayerMove(e,t,r){try{await this.waitForConnection(),this.socket.emit("player-move",{data:{type:"move",player:e,oldPosition:t,newPosition:r}},s=>{(s==null?void 0:s.status)==="error"&&console.error("Error sending player move:",s.message)})}catch(s){throw console.error("Failed to send player move:",s),s}}async sendPlayerEnter(e){try{await this.waitForConnection(),this.socket.emit("player-enter",{data:{type:"enter",player:e}},t=>{(t==null?void 0:t.status)==="error"&&console.error("Error sending player enter:",t.message)})}catch(t){throw console.error("Failed to send player enter:",t),t}}async sendPlayerLeave(e){try{await this.waitForConnection(),this.socket.emit("player-leave",{data:{type:"leave",player:e}},t=>{(t==null?void 0:t.status)==="error"&&console.error("Error sending player leave:",t.message)})}catch(t){throw console.error("Failed to send player leave:",t),t}}async sendRobotMoveRequest(e){try{return await this.waitForConnection(),new Promise((t,r)=>{this.socket.emit("robot-move-request",{data:e},s=>{(s==null?void 0:s.status)==="error"?(console.error("Error sending robot move request:",s.message),r(new Error(s.message))):s!=null&&s.result?t(s.result):r(new Error("No response from robot move request"))})})}catch(t){throw console.error("Failed to send robot move request:",t),t}}async sendRobotChatRequest(e){try{return await this.waitForConnection(),new Promise((t,r)=>{this.socket.emit("robot-chat-request",e,s=>{(s==null?void 0:s.status)==="error"?(console.error("Error sending robot chat request:",s.message),r(new Error(s.message))):s!=null&&s.result?t(s.result):r(new Error("No response from robot chat request"))})})}catch(t){throw console.error("Failed to send robot chat request:",t),t}}disconnect(){this.socket&&this.socket.disconnect()}}const qt=new kn,ri=cr(3e4,async n=>{console.log("[throttledMovePrompt] Function called - starting movement evaluation");try{const e=n;console.log("[throttledMovePrompt] Going to ",e);const t=WA.players.list();for(const r of t)if(r.name===e){await WA.player.moveTo(r.position.x,r.position.y);break}}catch(e){console.error("[throttledMovePrompt] Error sending move request:",e)}},{noTrailing:!1,noLeading:!1});class si{constructor(){W(this,"mode","waiting");W(this,"chatHistory",[])}init(){console.log("[Robot] Robot is starting..."),console.log("[Robot] Setting up movement command listener"),qt.onMovementCommand(e=>{console.log("[Robot] Movement command callback triggered!"),this.executeMovementCommand(e)}),console.log("[Robot] Movement command listener setup complete"),WA.player.proximityMeeting.onJoin().subscribe(e=>{console.log("[Robot] Proximity meeting joined"),console.log("users: ",e),this.mode="waiting"}),WA.player.proximityMeeting.onParticipantJoin().subscribe(e=>{console.log("[Robot] Participant joined proximity meeting - ",e),this.remotePlayerJoined(e)}),WA.player.proximityMeeting.onLeave().subscribe(()=>{console.log("[Robot] Left proximity meeting"),this.mode="waiting"}),WA.chat.onChatMessage((e,t)=>{(async()=>{if(this.mode!=="chatting"){console.warn("Received a chat message while not in chatting mode: ",e,t);return}if(!t.author)return;this.chatHistory.push({role:"user",player:t.author,content:t.author.name+": "+e});const r=await this.triggerGpt();WA.chat.sendChatMessage(r,{scope:"bubble"})})().catch(r=>console.error(r))},{scope:"bubble"})}async executeMovementCommand(e){try{console.log("[Robot] executeMovementCommand called - executing movement evaluation"),await ri(e),console.log("[Robot] Movement evaluation completed")}catch(t){console.error("[Robot] Error executing movement command:",t)}}async triggerGpt(){const e=this.chatHistory.map(t=>({role:t.role,content:t.role==="user"?t.player.name+": "+t.content:t.content}));WA.chat.startTyping({scope:"bubble"});try{const t=await qt.sendRobotChatRequest({messages:e});if(t==null)throw new Error("Agent returned no response");return console.log("Agent response:",t),WA.chat.stopTyping({scope:"bubble"}),this.chatHistory.push({role:"assistant",content:t}),t}catch(t){return WA.chat.stopTyping({scope:"bubble"}),console.error("Error getting chat response:",t),"Sorry, I'm having trouble responding right now."}}async remotePlayerJoined(e){if(this.mode==="chatting"){this.chatHistory.push({role:"system",content:ls(e)});const t=await this.triggerGpt();WA.chat.sendChatMessage(t,{scope:"bubble"})}}}const ii=new si;console.log("Script started successfully");let qe,re;WA.onInit().then(async()=>{console.log("Scripting API ready"),console.log("Player tags: ",WA.player.tags);const n=await Ut();console.log(n),re=new kn,WA.room.area.onEnter("clock").subscribe(()=>{const e=new Date,t=e.getHours()+":"+e.getMinutes();qe=WA.ui.openPopup("clockPopup","It's "+t,[])}),WA.room.area.onLeave("clock").subscribe(oi),or().then(async()=>{console.log("Scripting API Extra ready"),WA.players.configureTracking({players:!0,movement:!0});const t=WA.room.id.split("~")[1];console.log("Room ID without protocol: ",t);const r=t.split("/")[1],s=t.split("/")[2];console.log("Folder ID: ",r),console.log("Room ID: ",s);const i=await WA.players.list();console.log("Players: ",i);const o=await WA.room.getTiledMap(),a=await Xt();console.log("Places: ",a);const c=as();console.log("People by place: ",c);const l=Object.fromEntries(a),d=Object.fromEntries(Array.from(c.entries()).map(([p,w])=>[p,w]));console.log("Places as object: ",l),console.log("People by place as object: ",d),console.log("Sending initial state through WebSocket...");try{await re.sendRoomState(i,o,l,d),console.log("Initial state sent successfully")}catch(p){console.error("Failed to send initial state:",p)}WA.players.onPlayerMoves.subscribe(async p=>{const w=p.player,O=p.oldPosition,I=p.newPosition;console.log(`Player ${w.name} moved from ${O.x},${O.y} to ${I.x},${I.y}`);try{console.log(`Sending player move event for ${w.name} through WebSocket`),await re.sendPlayerMove(w,O,I),console.log(`Player move event sent successfully for ${w.name}`)}catch(T){console.error(`Failed to send player move event for ${w.name}:`,T)}}),WA.players.onPlayerEnters.subscribe(async p=>{console.log(`Player ${p.name} entered your nearby zone`);try{console.log(`Sending player enter event for ${p.name} through WebSocket`),await re.sendPlayerEnter(p),console.log(`Player enter event sent successfully for ${p.name}`)}catch(w){console.error(`Failed to send player enter event for ${p.name}:`,w)}}),WA.players.onPlayerLeaves.subscribe(async p=>{console.log(`Player ${p.name} left your nearby zone`);try{console.log(`Sending player leave event for ${p.name} through WebSocket`),await re.sendPlayerLeave(p),console.log(`Player leave event sent successfully for ${p.name}`)}catch(w){console.error(`Failed to send player leave event for ${p.name}:`,w)}}),ar(),WA.player.state.saveVariable("tags",WA.player.tags,{persist:!1,public:!0}),console.log("[main.ts] Initializing robot..."),ii.init(),console.log("[main.ts] Robot initialization completed")}).catch(e=>console.error(e))}).catch(n=>console.error(n));function oi(){qe!==void 0&&(qe.close(),qe=void 0)}window.addEventListener("beforeunload",()=>{re&&re.disconnect()});
//# sourceMappingURL=main-44c3b95b.js.map
